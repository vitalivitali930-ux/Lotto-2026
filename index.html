<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VCHF - 3D Genesis Silent & Lotto</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --neon-cyan: #00fbff; 
            --neon-fire: #ff4d00; 
            --main-color: #d4af37; 
            --main-gradient: linear-gradient(145deg, #f9e27d, #d4af37);
            --theme-glow: rgba(212, 175, 55, 0.35);
            --white-sphere: radial-gradient(circle at 35% 35%, #444 0%, #1a1a1a 40%, #000 100%);
            --process-color: #00ffff;
        }

        body, html { margin: 0; padding: 0; background: #000; color: #fff; font-family: 'Orbitron', -apple-system, sans-serif; overflow: hidden; height: 100vh; }

        /* --- STYLES: 3D INTRO --- */
        #world-3d { position: fixed; inset: 0; perspective: 1200px; z-index: 20001; background: radial-gradient(circle at center, #051622 0%, #000 100%); transition: opacity 1.5s; }
        #grid-floor { position: absolute; width: 400%; height: 400%; top: -100%; left: -150%; background-image: linear-gradient(rgba(0, 251, 255, 0.2) 2px, transparent 2px), linear-gradient(90deg, rgba(0, 251, 255, 0.2) 2px, transparent 2px); background-size: 100px 100px; transform: rotateX(75deg); transform-origin: center center; animation: gridMove 8s linear infinite; }
        @keyframes gridMove { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }
        #bg-manifesto { position: absolute; inset: 0; color: rgba(0, 251, 255, 0.04); font-size: 11px; white-space: pre-wrap; pointer-events: none; z-index: 20002; overflow: hidden; text-transform: uppercase; }
        #stage-intro { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 20003; }
        canvas#vchf-canvas { position: absolute; inset: 0; z-index: 20010; pointer-events: none; }
        .neutron-sphere { position: absolute; width: 75px; height: 75px; border-radius: 50%; background: rgba(0,0,0,0.8); border: 2.5px solid var(--neon-cyan); box-shadow: 0 0 35px var(--neon-cyan), inset 0 0 15px var(--neon-cyan); display: flex; justify-content: center; align-items: center; color: var(--neon-cyan); font-size: 1.8rem; font-weight: 900; opacity: 0; z-index: 20150; text-shadow: 0 0 15px var(--neon-cyan); transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s; }
        #super-zahl { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0); width: 170px; height: 170px; border-radius: 50%; background: #000; border: 5px solid var(--neon-fire); box-shadow: 0 0 80px var(--neon-fire), inset 0 0 40px var(--neon-fire); display: none; justify-content: center; align-items: center; color: var(--neon-fire); font-size: 6rem; font-weight: 900; z-index: 20500; text-shadow: 0 0 30px var(--neon-fire); transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        #vchf-fog { position: fixed; inset: 0; background: radial-gradient(circle, var(--neon-cyan) 0%, transparent 80%); opacity: 0; z-index: 21000; pointer-events: none; transition: opacity 3s; }
        .vchf-shake { animation: vchfPulse 0.15s infinite; }
        @keyframes vchfPulse { 0% { transform: translate(2px, 2px); } 100% { transform: translate(-2px, -2px); } }

        /* --- STYLES: MAIN APP --- */
        #app-content { display: none; opacity: 0; transition: opacity 1s ease; height: 100vh; overflow: hidden; z-index: 100; position: relative; }
        .page { height: calc(100vh - 75px); overflow-y: auto; display: none; padding: 15px 0 30px; }
        .page.active { display: block; }
        body.theme-cherry { --main-color: #C511A4; --main-gradient: linear-gradient(145deg, #FF1493, #C511A4); }
        body.theme-silver { --main-color: #c0c0c0; --main-gradient: linear-gradient(145deg, #e0e0e0, #c0c0c0); }
        body.theme-lime { --main-color: #32CD32; --main-gradient: linear-gradient(145deg, #adff2f, #32CD32); }
        body.theme-cyan { --main-color: #00ffff; --main-gradient: linear-gradient(145deg, #e0ffff, #00ffff); }
        
        @keyframes sphere-breathe { 0%, 100% { box-shadow: inset -3px -3px 8px rgba(0,0,0,0.8), 0 5px 12px rgba(0,0,0,0.6), 0 0 5px var(--main-color); transform: scale(1); } 50% { box-shadow: inset -3px -3px 8px rgba(0,0,0,0.8), 0 5px 22px rgba(0,0,0,0.4), 0 0 20px var(--main-color); transform: scale(1.04); } }
        .cell { aspect-ratio: 1/1; background: var(--white-sphere); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 19px; transition: 0.4s; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); animation: sphere-breathe 4s infinite ease-in-out; }
        .cell.selected { background: var(--main-gradient); color: #000; transform: scale(1.1); box-shadow: 0 0 30px var(--main-color); animation: none; z-index: 10; }
        
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; background: rgba(10,10,10,0.95); display: flex; justify-content: space-around; align-items: center; border-top: 1.5px solid var(--main-color); }
        .nav-item { color: #666; font-size: 10px; text-align: center; }
        .nav-item.active { color: var(--main-color); }
        .btn-main { width: 85%; padding: 20px; border-radius: 18px; background: var(--main-gradient); color: #000; border: none; font-weight: 800; font-size: 18px; margin: 15px auto; display: block; }
        
        #legal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 50000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 25px; }
        .legal-box { background: #111; border: 2px solid var(--main-color); padding: 30px; border-radius: 25px; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; padding: 0 15px; }
    </style>
</head>
<body onload="igniteAutoGenesis()">

<div id="world-3d"><div id="grid-floor"></div></div>
<div id="bg-manifesto"></div>
<div id="vchf-fog"></div>
<div id="stage-intro">
    <canvas id="vchf-canvas"></canvas>
    <div id="super-zahl"></div>
</div>

<div id="app-content">
    <div id="page-play" class="page active">
        <div id="dynamic-langs" style="height:65px; display:flex; justify-content:center; align-items:center;"></div>
        <div class="grid" id="main-grid" style="margin-top:20px;"></div>
        <div id="l-super" style="color:var(--main-color); margin:20px 0 10px;">SUPERZAHL</div>
        <div class="grid" id="s-grid" style="grid-template-columns: repeat(6, 1fr);"></div>
        <button class="btn-main" id="main-btn" onclick="runEngine()">CONFIRM</button>
    </div>

    <div id="page-tickets" class="page">
        <h2 id="l-active-tickets-title" style="color: var(--main-color);">MY TICKETS</h2>
        <div id="active-list"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('play', this)"><span>üé≤</span><div id="n-game">GAME</div></div>
        <div class="nav-item" onclick="showPage('tickets', this)"><span>üéüÔ∏è</span><div id="n-tickets">TICKETS</div></div>
    </div>
</div>

<div id="legal-overlay">
    <div class="legal-box">
        <div id="legal-content" style="color:#fff; margin-bottom:20px;"></div>
        <button class="btn-main" onclick="acceptLegal()" id="legal-agree-btn"></button>
    </div>
</div>

<script>
    /* –î–í–ò–ñ–û–ö VCHF: –ú–∞–Ω–∏—Ñ–µ—Å—Ç –ú–æ–Ω–æ–ª–∏—Ç–∞
       –õ–æ–≥–∏–∫–∞ –∏–Ω—Ç—Ä–æ + –õ–æ–≥–∏–∫–∞ –õ–æ—Ç—Ç–æ
    */
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç—Ä–æ
    const canvas = document.getElementById('vchf-canvas');
    const ctx = canvas.getContext('2d');
    const superBallIntro = document.getElementById('super-zahl');
    const fog = document.getElementById('vchf-fog');
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –õ–æ—Ç—Ç–æ
    let selected = [], superNum = null, currentLang = 'en', pendingLang = 'en';
    let myTickets = JSON.parse(localStorage.getItem('vchf_user_tickets')) || [];
    const dict = {
        ru: { btn: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", super: "–ë–û–ù–£–°–ù–û–ï –ß–ò–°–õ–û", game: "–ò–ì–†–ê", tickets: "–ë–ò–õ–ï–¢–´", activeT: "–ú–û–ò –ë–ò–õ–ï–¢–´" },
        de: { btn: "BEST√ÑTIGEN", super: "SUPERZAHL", game: "SPIEL", tickets: "TICKETS", activeT: "MEINE TICKETS" },
        en: { btn: "CONFIRM", super: "SUPER NUMBER", game: "GAME", tickets: "TICKETS", activeT: "MY TICKETS" }
    };
    const legalDict = {
        ru: { title: "–ó–∞–∫–æ–Ω –®–≤–µ–π—Ü–∞—Ä–∏–∏ (BGS)", text: "–£—á–∞—Å—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –ª–∏—Ü–∞–º —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç.", btn: "–ú–ù–ï –ï–°–¢–¨ 18" },
        en: { title: "Swiss Law (BGS)", text: "Only for persons over 18 years old.", btn: "I AM 18" }
    };

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    // --- –õ–û–ì–ò–ö–ê –ì–ï–ù–ï–ó–ò–°–ê ---
    async function igniteAutoGenesis() {
        document.getElementById('bg-manifesto').innerText = "–ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê: –ù–û–í–´–ô –ö–û–î = –°–¢–ê–†–´–ô + –í–í–ï–î–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø. –î–í–ò–ñ–û–ö VCHF. ".repeat(200);
        await runNeutronStorm();
        await spawnSpheres();
        await finalizeGenesis();
    }

    async function runNeutronStorm() {
        document.body.classList.add('vchf-shake');
        for (let i = 0; i < 50; i++) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let j = 0; j < 5; j++) drawLightning();
            await new Promise(r => setTimeout(r, 50));
        }
        document.body.classList.remove('vchf-shake');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawLightning() {
        ctx.strokeStyle = '#00fbff'; ctx.lineWidth = 3; ctx.shadowBlur = 15; ctx.shadowColor = '#00fbff';
        ctx.beginPath();
        let x = Math.random() * canvas.width, y = Math.random() * canvas.height;
        ctx.moveTo(x, y);
        for (let i = 0; i < 6; i++) { x += (Math.random()-0.5)*200; y += (Math.random()-0.5)*200; ctx.lineTo(x, y); }
        ctx.stroke();
    }

    async function spawnSpheres() {
        const radius = Math.min(canvas.width, canvas.height) * 0.35;
        const nums = [5, 14, 22, 29, 35, 41];
        const spheres = [];
        for (let i = 0; i < 6; i++) {
            const s = document.createElement('div');
            s.className = 'neutron-sphere';
            s.style.left = canvas.width/2-37+'px'; s.style.top = canvas.height/2-37+'px';
            document.getElementById('stage-intro').appendChild(s);
            spheres.push(s);
            const angle = (i/6)*Math.PI*2;
            setTimeout(() => { s.style.opacity='1'; s.style.transform=`translate(${Math.cos(angle)*radius}px, ${Math.sin(angle)*radius}px)`; }, 50);
            let c=0; const iv = setInterval(() => { s.innerText=Math.floor(Math.random()*42)+1; if(c++>30){ clearInterval(iv); s.innerText=nums[i]; s.style.color='#fff'; } }, 40);
            await new Promise(r => setTimeout(r, 400));
        }
        await new Promise(r => setTimeout(r, 2500));
        spheres.forEach(s => { s.style.transform='scale(0)'; s.style.opacity='0'; });
    }

    async function finalizeGenesis() {
        await new Promise(r => setTimeout(r, 800));
        superBallIntro.style.display = 'flex'; superBallIntro.innerText = "6";
        setTimeout(() => superBallIntro.style.transform = 'translate(-50%,-50%) scale(1)', 50);
        await new Promise(r => setTimeout(r, 3000));
        fog.style.opacity = '1';
        setTimeout(() => {
            document.getElementById('world-3d').style.opacity = '0';
            document.getElementById('stage-intro').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            setTimeout(() => { 
                document.getElementById('app-content').style.opacity = '1'; 
                document.getElementById('world-3d').style.display = 'none';
                initLotto();
            }, 500);
        }, 1500);
    }

    // --- –õ–û–ì–ò–ö–ê –õ–û–¢–¢–û ---
    function initLotto() {
        refreshGrid();
        renderSuperGrid();
        const saved = localStorage.getItem('vchf_lang') || 'en';
        setLang(saved);
    }

    function refreshGrid() {
        const g = document.getElementById('main-grid'); g.innerHTML = '';
        for(let i=1; i<=42; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.innerText = i;
            if(selected.includes(i)) c.classList.add('selected');
            c.onclick = () => {
                if(selected.includes(i)) selected = selected.filter(n => n !== i);
                else if(selected.length < 6) selected.push(i);
                refreshGrid();
            };
            g.appendChild(c);
        }
    }

    function renderSuperGrid() {
        const sg = document.getElementById('s-grid'); sg.innerHTML = '';
        for(let i=1; i<=6; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.innerText = i;
            if(superNum === i) c.classList.add('selected');
            c.onclick = () => { superNum = i; renderSuperGrid(); };
            sg.appendChild(c);
        }
    }

    function setLang(l) {
        currentLang = l; const d = dict[l];
        document.getElementById('main-btn').innerText = d.btn;
        document.getElementById('l-super').innerText = d.super;
        document.getElementById('n-game').innerText = d.game;
        document.getElementById('n-tickets').innerText = d.tickets;
    }

    function showPage(p, el) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        el.classList.add('active');
    }

    function runEngine() {
        if(selected.length === 6 && superNum) {
            myTickets.push({ nums: [...selected], super: superNum, timestamp: new Date().toLocaleString() });
            localStorage.setItem('vchf_user_tickets', JSON.stringify(myTickets));
            tg.showAlert("TICKET CONFIRMED!");
            selected = []; superNum = null; refreshGrid(); renderSuperGrid();
        } else tg.showAlert("Select 6 + Super!");
    }
</script>
</body>
</html>
