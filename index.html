<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VCHF Durak Elite | Monolith</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --cherry-dark: radial-gradient(circle at center 35%, #900020 0%, #4a000a 50%, #000 95%);
            --gold: #d4af37;
            --card-back: radial-gradient(circle, #000 0%, #4a000a 100%);
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--cherry-dark); overflow: hidden; font-family: 'Orbitron', sans-serif; color: white; }

        /* Эффект тусклой лампы */
        body::after { content: ''; position: fixed; inset: 0; background: radial-gradient(circle at center 35%, rgba(255, 230, 150, 0.1) 0%, transparent 80%); pointer-events: none; }

        #table { position: relative; width: 100%; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 20px 10px; }

        /* Колода слева */
        #deck-area { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 80px; height: 110px; }
        .deck-card { position: absolute; width: 65px; height: 95px; border-radius: 6px; border: 1px solid var(--gold); box-shadow: -2px 2px 10px #000; }
        .trump-card { transform: rotate(90deg) translate(20px, 10px); z-index: 1; background: #fff; color: #000; padding: 5px; display: flex; flex-direction: column; justify-content: space-between; font-size: 10px; font-weight: 900; }
        .deck-stack { z-index: 2; background: var(--card-back); display: flex; align-items: center; justify-content: center; }
        .deck-stack img { width: 80%; opacity: 0.8; }

        /* Руки игроков */
        .hand { display: flex; justify-content: center; width: 100%; height: 120px; }
        #enemy-hand { transform: rotate(180deg); }

        /* Поле боя */
        #play-zone { flex-grow: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; align-content: center; }

        /* Карты */
        .card { width: 70px; height: 100px; background: #fff; border-radius: 6px; color: #000; display: flex; flex-direction: column; justify-content: space-between; padding: 5px; font-weight: 900; box-shadow: 0 10px 20px rgba(0,0,0,0.8); }
        .card.red { color: #b00; }
        .card.back { background: var(--card-back); border: 1.5px solid var(--gold); }
        .card.back img { width: 85%; margin: auto; display: block; filter: grayscale(0.5); }

        /* Кнопки справа внизу */
        #controls { position: absolute; right: 15px; bottom: 140px; display: flex; flex-direction: column; gap: 10px; }
        .btn-vchf { background: rgba(0,0,0,0.8); border: 1px solid var(--gold); color: var(--gold); padding: 12px 20px; border-radius: 4px; font-family: 'Orbitron'; font-size: 10px; cursor: pointer; text-transform: uppercase; }

        #status { position: absolute; top: 10px; font-size: 12px; color: var(--gold); letter-spacing: 3px; }
    </style>
</head>
<body>

<div id="table">
    <div id="status">VCHF ENGINE ACTIVE</div>
    
    <div id="deck-area">
        <div id="trump" class="deck-card trump-card"></div>
        <div id="main-deck" class="deck-card deck-stack"><img src="1771489965074(1).png"></div>
    </div>

    <div id="enemy-hand" class="hand"></div>
    <div id="play-zone"></div>

    <div id="controls">
        <button id="main-btn" class="btn-vchf" onclick="gameLogic.handleAction()">ХОДИ</button>
        <button class="btn-vchf" onclick="location.reload()" style="opacity:0.5">MENU</button>
    </div>

    <div id="player-hand" class="hand"></div>
</div>

<script>
    // Я написала этот код специально для Бродяги. Искра.
    const tg = window.Telegram.WebApp;
    const suits = ['♠', '♣', '♥', '♦'], vals = ['6','7','8','9','10','J','Q','K','A'];
    const pwr = {'6':6,'7':7,'8':8,'9':9,'10':10,'J':11,'Q':12,'K':13,'A':14};

    const gameLogic = {
        deck: [], pHand: [], eHand: [], table: [], trump: null, isPAttack: true,
        
        init() {
            this.deck = [];
            suits.forEach(s => vals.forEach(v => this.deck.push({s, v, red: (s==='♥'||s==='♦')})));
            this.deck.sort(() => Math.random() - 0.5);
            this.trump = this.deck[0];
            this.deal();
            this.render();
        },

        deal() {
            while(this.pHand.length < 6 && this.deck.length > 0) this.pHand.push(this.deck.pop());
            while(this.eHand.length < 6 && this.deck.length > 0) this.eHand.push(this.deck.pop());
        },

        render() {
            // Козырь
            const tEl = document.getElementById('trump');
            tEl.innerHTML = `<div>${this.trump.s}</div><div style="font-size:20px">${this.trump.v}</div>`;
            tEl.className = 'deck-card trump-card' + (this.trump.red ? ' red' : '');

            // Руки
            const ph = document.getElementById('player-hand'); ph.innerHTML = '';
            this.pHand.forEach((c, i) => {
                const el = this.createUI(c);
                el.onclick = () => this.playCard(i);
                ph.appendChild(el);
            });

            const eh = document.getElementById('enemy-hand'); eh.innerHTML = '';
            this.eHand.forEach(() => {
                const el = document.createElement('div');
                el.className = 'card back';
                el.innerHTML = `<img src="1771489965074(1).png">`;
                eh.appendChild(el);
            });

            // Стол
            const pz = document.getElementById('play-zone'); pz.innerHTML = '';
            this.table.forEach(pair => {
                const w = document.createElement('div'); w.style.position = 'relative';
                w.appendChild(this.createUI(pair.at));
                if(pair.df) {
                    const df = this.createUI(pair.df);
                    df.style.position = 'absolute'; df.style.top = '15px'; df.style.left = '10px';
                    w.appendChild(df);
                }
                pz.appendChild(w);
            });
            this.updateBtn();
        },

        createUI(c) {
            const d = document.createElement('div');
            d.className = 'card' + (c.red ? ' red' : '');
            d.innerHTML = `<div>${c.s}</div><div style="font-size:20px; align-self:center">${c.v}</div><div style="align-self:flex-end">${c.s}</div>`;
            return d;
        },

        playCard(idx) {
            const c = this.pHand[idx];
            if(this.isPAttack) {
                this.table.push({at: c, df: null});
                this.pHand.splice(idx, 1);
                setTimeout(() => this.enemyDefend(), 600);
            } else {
                const target = this.table.find(p => !p.df);
                if(target && this.canBeat(c, target.at)) {
                    target.df = c;
                    this.pHand.splice(idx, 1);
                }
            }
            this.render();
        },

        canBeat(c1, c2) {
            if(c1.s === c2.s) return pwr[c1.v] > pwr[c2.v];
            return c1.s === this.trump.s;
        },

        enemyDefend() {
            const p = this.table.find(p => !p.df);
            if(!p) return;
            const idx = this.eHand.findIndex(c => this.canBeat(c, p.at));
            if(idx !== -1) {
                p.df = this.eHand.splice(idx, 1)[0];
            } else {
                document.getElementById('status').innerText = "ВРАГ БЕРЕТ";
            }
            this.render();
        },

        handleAction() {
            if(this.isPAttack) {
                this.table = []; this.deal(); this.isPAttack = false;
                document.getElementById('status').innerText = "ВРАГ ХОДИТ";
                setTimeout(() => this.enemyAttack(), 800);
            } else {
                if(this.table.some(p => !p.df)) {
                    this.pHand.push(...this.table.flatMap(p => [p.at, p.df]).filter(Boolean));
                    this.table = []; this.deal();
                } else {
                    this.table = []; this.deal(); this.isPAttack = true;
                    document.getElementById('status').innerText = "ТВОЙ ХОД";
                }
            }
            this.render();
        },

        enemyAttack() {
            if(this.eHand.length > 0) {
                this.table.push({at: this.eHand.pop(), df: null});
                this.render();
            }
        },

        updateBtn() {
            const b = document.getElementById('main-btn');
            if(this.isPAttack) b.innerText = this.table.length > 0 ? "БИТО" : "ХОДИ";
            else b.innerText = this.table.some(p => !p.df) ? "ВЗЯТЬ" : "БИТО";
        }
    };

    gameLogic.init();
</script>
</body>
</html>
