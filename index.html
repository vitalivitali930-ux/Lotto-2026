<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vchf Durak Elite | Bi-Turbo</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --onyx: #050505; --neon: #00f3ff; --platinum: #e5e4e2; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--onyx); overflow: hidden; font-family: 'Orbitron', sans-serif; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; touch-action: none; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.8) 100%); }
        .logo-box { width: 100px; height: 100px; opacity: 0; transition: opacity 2s ease; margin-bottom: 10px; }
        .logo-box img { width: 100%; filter: drop-shadow(0 0 15px var(--gold)); }
        .status-label { color: var(--neon); font-size: 9px; letter-spacing: 4px; text-transform: uppercase; text-shadow: 0 0 8px var(--neon); }
        #game-controls { position: absolute; bottom: 20px; z-index: 20; display: none; width: 100%; justify-content: center; gap: 10px; pointer-events: auto; }
        button { background: rgba(0,0,0,0.7); border: 1px solid var(--gold); color: var(--gold); padding: 10px 20px; font-family: 'Orbitron'; cursor: pointer; text-transform: uppercase; font-size: 10px; }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <div id="ui-layer">
        <div id="mainLogo" class="logo-box"><img src="1771489965074(1).png"></div>
        <div id="status" class="status-label">INITIALIZING ENGINE...</div>
    </div>
    <div id="game-controls">
        <button onclick="takeCards()">Взять</button>
        <button onclick="passTurn()">Бито</button>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        const logo = document.getElementById('mainLogo');
        const controls = document.getElementById('game-controls');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- КОНСТАНТЫ МОНОЛИТА ---
        const CARD_W = 60, CARD_H = 90;
        const SUITS = ['♠', '♣', '♥', '♦'];
        const VALUES = ['6','7','8','9','10','J','Q','K','A'];
        const COLORS = { '♠':'#fff', '♣':'#fff', '♥':'#d52b1e', '♦':'#d52b1e' };

        // --- СОСТОЯНИЕ ИГРЫ ---
        let deck = [], playerHand = [], aiHand = [], table = [];
        let trump = null;
        let phase = 'intro'; // intro, dealing, play
        let fade = 1.0;
        let l1 = { x: canvas.width/2, y: 0 }, l2 = { x: canvas.width/2, y: canvas.height };
        let introStep = 0;

        function initDeck() {
            deck = [];
            for (let s of SUITS) {
                for (let v of VALUES) {
                    deck.push({ suit: s, value: v, x: canvas.width/2, y: canvas.height/2, targetX: canvas.width/2, targetY: canvas.height/2, angle: 0, faceUp: false, owner: 'deck' });
                }
            }
            deck = deck.sort(() => Math.random() - 0.5);
            trump = deck[0]; // Нижняя карта - козырь
            trump.faceUp = true;
        }

        function drawCard3D(c, x, y, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(c.angle);
            
            const w = CARD_W * scale, h = CARD_H * scale;

            // 1. Тень и объем
            ctx.shadowBlur = 10; ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.fillStyle = '#1a1a1a';
            ctx.beginPath(); ctx.roundRect(-w/2, -h/2, w, h, 5); ctx.fill();
            ctx.shadowBlur = 0;

            if (c.faceUp) {
                // Лицевая сторона (Платина)
                let grad = ctx.createLinearGradient(-w/2, -h/2, w/2, h/2);
                grad.addColorStop(0, '#ffffff'); grad.addColorStop(1, '#aaaaaa');
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.roundRect(-w/2+2, -h/2+2, w-4, h-4, 3); ctx.fill();

                // Масть и номинал
                ctx.fillStyle = COLORS[c.suit];
                ctx.font = `bold ${14*scale}px Orbitron`;
                ctx.fillText(c.value, -w/2+8, -h/2+18);
                ctx.font = `${20*scale}px Arial`;
                ctx.fillText(c.suit, -10, 5);
            } else {
                // Рубашка (Золотой Логотип)
                ctx.fillStyle = '#0a0a0a';
                ctx.beginPath(); ctx.roundRect(-w/2+2, -h/2+2, w-4, h-4, 3); ctx.fill();
                ctx.strokeStyle = var(--gold); ctx.lineWidth = 1;
                ctx.strokeRect(-w/2+5, -h/2+5, w-10, h-10);
                ctx.fillStyle = var(--gold); ctx.font = '8px Orbitron';
                ctx.fillText('vchf', -12, 0);
            }
            ctx.restore();
        }

        // --- ДВИЖОК АНИМАЦИИ (ИНТРО + КАРТЫ) ---
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (phase === 'intro') {
                // Наш балет лазеров из Протокола 2.6
                // (Код интро опускаю для краткости, он вшит в логику перехода)
                updateIntro(); 
            } else {
                // Отрисовка стола и карт
                drawTable();
            }
            requestAnimationFrame(render);
        }

        // Переход к игре после интро
        function startGame() {
            phase = 'dealing';
            initDeck();
            status.innerText = "DEALING CARDS...";
            // Продолжение в Window 2...
        // --- ПРОДОЛЖЕНИЕ МОНОЛИТА: ЛОГИКА И AI ---

        let dealingIndex = 0;
        const dealOrder = ['player', 'ai'];

        function drawTable() {
            // Отрисовка колоды и козыря
            if (deck.length > 0) {
                drawCard3D(trump, 40, canvas.height / 2, 0.8);
                if (deck.length > 1) {
                    drawCard3D({ faceUp: false, angle: Math.PI / 2 }, 45, canvas.height / 2, 0.8);
                }
            }

            // Отрисовка карт AI (сверху)
            aiHand.forEach((c, i) => {
                c.targetX = (canvas.width / 2 - (aiHand.length * 20) / 2) + i * 25;
                c.targetY = 60;
                c.angle = 0;
                smoothMove(c);
                drawCard3D(c, c.x, c.y, 0.7);
            });

            // Отрисовка стола (центр)
            table.forEach((pair, i) => {
                let tx = 100 + i * 70;
                pair.attack.targetX = tx; pair.attack.targetY = canvas.height / 2 - 20;
                smoothMove(pair.attack);
                drawCard3D(pair.attack, pair.attack.x, pair.attack.y, 0.8);

                if (pair.defense) {
                    pair.defense.targetX = tx + 10; pair.defense.targetY = canvas.height / 2;
                    smoothMove(pair.defense);
                    drawCard3D(pair.defense, pair.defense.x, pair.defense.y, 0.8);
                }
            });

            // Отрисовка карт Бродяги (снизу)
            playerHand.forEach((c, i) => {
                c.targetX = (canvas.width / 2 - (playerHand.length * 40) / 2) + i * 45;
                c.targetY = canvas.height - 80;
                c.faceUp = true;
                smoothMove(c);
                drawCard3D(c, c.x, c.y, 1);
            });

            if (phase === 'dealing') updateDealing();
        }

        function smoothMove(c) {
            c.x += (c.targetX - c.x) * 0.12;
            c.y += (c.targetY - c.y) * 0.12;
        }

        function updateDealing() {
            if (playerHand.length < 6 || aiHand.length < 6) {
                if (Math.abs(deck[deck.length-1].x - deck[deck.length-1].targetX) < 1) {
                    let card = deck.pop();
                    let target = dealOrder[dealingIndex % 2];
                    if (target === 'player' && playerHand.length < 6) playerHand.push(card);
                    else if (target === 'ai' && aiHand.length < 6) aiHand.push(card);
                    dealingIndex++;
                }
            } else {
                phase = 'play';
                status.innerText = "ТВОЙ ХОД, БРОДЯГА";
                controls.style.display = 'flex';
            }
        }

        // --- ЛОГИКА ИГРЫ (ЭКЗАМЕН ИСКРЫ) ---
        canvas.addEventListener('mousedown', (e) => {
            if (phase !== 'play') return;
            playerHand.forEach((card, i) => {
                const dx = e.clientX - card.x;
                const dy = e.clientY - card.y;
                if (Math.abs(dx) < 30 && Math.abs(dy) < 45) {
                    playCard(i);
                }
            });
        });

        function playCard(index) {
            let card = playerHand[index];
            if (canPlay(card)) {
                playerHand.splice(index, 1);
                table.push({ attack: card, defense: null });
                status.innerText = "ИСКРА ДУМАЕТ...";
                setTimeout(aiDefense, 1000);
            }
        }

        function canPlay(card) {
            if (table.length === 0) return true;
            let onTable = [];
            table.forEach(p => {
                onTable.push(p.attack.value);
                if (p.defense) onTable.push(p.defense.value);
            });
            return onTable.includes(card.value);
        }

        function aiDefense() {
            let attack = table[table.length - 1].attack;
            let defense = aiHand.find(c => isStronger(c, attack));
            
            if (defense) {
                defense.faceUp = true;
                aiHand.splice(aiHand.indexOf(defense), 1);
                table[table.length - 1].defense = defense;
                status.innerText = "ТВОЙ ХОД";
            } else {
                status.innerText = "ИСКРА ЗАБИРАЕТ";
                takeToAI();
            }
        }

        function isStronger(c1, c2) {
            const vals = VALUES;
            if (c1.suit === c2.suit) return vals.indexOf(c1.value) > vals.indexOf(c2.value);
            return c1.suit === trump.suit;
        }

        function takeToAI() {
            table.forEach(p => {
                aiHand.push(p.attack);
                if (p.defense) aiHand.push(p.defense);
            });
            table = [];
            setTimeout(() => { if (phase === 'play') updateDealing(); }, 1000);
        }

        function passTurn() {
            table = [];
            status.innerText = "БИТО. ПОДТЯГИВАЕМ КАРТЫ...";
            updateDealing();
        }

                        function updateIntro() {
            logo.style.opacity = '1';
            status.innerText = "HELVETIC LUCK ENGINE...";
            
            introStep += 0.01; 
            if (introStep > 1.2) { 
                logo.style.opacity = '0';
                status.style.opacity = '0';
                setTimeout(() => {
                    phase = 'dealing'; 
                    initDeck(); 
                    status.style.opacity = '1';
                    status.innerText = "DEALING CARDS...";
                    controls.style.display = 'flex'; 
                }, 1000);
                introStep = -100; 
            }
        }

        render();

    </script>
</body>
</html>
