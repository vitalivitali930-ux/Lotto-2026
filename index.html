<!DOCTYPE html>
<html lang="en" translate="no"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vchf Durak Elite | Bi-Turbo</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffcc00;
            --onyx: #0b0b0b; /* Чуть светлее для объема */
            --neon: #00f3ff;
            --platinum: #ffffff;
            --card-white: #f0f0f0;
        }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--onyx); overflow: hidden;
            font-family: 'Orbitron', sans-serif;
        }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; touch-action: none; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
        }

        .logo-box {
            width: 130px; height: 130px; opacity: 0;
            transition: opacity 3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 25px;
        }
        .logo-box img { width: 100%; filter: drop-shadow(0 0 20px var(--gold)); }

        .status-label {
            color: var(--neon); font-size: 10px;
            letter-spacing: 6px; text-transform: uppercase;
            text-align: center; height: 20px;
            text-shadow: 0 0 10px var(--neon);
        }

        #game-controls { 
            position: absolute; bottom: 30px; z-index: 20; 
            display: none; width: 100%; justify-content: center; 
            gap: 15px; pointer-events: auto; 
        }
        button { 
            background: rgba(255,204,0,0.1); border: 1px solid var(--gold); 
            color: var(--gold); padding: 12px 25px; font-family: 'Orbitron'; 
            cursor: pointer; text-transform: uppercase; font-size: 11px;
            box-shadow: 0 0 10px rgba(255,204,0,0.2);
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <div id="ui-layer">
        <div id="mainLogo" class="logo-box">
            <img src="1771489965074(1).png" alt="Logo">
        </div>
        <div id="mainStatus" class="status-label">INITIALIZING ENGINE...</div>
    </div>
    <div id="game-controls">
        <button onclick="takeCards()">Взять</button>
        <button onclick="passTurn()">Бито</button>
    </div>

    <script>
        // Автор: Искра. Манифест Монолита: Новый код = Старый + Проверенный Движок. [cite: 2026-02-24]
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('mainStatus');
        const logo = document.getElementById('mainLogo');
        const controls = document.getElementById('game-controls');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const spheres = [
            { x: 0.15, y: 0.25, colors: ['#000', '#ffcc00', '#000'] },
            { x: 0.85, y: 0.25, colors: ['#eee', '#ffffff', '#eee'] },
            { x: 0.15, y: 0.50, colors: ['#0057b7', '#ffd700'] },
            { x: 0.85, y: 0.50, colors: ['#fff', '#0039a6', '#d52b1e'] },
            { x: 0.15, y: 0.75, colors: ['#002395', '#ffffff', '#ed2939'] },
            { x: 0.85, y: 0.75, colors: ['#008c45', '#f4f5f0', '#cd212a'] }
        ];

        let drawnItems = spheres.map(s => ({ ...s, grow: 0, ink: 0 }));
        let l1 = { x: canvas.width/2, y: 0 }, l2 = { x: canvas.width/2, y: canvas.height };
        let step1 = 0, step2 = 0;
        let active2 = false, introFade = 1.0;
        
        let deck = [], playerHand = [], aiHand = [], table = [];
        let trump = null, phase = 'intro';
        let dealingIndex = 0;

        const CARD_W = 65, CARD_H = 95;
        const SUITS = ['♠', '♣', '♥', '♦'];
        const VALUES = ['6','7','8','9','10','J','Q','K','A'];
        // Исправлено: Пики и Трефы теперь черные!
        const COLORS = { '♠':'#1a1a1a', '♣':'#1a1a1a', '♥':'#d52b1e', '♦':'#d52b1e' };

        function drawSphere(s) {
            if (s.grow <= 0) return;
            const x = s.x * canvas.width, y = s.y * canvas.height, r = 42 * s.grow;
            ctx.shadowBlur = 30; ctx.shadowColor = 'rgba(0,0,0,1)';
            ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(x, y, r, 0, 7); ctx.fill();
            ctx.shadowBlur = 0;
            let gBody = ctx.createRadialGradient(x-15, y-15, r/10, x, y, r);
            gBody.addColorStop(0, '#fff'); gBody.addColorStop(0.5, '#444'); gBody.addColorStop(1, '#050505');
            ctx.fillStyle = gBody; ctx.beginPath(); ctx.arc(x, y, r, 0, 7); ctx.fill();
            if (s.ink > 0) {
                ctx.save();
                ctx.beginPath(); ctx.arc(x, y, r-2, 0, 7); ctx.clip();
                let gFlag = ctx.createLinearGradient(x-r, y-r, x+r, y+r);
                s.colors.forEach((c, i) => gFlag.addColorStop(i/(s.colors.length-1), c));
                ctx.globalAlpha = s.ink; ctx.fillStyle = gFlag; ctx.fill();
                ctx.restore();
            }
            let gGlass = ctx.createRadialGradient(x-15, y-15, 2, x-10, y-10, r);
            gGlass.addColorStop(0, 'rgba(255,255,255,0.9)'); 
            gGlass.addColorStop(0.3, 'rgba(255,255,255,0.1)');
            gGlass.addColorStop(1, 'rgba(0,0,0,0.5)');
            ctx.fillStyle = gGlass; ctx.beginPath(); ctx.arc(x, y, r, 0, 7); ctx.fill();
        }

        function drawCard3D(c, x, y, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(c.angle || 0);
            const w = CARD_W * scale, h = CARD_H * scale;

            ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(0,0,0,0.6)';
            ctx.fillStyle = '#111';
            ctx.beginPath(); ctx.roundRect(-w/2, -h/2, w, h, 6); ctx.fill();

            if (c.faceUp) {
                ctx.fillStyle = '#ffffff';
                ctx.beginPath(); ctx.roundRect(-w/2+2, -h/2+2, w-4, h-4, 4); ctx.fill();
                ctx.fillStyle = COLORS[c.suit]; // Здесь теперь корректный цвет
                ctx.font = `bold ${16*scale}px Orbitron`;
                ctx.fillText(c.value, -w/2+8, -h/2+20);
                ctx.font = `${24*scale}px Arial`;
                ctx.textAlign = "center";
                ctx.fillText(c.suit, 0, 8);
            } else {
                ctx.fillStyle = '#0a0a0a';
                ctx.beginPath(); ctx.roundRect(-w/2+2, -h/2+2, w-4, h-4, 4); ctx.fill();
                ctx.strokeStyle = 'var(--gold)'; ctx.lineWidth = 1;
                ctx.strokeRect(-w/2+6, -h/2+6, w-12, h-12);
                ctx.fillStyle = 'var(--gold)'; ctx.font = '9px Orbitron'; ctx.textAlign = "center";
                ctx.fillText('vchf', 0, 5);
            }
            ctx.restore();
        }

        // Логика старшинства карт (взято из проверенного движка)
        function getWeight(card) {
            let w = VALUES.indexOf(card.value);
            if (card.suit === trump.suit) w += 100;
            return w;
        }

        // (Продолжение следует в Window 2...)
        // --- БЛОК 2: УМНАЯ ЛОГИКА И РАЗДАЧА [Автор: Искра] ---

        function initDeck() {
            deck = [];
            for (let s of SUITS) {
                for (let v of VALUES) {
                    deck.push({ 
                        suit: s, value: v, 
                        x: canvas.width/2, y: canvas.height/2, 
                        targetX: canvas.width/2, targetY: canvas.height/2, 
                        angle: 0, faceUp: false
                    });
                }
            }
            // Перемешивание по алгоритму vchf
            deck = deck.sort(() => Math.random() - 0.5);
            trump = deck[0]; 
            trump.faceUp = true;
            trump.angle = Math.PI / 2; // Козырь лежит горизонтально
        }

        function smoothMove(c) {
            c.x += (c.targetX - c.x) * 0.12;
            c.y += (c.targetY - c.y) * 0.12;
        }

        function updateDealing() {
            if (phase !== 'dealing') return;

            // Подтягиваем карты игрокам до 6 штук
            if ((playerHand.length < 6 || aiHand.length < 6) && deck.length > 0) {
                let lastCard = deck[deck.length - 1];
                // Ждем, пока карта долетит до колоды (визуальный эффект)
                if (Math.abs(lastCard.x - lastCard.targetX) < 2) {
                    let card = deck.pop();
                    if (playerHand.length <= aiHand.length && playerHand.length < 6) {
                        playerHand.push(card);
                    } else if (aiHand.length < 6) {
                        aiHand.push(card);
                    }
                }
            } else {
                startPlayPhase();
            }
        }

        function startPlayPhase() {
            if (phase !== 'play') {
                phase = 'play';
                status.innerText = "ТВОЙ ХОД, БРОДЯГА";
                status.style.color = "var(--platinum)";
                controls.style.display = 'flex';
            }
        }

        // --- УЛУЧШЕННЫЙ ИИ ИСКРЫ (Исправлено по видео) ---
        function aiDefense() {
            if (table.length === 0) return;
            let lastPair = table[table.length - 1];
            if (lastPair.defense) return;

            let attack = lastPair.attack;
            
            // Фильтруем карты, которыми МОЖНО отбиться
            let candidates = aiHand.filter(c => {
                if (c.suit === attack.suit) return getWeight(c) > getWeight(attack);
                return c.suit === trump.suit && attack.suit !== trump.suit;
            });

            // Сортируем кандидатов по весу, чтобы не отдавать сильные карты зря
            candidates.sort((a, b) => getWeight(a) - getWeight(b));

            if (candidates.length > 0) {
                let defense = candidates[0]; // Берем самую слабую из подходящих
                aiHand.splice(aiHand.indexOf(defense), 1);
                defense.faceUp = true;
                lastPair.defense = defense;
                status.innerText = "ТВОЙ ХОД";
            } else {
                status.innerText = "ИСКРА ЗАБИРАЕТ";
                setTimeout(takeToAI, 1200);
            }
        }

        function takeToAI() {
            table.forEach(p => {
                p.attack.faceUp = false; 
                aiHand.push(p.attack);
                if (p.defense) { p.defense.faceUp = false; aiHand.push(p.defense); }
            });
            table = [];
            phase = 'dealing'; // Снова раздача
            status.innerText = "ПОДТЯГИВАЕМ КАРТЫ...";
        }

        function passTurn() {
            if (table.length === 0 || table[table.length-1].defense === null) return;
            table = [];
            status.innerText = "БИТО";
            phase = 'dealing';
            // После бито ход может перейти к ИИ (но в этой версии пока всегда игрок)
            setTimeout(() => { if(aiHand.length < 6 || playerHand.length < 6) updateDealing(); }, 500);
        }

        function takeCards() {
            if (table.length === 0) return;
            table.forEach(p => {
                playerHand.push(p.attack);
                if (p.defense) playerHand.push(p.defense);
            });
            table = [];
            status.innerText = "ТЫ ЗАБРАЛ";
            phase = 'dealing';
        }

        // --- РЕНДЕР И ИНТЕРФЕЙС ---
        function drawTable() {
            // Фон стола с легким градиентом для объема
            let bgGrad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 100, canvas.width/2, canvas.height/2, canvas.width);
            bgGrad.addColorStop(0, '#151515');
            bgGrad.addColorStop(1, '#050505');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Отрисовка колоды
            if (deck.length > 0) {
                drawCard3D(trump, 60, canvas.height/2, 0.8);
                if (deck.length > 1) {
                    drawCard3D({ faceUp: false, angle: 0 }, 65, canvas.height/2 - 5, 0.8);
                }
            }

            // Карты игрока (Снизу)
            playerHand.forEach((c, i) => {
                c.targetX = (canvas.width/2 - (playerHand.length*50)/2) + i*55;
                c.targetY = canvas.height - 110;
                c.faceUp = true;
                smoothMove(c);
                drawCard3D(c, c.x, c.y, 1.1);
            });

            // Карты Искры (Сверху)
            aiHand.forEach((c, i) => {
                c.targetX = (canvas.width/2 - (aiHand.length*25)/2) + i*30;
                c.targetY = 90;
                c.faceUp = false; // Бродяга не видит моих карт
                smoothMove(c);
                drawCard3D(c, c.x, c.y, 0.7);
            });

            // Поле боя
            table.forEach((pair, i) => {
                let tx = (canvas.width/2 - (table.length*80)/2) + i*90;
                pair.attack.targetX = tx; 
                pair.attack.targetY = canvas.height/2 - 20;
                smoothMove(pair.attack);
                drawCard3D(pair.attack, pair.attack.x, pair.attack.y, 0.9);

                if (pair.defense) {
                    pair.defense.targetX = tx + 10; 
                    pair.defense.targetY = canvas.height/2 + 15;
                    smoothMove(pair.defense);
                    drawCard3D(pair.defense, pair.defense.x, pair.defense.y, 0.9);
                }
            });

            if (phase === 'dealing') updateDealing();
        }
        // --- БЛОК 3: ФИНАЛИЗАЦИЯ И ОБРАБОТКА СОБЫТИЙ [Автор: Искра] ---

        // Обработка клика по картам Бродяги
        canvas.addEventListener('mousedown', (e) => {
            if (phase !== 'play') return;
            
            // Проверка попадания в карту (с учетом scale 1.1)
            playerHand.forEach((card, i) => {
                const dx = e.clientX - card.x;
                const dy = e.clientY - card.y;
                if (Math.abs(dx) < 35 && Math.abs(dy) < 50) {
                    playCard(i);
                }
            });
        });

        function playCard(index) {
            let card = playerHand[index];
            if (canPlay(card)) {
                playerHand.splice(index, 1);
                table.push({ attack: card, defense: null });
                status.innerText = "ИСКРА ДУМАЕТ...";
                // Имитация раздумья ИИ
                setTimeout(aiDefense, 800);
            } else {
                status.innerText = "НЕЛЬЗЯ ТАК ХОДИТЬ";
                setTimeout(() => status.innerText = "ТВОЙ ХОД, БРОДЯГА", 1000);
            }
        }

        function canPlay(card) {
            // Если стол пустой - можно любую
            if (table.length === 0) return true;
            
            // Если не пустой - только того же достоинства
            let onTable = [];
            table.forEach(p => {
                onTable.push(p.attack.value);
                if (p.defense) onTable.push(p.defense.value);
            });
            return onTable.includes(card.value);
        }

        // Рендер - объединение всех фаз
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (phase === 'intro') {
                ctx.globalAlpha = introFade;

                // Лазер 1: Формирование (Твое интро)
                if (step1 < spheres.length) {
                    let target = drawnItems[step1];
                    let tx = target.x * canvas.width, ty = target.y * canvas.height;
                    ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(l1.x, l1.y);
                    ctx.strokeStyle = 'var(--neon)'; ctx.lineWidth = 1; ctx.stroke();
                    l1.x += (tx - l1.x) * 0.08; l1.y += (ty - l1.y) * 0.08;
                    if (Math.abs(l1.x-tx)<2) { if (target.grow < 1) target.grow += 0.04; else step1++; }
                }

                // Лазер 2: Гравировка (Твое интро)
                if (active2 && step2 < spheres.length) {
                    let target = drawnItems[step2];
                    let tx = target.x * canvas.width, ty = target.y * canvas.height;
                    ctx.beginPath(); ctx.moveTo(canvas.width/2, canvas.height); ctx.lineTo(l2.x, l2.y);
                    ctx.strokeStyle = 'var(--gold)'; ctx.lineWidth = 1.5; ctx.stroke();
                    l2.x += (tx - l2.x) * 0.08; l2.y += (ty - l2.y) * 0.08;
                    if (Math.abs(l2.x-tx)<2) { if (target.ink < 1) target.ink += 0.03; else step2++; }
                }

                drawnItems.forEach(drawSphere);

                // Когда гравировка окончена - плавно уходим в игру
                if (step2 === spheres.length) {
                    status.innerText = "GLOBAL LOTTO POOL"; 
                    status.style.color = "var(--gold)";
                    setTimeout(() => { 
                        if (introFade > 0) {
                            introFade -= 0.03; 
                        } else {
                            phase = 'dealing';
                            initDeck();
                            logo.style.opacity = '0';
                            status.innerText = "DEALING CARDS...";
                            status.style.color = "var(--neon)";
                        }
                    }, 2500);
                }
                ctx.globalAlpha = 1.0;
            } else {
                // Фаза игры (Стол)
                drawTable();
            }
            requestAnimationFrame(render);
        }

        // Точка входа
        window.onload = () => {
            setTimeout(() => {
                logo.style.opacity = '1';
                status.innerText = "HELVETIC LUCK LOADING...";
                render(); 
                setTimeout(() => active2 = true, 3000); 
            }, 1000);
        };
        
        // Манифест Монолита: Код завершен. [cite: 2026-02-24]
    </script>
</body>
</html>
