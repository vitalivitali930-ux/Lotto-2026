<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lotto - –î–≤–∏–∂–æ–∫ VCHF 1.1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --main-color: #d4af37; 
            --main-gradient: linear-gradient(145deg, #f9e27d, #d4af37);
            --cell-text: #d4af37; 
            --hot-neon: #ff0000; 
            --cold-neon: #00f2ff; 
            --process-color: #00ffff; 
        }

        body { 
            background: #000 url('Hintergrund.png') no-repeat center center; 
            background-size: cover; color: #fff; 
            font-family: -apple-system, sans-serif; 
            text-align: center; margin: 0; overflow: hidden; 
        }

        #humor-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 30000;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #1a1a1a; border: 2px solid var(--main-color);
            width: 80%; padding: 25px; border-radius: 20px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            transform: scale(0.8); transition: 0.3s;
        }
        .modal-content.show { transform: scale(1); }
        .modal-title { font-size: 22px; color: var(--main-color); margin-bottom: 10px; font-weight: bold; }
        .modal-text { font-size: 16px; line-height: 1.4; margin-bottom: 20px; }
        .modal-btn { background: var(--main-gradient); border: none; padding: 10px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        .cell.is-hot, .super-cell.is-hot { 
            color: var(--hot-neon) !important; 
            text-shadow: 0 0 10px var(--hot-neon), 0 0 20px var(--hot-neon) !important;
            filter: brightness(1.5);
        }
        .cell.is-cold, .super-cell.is-cold { 
            color: var(--cold-neon) !important; 
            text-shadow: 0 0 10px var(--cold-neon), 0 0 20px var(--cold-neon) !important;
            filter: brightness(1.5);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¢–µ–ø–ª–æ–≤–æ–π –ö–∞—Ä—Ç—ã */
        .cell.heat-node {
            background: rgba(212, 175, 55, var(--heat-opacity)) !important;
            color: #fff !important;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(212, 175, 55, var(--heat-shadow));
        }

        #intro-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000 url('Hintergrund.png') no-repeat center center; 
            background-size: cover; z-index: 20000; 
            display: flex; justify-content: center; align-items: center;
        }
        .intro-img { position: absolute; width: 85%; opacity: 0; pointer-events: none; }
        .intro-img.active { animation: shakePop 0.7s ease-out forwards; }
        @keyframes shakePop { 0% { transform: scale(0.1); opacity: 0; } 50% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

        #app-content { display: none; opacity: 0; transition: opacity 1s ease; height: 100vh; overflow-y: auto; padding-top: 15px; }
        
        .lang-panel { display: flex; justify-content: center; gap: 12px; margin-bottom: 15px; }
        .lang-btn { font-size: 24px; cursor: pointer; }

        .balance-container { display: flex; gap: 10px; padding: 0 15px 15px; }
        .bal-card { 
            flex: 1; border-radius: 12px; padding: 12px; 
            background: rgba(15, 15, 15, 0.9); border: 1.5px solid #333; 
            transition: 0.4s ease; cursor: pointer; opacity: 0.3; filter: grayscale(1);
        }
        .bal-card.active-wallet { 
            opacity: 1; filter: grayscale(0); border-color: var(--main-color); 
            background: rgba(212, 175, 55, 0.08); box-shadow: 0 0 15px rgba(212, 175, 55, 0.15); transform: scale(1.03);
        }
        .bal-val { font-size: 20px; font-weight: bold; color: #32CD32; }

        .btn-topup, .btn-main { background: var(--main-gradient); color: #000; border: none; font-weight: bold; cursor: pointer; }
        .btn-topup { width: 85%; padding: 14px; border-radius: 10px; margin-bottom: 15px; }
        .btn-main { width: 85%; padding: 20px; border-radius: 15px; font-size: 18px; margin-top: 25px; margin-bottom: 50px; }

        .ticket-controls { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .smart-tools { display: flex; gap: 8px; margin-bottom: 5px; }
        .tool-btn { padding: 6px 12px; border-radius: 15px; border: 1px solid var(--main-color); background: rgba(0,0,0,0.6); color: #fff; font-size: 11px; cursor: pointer; }
        .tool-btn.active-hot { background: #ff0000; border-color: #fff; box-shadow: 0 0 10px #ff0000; }
        .tool-btn.active-cold { background: #00f2ff; border-color: #fff; box-shadow: 0 0 10px #00f2ff; }
        .tool-btn.active-heat { background: var(--main-color); color: #000; box-shadow: 0 0 10px var(--main-color); }
        
        .stats-period { display: flex; justify-content: center; gap: 5px; margin-top: 5px; opacity: 0; transition: 0.3s; pointer-events: none; }
        .stats-period.visible { opacity: 1; pointer-events: all; }
        .p-btn { font-size: 10px; padding: 3px 8px; border-radius: 10px; border: 1px solid #444; background: #222; color: #888; cursor: pointer; }
        .p-btn.active { border-color: var(--main-color); color: #fff; }

        .counter-box { display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px; }
        .btn-round { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--main-color); background: none; color: #fff; font-size: 18px; cursor: pointer; }

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; padding: 0 15px; max-width: 400px; margin: 0 auto; }
        .cell { background: transparent; border: none; padding: 12px 0; font-weight: bold; color: var(--cell-text); font-size: 20px; transition: 0.2s; cursor: pointer; }
        .cell.selected { background: var(--main-gradient); color: #000 !important; border-radius: 50%; }
        .cell.processing { background: var(--process-color); color: #000 !important; border-radius: 50%; box-shadow: 0 0 12px var(--process-color); transition: none; }

        .super-title { margin: 25px 0 10px; font-size: 14px; color: var(--main-color); font-weight: bold; }
        .super-grid { display: flex; justify-content: center; gap: 10px; }
        .super-cell { width: 42px; height: 42px; border: 2px solid var(--cell-text); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--cell-text); font-weight: bold; cursor: pointer; transition: 0.2s; }
        .super-cell.selected { background: var(--main-gradient); color: #000 !important; }

        .theme-toggle { position: fixed; top: 15px; right: 15px; font-size: 26px; z-index: 1001; cursor: pointer; }
        .theme-panel { position: fixed; top: 60px; right: 15px; display: flex; flex-direction: column; gap: 12px; z-index: 1000; background: rgba(0,0,0,0.9); padding: 12px; border-radius: 20px; border: 1px solid var(--main-color); transition: 0.3s; transform: translateX(80px); }
        .theme-panel.open { transform: translateX(0); }
        .dot { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; }
    </style>
</head>
<body>

<div id="humor-modal" onclick="closeHumor()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-title" id="m-title">Zahl</div>
        <div class="modal-text" id="m-text">...</div>
        <button class="modal-btn" onclick="closeHumor()">OK</button>
    </div>
</div>

<div id="intro-container">
    <img src="Bild1.png" id="intro1" class="intro-img">
    <img src="Bild2.png" id="intro2" class="intro-img">
    <img src="Bild3.png" id="intro3" class="intro-img">
</div>

<div id="app-content">
    <div class="lang-panel">
        <span class="lang-btn" onclick="setLang('ru')">üá∑üá∫</span>
        <span class="lang-btn" onclick="setLang('ua')">üá∫üá¶</span>
        <span class="lang-btn" onclick="setLang('de')">üá©üá™</span>
        <span class="lang-btn" onclick="setLang('fr')">üá´üá∑</span>
        <span class="lang-btn" onclick="setLang('it')">üáÆüáπ</span>
    </div>

    <div class="theme-toggle" onclick="document.querySelector('.theme-panel').classList.toggle('open')">üé®</div>
    <div class="theme-panel">
        <div class="dot" style="background: #d4af37;" onclick="setTheme('gold')"></div>
        <div class="dot" style="background: #32CD32;" onclick="setTheme('lime')"></div>
        <div class="dot" style="background: #c0c0c0;" onclick="setTheme('silver')"></div>
        <div class="dot" style="background: #00ffff;" onclick="setTheme('cyan')"></div>
        <div class="dot" style="background: #C511A4;" onclick="setTheme('cherry')"></div>
    </div>

    <div class="balance-container">
        <div class="bal-card active-wallet" id="card-vchf" onclick="switchCurrency('VCHF')">
            <div style="font-size:10px; color:var(--main-color)">VIRTUAL VCHF</div>
            <div class="bal-val" id="vchf-val">100.00</div>
        </div>
        <div class="bal-card" id="card-chf" onclick="switchCurrency('CHF')">
            <div style="font-size:10px; color:var(--main-color)">REAL CHF</div>
            <div class="bal-val" id="chf-val">0.00</div>
        </div>
    </div>
    
    <button class="btn-topup" id="topup-btn">üí∞ BALANCE AUFF√úLLEN</button>

    <div class="ticket-controls">
        <div class="smart-tools">
            <button class="tool-btn" onclick="toggleHeatmap('hot')" id="btn-hot">üî• HOT</button>
            <button class="tool-btn" onclick="toggleHeatmap('cold')" id="btn-cold">‚ùÑÔ∏è COLD</button>
            <button class="tool-btn" onclick="toggleHeatmap('heat')" id="btn-heat">üå°Ô∏è HEAT</button>
            <button class="tool-btn" onclick="randomFill()">üé≤ RANDOM</button>
        </div>
        <div class="stats-period" id="stats-p-box">
            <button class="p-btn active" onclick="setPeriod('month')" id="p-month">MONTH</button>
            <button class="p-btn" onclick="setPeriod('year')" id="p-year">YEAR</button>
            <button class="p-btn" onclick="setPeriod('all')" id="p-all">ALL TIME</button>
        </div>
        <div class="counter-box">
            <button class="btn-round" onclick="updateTicketCount(-1)">‚àí</button>
            <span id="ticket-count" style="font-size: 18px; font-weight: bold;">1</span>
            <button class="btn-round" onclick="updateTicketCount(1)">+</button>
        </div>
        <div style="font-size: 12px; color: #aaa;">TOTAL: <span id="total-price" style="color:#fff">2.50</span> <span id="currency-label">VCHF</span></div>
    </div>

    <div class="grid" id="main-grid"></div>
    <div id="l-super" class="super-title">SUPERZAHL</div>
    <div class="super-grid" id="s-grid"></div>
    <button class="btn-main" id="main-btn" onclick="runEngine()">TICKET BEST√ÑTIGEN</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const root = document.documentElement;

    const PREIS_PRO_TICKET = 2.50;
    let vchfBalance = 100.00;
    let chfBalance = 0.00;
    let ticketCount = 1;
    let selected = [];
    let superNum = null;
    let activeCurrency = 'VCHF';
    let isProcessing = false;
    let currentMode = null; 
    let currentPeriod = 'month';
    let prevStats = null;

    let dbStats = {
        month: { hot: [3, 11, 25, 29, 34, 42], cold: [1, 14, 20, 28, 33, 39], superHot: [5, 3], superCold: [2, 6], freq: {3: 5, 11: 4, 25: 4, 29: 3, 34: 3, 42: 3, 1: 0, 14: 0, 20: 0, 28: 0, 33: 0, 39: 0} },
        year:  { hot: [7, 18, 22, 31, 35, 41], cold: [4, 9, 15, 26, 30, 38], superHot: [1, 5], superCold: [4, 3], freq: {7: 54, 18: 51, 22: 48, 31: 46, 35: 43, 41: 42, 4: 11, 9: 9, 15: 7, 26: 6, 30: 4, 38: 2} },
        all:   { hot: [42, 12, 19, 1, 23, 37], cold: [2, 10, 17, 21, 32, 40], superHot: [3, 2], superCold: [6, 1], freq: {42: 492, 12: 478, 19: 465, 1: 459, 23: 451, 37: 447, 2: 112, 10: 105, 17: 98, 21: 92, 32: 85, 40: 71} }
    };

    const humorDict = {
        ru: { 
            all_hot: ["–ó–∞–π—á–∏–∫ ‚Äî —á–µ–º–ø–∏–æ–Ω –ø–æ –∫–∞–ø–∫–∞–Ω–∞–º!", "–ñ–µ–ª–µ–∑–Ω—ã–π –§–µ–ª–∏–∫—Å ‚Äî –≤ —Å—Ç—Ä–æ—é –≤—Å–µ–≥–¥–∞.", "–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ë–µ—Ä–Ω–∞.", "–ü–µ—Ä–≤—ã–π –ø–∞—Ä–µ–Ω—å –Ω–∞ –¥–µ—Ä–µ–≤–Ω–µ!", "–ú–∞–≥–Ω–∏—Ç –¥–ª—è —É–¥–∞—á–∏ ‚Äî –∫—Ä–∞—Å–∫–∞ —Å—Ç–µ—Ä–ª–∞—Å—å.", "–°—Ç–∞—Ö–∞–Ω–æ–≤–µ—Ü ‚Äî –ø–∞—à–µ—Ç –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö."], 
            all_cold: ["–ù–∞—Å—Ç–æ—è—â–∏–π –º–∞–º–æ–Ω—Ç ‚Äî –≤—ã–º–µ—Ä –¥–∞–≤–Ω–æ.", "–ë–µ—Ä–º—É–¥—Å–∫–∏–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ ‚Äî –ø—Ä–æ–ø–∞–ª.", "–ü—Ä–∏–∑—Ä–∞–∫ –æ–ø–µ—Ä—ã ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–µ–ª.", "–°–ø—è—â–∏–π –∫—Ä–∞—Å–∞–≤–µ—Ü ‚Äî —Å–ø–∏—Ç –≤–µ–∫.", "–°–∫—Ä–æ–º–Ω—ã–π –æ—Ç—à–µ–ª—å–Ω–∏–∫ –∏–∑ –ª–µ—Å–∞.", "–ó–∞–±—ã—Ç—ã–π –±–∞–≥–∞–∂ –Ω–∞ —Å–∫–ª–∞–¥–µ."], 
            new_hot: "üöÄ –£ –Ω–∞—Å –Ω–æ–≤—ã–π —á–µ–º–ø–∏–æ–Ω! –°–≤–µ–∂–∞—è –∫—Ä–æ–≤—å –≤ –∑–∞–ª–µ —Å–ª–∞–≤—ã!",
            new_cold: "üßä –ï—â–µ –æ–¥–∏–Ω –æ—Ç–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫!",
            times: "—Ä–∞–∑(–∞)", title: "–ß–∏—Å–ª–æ" 
        },
        ua: { 
            all_hot: ["–ó–∞–π—á–∏–∫ ‚Äî —á–µ–º–ø—ñ–æ–Ω –ø–æ –∫–∞–ø–∫–∞–Ω–∞—Ö!", "–ó–∞–ª—ñ–∑–Ω–∏–π –§–µ–ª—ñ–∫—Å ‚Äî –∑–∞–≤–∂–¥–∏ –≤ —Å—Ç—Ä–æ—é.", "–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ë–µ—Ä–Ω–∞.", "–ü–µ—Ä—à–∏–π —Ö–ª–æ–ø–µ—Ü—å –Ω–∞ —Å–µ–ª—ñ!", "–ú–∞–≥–Ω—ñ—Ç –¥–ª—è —É–¥–∞—á—ñ ‚Äî —Ñ–∞—Ä–±–∞ —Å—Ç–µ—Ä–ª–∞—Å—è.", "–°—Ç–∞—Ö–∞–Ω–æ–≤–µ—Ü—å ‚Äî –æ—Ä–µ –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–∏—Ö."], 
            all_cold: ["–°–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–º–æ–Ω—Ç ‚Äî –≤–∏–º–µ—Ä –¥–∞–≤–Ω–æ.", "–ë–µ—Ä–º—É–¥—Å—å–∫–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ ‚Äî –∑–Ω–∏–∫.", "–ü—Ä–∏–≤–∏–¥ –æ–ø–µ—Ä–∏ ‚Äî –Ω—ñ—Ö—Ç–æ –Ω–µ –±–∞—á–∏–≤.", "–°–ø–ª—è—á–∏–π –∫—Ä–∞—Å–µ–Ω—å ‚Äî —Å–ø–∏—Ç—å –≤—ñ–∫.", "–°–∫—Ä–æ–º–Ω–∏–π –≤—ñ–¥—à–µ–ª—å–Ω–∏–∫ –∑ –ª—ñ—Å—É.", "–ó–∞–±—É—Ç–∏–π –±–∞–≥–∞–∂ –Ω–∞ —Å–∫–ª–∞–¥—ñ."], 
            new_hot: "üöÄ –£ –Ω–∞—Å –Ω–æ–≤–∏–π —á–µ–º–ø—ñ–æ–Ω! –°–≤—ñ–∂–∞ –∫—Ä–æ–≤ —É –∑–∞–ª—ñ —Å–ª–∞–≤–∏!",
            new_cold: "üßä –©–µ –æ–¥–∏–Ω –≤—ñ–¥–º–æ—Ä–æ–∂–µ–Ω–∏–π! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞!",
            times: "—Ä–∞–∑(—ñ–≤)", title: "–ß–∏—Å–ª–æ" 
        },
        de: { 
            all_hot: ["Hase ‚Äî Champion in der Falle!", "Eiserner Felix ‚Äî immer im Dienst.", "Berns Goldstandard.", "Der Dorf√§lteste!", "Gl√ºcksmagnet ‚Äî Farbe ist ab.", "Stachanowez ‚Äî arbeitet ohne Pause."], 
            all_cold: ["Echtes Mammut ‚Äî l√§ngst ausgestorben.", "Bermuda-Dreieck ‚Äî verschwunden.", "Phantom der Oper ‚Äî nie gesehen.", "Dornr√∂schen ‚Äî schl√§ft ewig.", "Bescheidener Eremit aus dem Wald.", "Vergessenes Gep√§ck im Lager."], 
            new_hot: "üöÄ Ein neuer Champion! Frisches Blut in der Hall of Fame!",
            new_cold: "üßä Noch einer tiefgek√ºhlt! Willkommen im Eisschrank!",
            times: "Mal", title: "Zahl" 
        },
        fr: { 
            all_hot: ["Lapin ‚Äî champion du pi√®–≥–µ !", "F√©lix de fer ‚Äî toujours l√†.", "Standard d'or de Berne.", "Le beau gosse du village !", "Aimant √† chance ‚Äî peinture us√©e.", "Stakhanoviste ‚Äî travaille sans arr√™t."], 
            all_cold: ["Vrai mammouth ‚Äî disparu depuis peu.", "Triangle des Bermudes ‚Äî perdu.", "Fant√¥me de l'op√©ra ‚Äî jamais vu.", "Beau au bois dormant ‚Äî dort encore.", "Ermite modeste de la for√™t.", "Bagage oubli√© au d√©p√¥t."], 
            new_hot: "üöÄ Un nouveau champion ! Du sang neuf au Hall of Fame !",
            new_cold: "üßä Un altro givr√© ! Bienvenue au cong√©lateur !",
            times: "fois", title: "Nombre" 
        },
        it: { 
            all_hot: ["Coniglietto ‚Äî campione di trappole!", "Felix di ferro ‚Äî sempre in linea.", "Standard d'oro di Berna.", "Il pi√π bello del villaggio!", "Calamita per la fortuna.", "Stacanovista ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞."], 
            all_cold: ["Vero mammut ‚Äî estinto da tempo.", "Triangolo delle Bermuda ‚Äî sparito.", "Fantasma dell'opera ‚Äî mai visto.", "Bella addormentata ‚Äî dorme da un secolo.", "Eremita modesto del bosco.", "Bagaglio dimenticato in deposito."], 
            new_hot: "üöÄ Un nuovo campione! Sangue fresco nella Hall of Fame!",
            new_cold: "üßä Un altro congelato! Benvenuti nel freezer!",
            times: "volte", title: "Numero" 
        }
    };

    const dict = {
        ru: { btn: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", super: "–ë–û–ù–£–°–ù–û–ï –ß–ò–°–õ–û", topup: "üí∞ –ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°", alert: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±–∏–ª–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é!" },
        ua: { btn: "–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò", super: "–ë–û–ù–£–°–ù–ï –ß–ò–°–õ–û", topup: "üí∞ –ü–û–ü–û–í–ù–ò–¢–ò –ë–ê–õ–ê–ù–°", alert: "–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –∫–≤–∏—Ç–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é!" },
        de: { btn: "BEST√ÑTIGEN", super: "SUPERZAHL", topup: "üí∞ BALANCE AUFF√úLLEN", alert: "Ticket vollst√§ndig ausf√ºllen!" },
        fr: { btn: "CONFIRMER", super: "NOMBRE BONUS", topup: "üí∞ RECHARGER", alert: "Remplissez le ticket!" },
        it: { btn: "CONFERMA", super: "NUMERO BONUS", topup: "üí∞ RICARICA", alert: "Completa il biglietto!" }
    };
    let currentLang = 'de';

    async function syncSwissLotto() {
        try {
            prevStats = JSON.parse(JSON.stringify(dbStats)); 
            console.log("–î–≤–∏–∂–æ–∫ VCHF 1.1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ Swiss Lotto...");
            if(currentMode) refreshGrid();
        } catch(e) { console.error("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏"); }
    }

    function showCellInfo(n, isSuper = false) {
        const stats = dbStats[currentPeriod];
        const list = stats[currentMode];
        if (!list) return; // –î–ª—è heatmap –∏–Ω—Ñ–æ –ø–æ–∫–∞ –Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ

        const index = list.indexOf(n);
        if (index !== -1) {
            const langData = humorDict[currentLang] || humorDict['de'];
            let text = "";
            if (prevStats) {
                const wasInList = prevStats[currentPeriod][currentMode].includes(n);
                if (!wasInList) {
                    text = `<span style="color:var(--main-color); font-weight:bold;">${currentMode === 'hot' ? langData.new_hot : langData.new_cold}</span><br><br>`;
                }
            }
            const humorKey = (currentMode === 'hot') ? 'all_hot' : 'all_cold';
            text += langData[humorKey][index % langData[humorKey].length];
            document.getElementById('m-title').innerText = `${langData.title} ${n}${isSuper ? ' (Super)' : ''}`;
            document.getElementById('m-text').innerHTML = `${text}<br><br><b>${stats.freq[n] || 0} ${langData.times}</b>`;
            const modal = document.getElementById('humor-modal');
            modal.style.display = 'flex';
            setTimeout(() => modal.querySelector('.modal-content').classList.add('show'), 10);
            tg.HapticFeedback.impactOccurred('medium');
        }
    }

    function switchCurrency(type) {
        activeCurrency = type;
        document.getElementById('card-vchf').classList.toggle('active-wallet', type === 'VCHF');
        document.getElementById('card-chf').classList.toggle('active-wallet', type === 'CHF');
        document.getElementById('currency-label').innerText = type;
        tg.HapticFeedback.impactOccurred('medium');
    }

    function setLang(l) {
        currentLang = l;
        document.getElementById('main-btn').innerText = dict[l].btn;
        document.getElementById('l-super').innerText = dict[l].super;
        document.getElementById('topup-btn').innerText = dict[l].topup;
    }

    function toggleHeatmap(type) {
        const box = document.getElementById('stats-p-box');
        if (currentMode === type) {
            currentMode = null; box.classList.remove('visible');
        } else {
            currentMode = type; box.classList.add('visible');
        }
        
        document.getElementById('btn-hot').classList.toggle('active-hot', currentMode === 'hot');
        document.getElementById('btn-cold').classList.toggle('active-cold', currentMode === 'cold');
        document.getElementById('btn-heat').classList.toggle('active-heat', currentMode === 'heat');
        
        refreshGrid();
    }

    function setPeriod(p) {
        currentPeriod = p;
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`p-${p}`).classList.add('active');
        refreshGrid();
        tg.HapticFeedback.impactOccurred('light');
    }

    function refreshGrid() {
        document.querySelectorAll('.cell, .super-cell').forEach(c => {
            c.classList.remove('is-hot', 'is-cold', 'heat-node');
            c.style.setProperty('--heat-opacity', 0);
            c.style.setProperty('--heat-shadow', 0);
        });

        if (!currentMode) return;
        const stats = dbStats[currentPeriod];

        if (currentMode === 'heat') {
            const frequencies = Object.values(stats.freq);
            const maxFreq = Math.max(...frequencies);
            for (let n = 1; n <= 42; n++) {
                const f = stats.freq[n] || 0;
                const el = document.getElementById(`cell-${n}`);
                if (el && f > 0) {
                    const intensity = (f / maxFreq) * 0.8;
                    el.classList.add('heat-node');
                    el.style.setProperty('--heat-opacity', intensity);
                    el.style.setProperty('--heat-shadow', intensity / 2);
                }
            }
        } else {
            const list = stats[currentMode];
            list.forEach(n => {
                const el = document.getElementById(`cell-${n}`);
                if (el) el.classList.add(currentMode === 'hot' ? 'is-hot' : 'is-cold');
            });
            const sList = (currentMode === 'hot') ? stats.superHot : stats.superCold; 
            const sCells = document.querySelectorAll('.super-cell');
            sList.forEach(sn => { if (sCells[sn-1]) sCells[sn-1].classList.add(currentMode === 'hot' ? 'is-hot' : 'is-cold'); });
        }
    }

    function closeHumor() {
        const modal = document.getElementById('humor-modal');
        modal.querySelector('.modal-content').classList.remove('show');
        setTimeout(() => modal.style.display = 'none', 300);
    }

    function randomFill() {
        if (isProcessing) return; isProcessing = true;
        const cells = document.querySelectorAll('.cell');
        const superCells = document.querySelectorAll('.super-cell');
        let iteration = 0; const totalSteps = 24; let currentDelay = 50;
        function step() {
            cells.forEach(c => c.classList.remove('selected', 'processing'));
            superCells.forEach(sc => sc.classList.remove('selected'));
            for(let i = 0; i < 6; i++) {
                let r = Math.floor(Math.random() * 42) + 1;
                document.getElementById(`cell-${r}`).classList.add('processing');
            }
            tg.HapticFeedback.impactOccurred('light');
            iteration++;
            if (iteration < totalSteps) { setTimeout(step, currentDelay); } else { finalize(); }
        }
        function finalize() {
            selected = []; cells.forEach(c => c.classList.remove('selected', 'processing'));
            while(selected.length < 6) {
                let r = Math.floor(Math.random() * 42) + 1;
                if(!selected.includes(r)) { selected.push(r); document.getElementById(`cell-${r}`).classList.add('selected'); }
            }
            superNum = Math.floor(Math.random() * 6) + 1;
            superCells[superNum-1].classList.add('selected');
            isProcessing = false; tg.HapticFeedback.notificationOccurred('success');
        }
        step();
    }

    const gridDiv = document.getElementById('main-grid');
    for (let i = 1; i <= 42; i++) {
        const c = document.createElement('div'); c.className = 'cell'; c.id = `cell-${i}`; c.innerText = i;
        c.onclick = () => {
            if(isProcessing) return;
            if(currentMode && (currentMode !== 'heat') && (c.classList.contains('is-hot') || c.classList.contains('is-cold'))) showCellInfo(i);
            if(selected.includes(i)) { selected = selected.filter(n => n !== i); c.classList.remove('selected'); }
            else if(selected.length < 6) { selected.push(i); c.classList.add('selected'); tg.HapticFeedback.impactOccurred('light'); }
        };
        gridDiv.appendChild(c);
    }

    const sGridDiv = document.getElementById('s-grid');
    for (let i = 1; i <= 6; i++) {
        const sc = document.createElement('div'); sc.className = 'super-cell'; sc.innerText = i;
        sc.onclick = () => {
            if(isProcessing) return;
            if(currentMode && (currentMode !== 'heat') && (sc.classList.contains('is-hot') || sc.classList.contains('is-cold'))) showCellInfo(i, true);
            document.querySelectorAll('.super-cell').forEach(x => x.classList.remove('selected'));
            superNum = i; sc.classList.add('selected'); tg.HapticFeedback.impactOccurred('medium');
        };
        sGridDiv.appendChild(sc);
    }

    function runEngine() {
        if (selected.length !== 6 || !superNum) { tg.showAlert(dict[currentLang].alert); return; }
        let total = ticketCount * PREIS_PRO_TICKET;
        let balance = (activeCurrency === 'VCHF') ? vchfBalance : chfBalance;
        if (balance >= total) {
            if (activeCurrency === 'VCHF') { vchfBalance -= total; document.getElementById('vchf-val').innerText = vchfBalance.toFixed(2); }
            else { chfBalance -= total; document.getElementById('chf-val').innerText = chfBalance.toFixed(2); }
            document.getElementById('app-content').style.pointerEvents = 'none';
            const btn = document.getElementById('main-btn');
            btn.disabled = true; btn.innerText = "FIXIERT (19:15)"; btn.style.background = "#444";
            tg.showAlert(`Ticket fixiert via ${activeCurrency}!`);
        } else { tg.showAlert(`Insufficient balance!`); }
    }

    function runIntro() {
        const steps = [{id:'intro1',s:500,e:2500},{id:'intro2',s:2700,e:4700},{id:'intro3',s:4900,e:6900}];
        steps.forEach(st => {
            setTimeout(() => document.getElementById(st.id).classList.add('active'), st.s);
            setTimeout(() => { document.getElementById(st.id).classList.remove('active'); document.getElementById(st.id).style.opacity='0'; }, st.e);
        });
        setTimeout(() => {
            document.getElementById('intro-container').style.display='none';
            const app = document.getElementById('app-content');
            app.style.display='block'; setTimeout(() => app.style.opacity='1', 50);
            syncSwissLotto(); 
        }, 7500);
    }
    window.onload = runIntro;

    function setTheme(t) {
        document.body.className = 'theme-' + t;
        const colors = {
            gold: ['#d4af37', 'linear-gradient(145deg, #f9e27d, #d4af37)'],
            lime: ['#32CD32', 'linear-gradient(145deg, #7FFF00, #32CD32)'],
            silver: ['#c0c0c0', 'linear-gradient(145deg, #ffffff, #c0c0c0)'],
            cyan: ['#00ffff', 'linear-gradient(145deg, #e0ffff, #00ffff)'],
            cherry: ['#C511A4', 'linear-gradient(145deg, #FF1493, #C511A4)']
        }
        root.style.setProperty('--main-color', colors[t][0]);
        root.style.setProperty('--main-gradient', colors[t][1]);
        root.style.setProperty('--cell-text', colors[t][0]);
        document.querySelector('.theme-panel').classList.remove('open');
    }

    function updateTicketCount(val) {
        let newCount = ticketCount + val;
        if(newCount >= 1) {
            ticketCount = newCount;
            document.getElementById('ticket-count').innerText = ticketCount;
            document.getElementById('total-price').innerText = (ticketCount * PREIS_PRO_TICKET).toFixed(2);
        }
    }
</script>
</body>
</html>
