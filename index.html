<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VCHF Monolith v.1.6 - Smart Corner</title>
    <style>
        :root {
            --vchf-gold: #ffd700;
            --vchf-red: #ff3e3e;
            --vchf-black: #050505;
            --glass-border: rgba(255, 215, 0, 0.4);
            --card-width: 75px;
            --card-height: 110px;
            --corner-size: 35px; /* –†–∞–∑–º–µ—Ä –∑–æ–Ω—ã –ø–æ–¥ –ø–∞–ª–µ—Ü [cite: 2026-02-19] */
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; color: #fff; font-family: 'Inter', sans-serif;
            overflow: hidden; touch-action: none;
        }

        #app-monolith {
            position: relative; width: 100vw; height: 100vh;
            background: radial-gradient(circle at center, #1a0505 0%, #000 100%);
            display: flex; flex-direction: column;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –ó–û–ù–ê --- */
        #top-header {
            height: 15%; width: 100%; display: flex; 
            justify-content: space-between; padding: 10px; z-index: 50;
        }

        #trump-totem-display {
            font-size: 50px; font-weight: 900;
            filter: drop-shadow(0 0 10px var(--vchf-gold));
        }

        #enemy-hand-preview {
            display: flex; perspective: 1000px; height: 60px;
        }

        /* --- –ü–û–õ–ï –ë–ò–¢–í–´ --- */
        #battle-field {
            flex-grow: 1; position: relative; width: 100%;
            display: flex; align-items: center; justify-content: center;
        }

        #cards-on-table {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 10px; width: 90%; max-width: 400px;
        }

        /* --- –ë–£–¢–û–ù: SMART CORNER STACK [cite: 2026-02-27] --- */
        #vchf-player-zone {
            position: absolute; bottom: 0; width: 100%; height: 45%;
            border-top: 1px solid var(--glass-border);
            background: linear-gradient(to top, #000 80%, transparent);
            z-index: 1000;
        }

        #fan-container-radial {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 90px;
        }

        /* --- –ö–ê–†–¢–ê v.1.6 --- */
        .vchf-card {
            width: var(--card-width);
            height: var(--card-height);
            background: #fff;
            border-radius: 6px;
            position: absolute;
            bottom: 40px;
            color: #000;
            font-weight: 900;
            box-shadow: -2px 0 5px rgba(0,0,0,0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom center;
            cursor: pointer;
            user-select: none;
        }

        /* –£–≥–æ–ª–æ–∫ –ø–æ–¥ –ø–∞–ª–µ—Ü (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä) [cite: 2026-02-19] */
        .vchf-card::before {
            content: attr(data-label);
            position: absolute; top: 0; left: 0;
            width: var(--corner-size); height: var(--corner-size);
            background: rgba(255,215,0,0.1);
            border-bottom-right-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: inherit;
        }

        .vchf-card.red-suit { color: var(--vchf-red); }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ: –í—Å–ø–ª—ã–ª–∞ (Preview) [cite: 2026-02-27] */
        .vchf-card.preview {
            z-index: 5000 !important;
            transform: translateY(-80px) scale(1.4) !important;
            box-shadow: 0 0 30px var(--vchf-gold);
            border: 2px solid var(--vchf-gold);
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ: –°–∫—Ä—ã—Ç–∞ (–¥—Ä—É–≥–æ–π –∫–∞—Ä—Ç–æ–π) */
        .vchf-card.dimmed {
            filter: brightness(0.5);
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–∏–∑—É [cite: 2026-02-19] */
        #action-controls {
            position: absolute; bottom: 15px; width: 100%;
            display: flex; justify-content: space-evenly; z-index: 5500;
        }

        .btn-vchf {
            width: 40%; padding: 15px; border-radius: 12px;
            background: #000; color: var(--vchf-gold);
            border: 2px solid var(--vchf-gold); font-weight: 900;
            letter-spacing: 2px; text-transform: uppercase;
        }

        .btn-vchf:active { background: var(--vchf-gold); color: #000; }

        #timer-line {
            position: absolute; top: 0; left: 0; height: 4px;
            width: 100%; background: var(--vchf-gold);
            transition: width 0.1s linear;
        }

        /* –†–ò–¢–£–ê–õ */
        #ritual-screen {
            position: fixed; inset: 0; background: #000;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; z-index: 9999;
        }
        #ritual-symbol { font-size: 100px; color: var(--vchf-gold); }
    </style>
</head>
<body>

<div id="app-monolith">
    <div id="ritual-screen">
        <div id="ritual-symbol">‚öì</div>
        <div style="color:var(--vchf-gold); letter-spacing: 5px;">VCHF MACHINE</div>
    </div>

    <div id="top-header">
        <div id="trump-totem-display"></div>
        <div id="enemy-hand-preview"></div>
    </div>

    <div id="battle-field">
        <div id="cards-on-table"></div>
    </div>

    <div id="vchf-player-zone">
        <div id="timer-line"></div>
        <div id="fan-container-radial"></div>
        
        <div id="action-controls">
            <button class="btn-vchf" id="btn-take">–í–ó–Ø–¢–¨</button>
            <button class="btn-vchf" id="btn-pass">–ë–ò–¢–û</button>
        </div>
    </div>
</div>
<script>
    /* VCHF ENGINE v.1.6 
       ANCHOR: SMART_CORNER_UX
       AGENT: SPARK (Wanderer Protocol)
    */

    const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
    const RANKS = ['6','7','8','9','10','J','Q','K','A'];
    const VALS = {'6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14};

    let pHand = [], eHand = [], field = [];
    let trumpSuit = '', activeIdx = null, isBlocked = false;
    let timerInterval = null, timeLeft = 30;

    // --- –ò–ù–ò–¶–ò–ê–¶–ò–Ø (–ë–ï–ó –ü–û–í–¢–û–†–û–í) ---
    function startRitual() {
        const symbol = document.getElementById('ritual-symbol');
        const screen = document.getElementById('ritual-screen');
        let i = 0;
        
        const interval = setInterval(() => {
            const s = SUITS[i % 4];
            symbol.innerText = s;
            symbol.style.color = (s === '‚ô•' || s === '‚ô¶') ? 'var(--vchf-red)' : 'var(--vchf-gold)';
            i++;
            if(i > 20) {
                clearInterval(interval);
                trumpSuit = s;
                document.getElementById('trump-totem-display').innerText = trumpSuit;
                document.getElementById('trump-totem-display').style.color = (s === '‚ô•' || s === '‚ô¶') ? 'var(--vchf-red)' : 'var(--vchf-gold)';
                screen.style.opacity = '0';
                setTimeout(() => { screen.style.display = 'none'; initMonolithGame(); }, 600);
            }
        }, 100);
    }

    function initMonolithGame() {
        let deck = [];
        // ANTI_CHAMELEON: –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∫–∞—Ä—Ç –æ–¥–∏–Ω —Ä–∞–∑ [cite: 2026-02-22]
        SUITS.forEach(s => {
            RANKS.forEach(r => {
                deck.push({ s, r, v: VALS[r], id: `card-${s}-${r}-${Math.random()}` });
            });
        });

        deck.sort(() => Math.random() - 0.5);
        pHand = deck.splice(0, 18);
        eHand = deck.splice(0, 18);
        
        sortHandBySectors(pHand);
        renderVCHF();
    }

    function sortHandBySectors(hand) {
        hand.sort((a, b) => {
            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–∞—Å—Ç—è–º –¥–ª—è —Å–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –≤–µ–µ—Ä–∞ [cite: 2026-02-27]
            if (a.s !== b.s) return SUITS.indexOf(a.s) - SUITS.indexOf(b.s);
            return a.v - b.v;
        });
    }

    // --- –†–ï–ù–î–ï–†–ò–ù–ì: SMART CORNER STACK ---
    function renderVCHF() {
        const container = document.getElementById('fan-container-radial');
        container.innerHTML = '';
        
        const total = pHand.length;
        const arcSpread = 80; // –û–±—â–∏–π —É–≥–æ–ª –≤–µ–µ—Ä–∞
        const step = arcSpread / (total > 1 ? total - 1 : 1);
        const radius = 300;

        pHand.forEach((card, i) => {
            const el = document.createElement('div');
            el.className = 'vchf-card';
            if (card.s === '‚ô•' || card.s === '‚ô¶') el.classList.add('red-suit');
            
            // –ó–∞—Ä—É–±–∫–∞: –ú–µ—Ç–∫–∞ –¥–ª—è —É–≥–ª–∞ (–º–∞—Å—Ç—å + —Ä–∞–Ω–≥) [cite: 2026-02-27]
            el.setAttribute('data-label', `${card.r}${card.s}`);
            el.innerHTML = `<div style="padding: 10px">${card.r}<br>${card.s}</div>`;
            
            // –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ (–†–∞–¥–∏–∞–ª—å–Ω—ã–π –°—Ç–µ–∫)
            const angle = -arcSpread/2 + (i * step);
            const x = Math.sin(angle * Math.PI / 180) * radius;
            const y = (1 - Math.cos(angle * Math.PI / 180)) * radius;

            el.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
            el.style.zIndex = 100 + i;

            // –õ–æ–≥–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π [cite: 2026-02-27]
            if (activeIdx === i) {
                el.classList.add('preview');
            } else if (activeIdx !== null) {
                el.classList.add('dimmed');
            }

            el.onclick = (e) => {
                e.stopPropagation();
                handleSmartTap(i);
            };

            container.appendChild(el);
        });

        renderEnemyPreview();
        renderBattlefield();
    }

    function handleSmartTap(idx) {
        if (isBlocked) return;
        
        if (activeIdx === idx) {
            // –í—Ç–æ—Ä–æ–π —Ç–∞–ø ‚Äî –•–æ–¥ [cite: 2026-02-27]
            makeMove(idx);
        } else {
            // –ü–µ—Ä–≤—ã–π —Ç–∞–ø ‚Äî –í—Å–ø–ª—ã—Ç–∏–µ (Preview)
            activeIdx = idx;
            renderVCHF();
        }
    }

    // –¢–∞–ø –º–∏–º–æ ‚Äî –°–ø—Ä—è—Ç–∞—Ç—å –∫–∞—Ä—Ç—É (–ò–Ω—Å—Ç–∏–Ω–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ) [cite: 2026-02-27]
    document.addEventListener('click', () => {
        if (activeIdx !== null) {
            activeIdx = null;
            renderVCHF();
        }
    });
    // --- –õ–û–ì–ò–ö–ê –ë–û–Ø (WINDOW 3) ---

    function makeMove(idx) {
        const card = pHand.splice(idx, 1)[0];
        field.push(card);
        activeIdx = null;
        isBlocked = true;

        renderVCHF();
        stopGlobalTimer();

        // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–∑–¥—É–º–∏–π –ò–ò (2-5 —Å–µ–∫) [cite: 2026-02-23]
        setTimeout(aiResponse, 1000 + Math.random() * 2000);
    }

    function aiResponse() {
        if (field.length % 2 !== 0) {
            const toBeat = field[field.length - 1];
            
            // –ü–æ–∏—Å–∫ –∑–∞—â–∏—Ç—ã
            let options = eHand.filter(c => 
                (c.s === toBeat.s && c.v > toBeat.v) || 
                (c.s === trumpSuit && toBeat.s !== trumpSuit)
            );
            options.sort((a, b) => a.v - b.v);

            // 15% –®–∞–Ω—Å –æ—à–∏–±–∫–∏ –ò–ò (–±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—ã –¥–∞–∂–µ –µ—Å–ª–∏ –º–æ–∂–µ—Ç –±–∏—Ç—å) [cite: 2026-02-22]
            const isStupid = Math.random() < 0.15;

            if (options.length > 0 && !isStupid) {
                const defCard = options[0];
                eHand.splice(eHand.indexOf(defCard), 1);
                field.push(defCard);
            } else {
                eHand.push(...field);
                field = [];
            }
        }
        
        isBlocked = false;
        renderVCHF();
        checkWin();
        if (field.length === 0) aiAttack(); // –ò–ò –∞—Ç–∞–∫—É–µ—Ç, –µ—Å–ª–∏ –æ—Ç–±–∏–ª—Å—è –∏–ª–∏ –≤–∑—è–ª
        startGlobalTimer();
    }

    function aiAttack() {
        if (eHand.length === 0) return;
        
        // –í—ã–±–æ—Ä —Å–ª–∞–±–æ–π –∫–∞—Ä—Ç—ã
        eHand.sort((a, b) => a.v - b.v);
        field.push(eHand.shift());
        renderVCHF();
    }

    // --- –ò–ù–¢–ï–†–§–ï–ô–° –£–ü–†–ê–í–õ–ï–ù–ò–Ø ---

    document.getElementById('btn-take').onclick = () => {
        if (field.length === 0 || isBlocked) return;
        pHand.push(...field);
        field = [];
        sortHandBySectors(pHand);
        isBlocked = true;
        renderVCHF();
        setTimeout(aiAttack, 1000);
    };

    document.getElementById('btn-pass').onclick = () => {
        if (field.length === 0 || field.length % 2 !== 0 || isBlocked) return;
        field = [];
        renderVCHF();
        checkWin();
        startGlobalTimer();
    };

    // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---

    function renderBattlefield() {
        const grid = document.getElementById('cards-on-table');
        grid.innerHTML = '';
        field.forEach(c => {
            const cardEl = document.createElement('div');
            cardEl.className = 'vchf-card';
            cardEl.style.position = 'relative';
            cardEl.style.bottom = '0';
            cardEl.style.transform = 'none';
            if (c.s === '‚ô•' || c.s === '‚ô¶') cardEl.classList.add('red-suit');
            cardEl.innerHTML = `<div style="padding:10px">${c.r}<br>${c.s}</div>`;
            grid.appendChild(cardEl);
        });
    }

    function renderEnemyPreview() {
        const container = document.getElementById('enemy-hand-preview');
        container.innerHTML = '';
        eHand.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.style.width = '8px';
            dot.style.height = '8px';
            dot.style.background = 'var(--vchf-gold)';
            dot.style.borderRadius = '50%';
            dot.style.margin = '2px';
            dot.style.opacity = '0.6';
            container.appendChild(dot);
        });
    }

    // --- –¢–ê–ô–ú–ï–† –°–í–ï–¢–û–§–û–† ---

    function startGlobalTimer() {
        clearInterval(timerInterval);
        timeLeft = 30;
        const line = document.getElementById('timer-line');
        
        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            let prc = (timeLeft / 30) * 100;
            line.style.width = prc + '%';
            
            if (prc > 50) line.style.background = '#2ecc71';
            else if (prc > 20) line.style.background = 'gold';
            else line.style.background = 'var(--vchf-red)';

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                (field.length % 2 !== 0) ? document.getElementById('btn-take').click() : document.getElementById('btn-pass').click();
            }
        }, 100);
    }

    function stopGlobalTimer() { clearInterval(timerInterval); }

    function checkWin() {
        if (pHand.length === 0) endGame("WANDERER –ü–û–ë–ï–î–ò–õ");
        else if (eHand.length === 0) endGame("–ò–ò –ó–ê–•–í–ê–¢–ò–õ –ú–û–ù–û–õ–ò–¢");
    }

    function endGame(msg) {
        const screen = document.getElementById('ritual-screen');
        screen.style.display = 'flex';
        screen.style.opacity = '1';
        document.getElementById('ritual-symbol').innerText = 'üîö';
        screen.innerHTML += `<div style="color:white; margin-top:20px">${msg}</div>`;
        setTimeout(() => location.reload(), 5000);
    }

    window.onload = startRitual;

</script>
</body>
</html>
