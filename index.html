<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Entropy Zone | VCHF Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=JetBrains+Mono:wght@300;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --cherry: radial-gradient(circle, #800020 0%, #050505 100%); }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'JetBrains Mono'; }

        /* Зона стола - теперь кликабельна на 100% */
        #entropy-table {
            position: relative; width: 100vw; height: 55vh;
            background: var(--cherry); display: flex; justify-content: center; align-items: center;
            z-index: 10; /* Стол ниже рук, но карты выше фона */
        }

        .card-vchf {
            position: absolute; width: 60px; height: 85px;
            background: #111; border: 1px solid var(--gold); border-radius: 5px;
            z-index: 20; cursor: pointer; transform-origin: center;
            transition: all 0.4s ease;
        }

        /* Бутон - снижаем высоту, чтобы не мешал столу */
        #player-hand-container {
            position: absolute; bottom: 0; width: 100%; height: 45vh;
            background: linear-gradient(to top, #000 70%, transparent);
            z-index: 100; pointer-events: none; /* Пропускаем клики сквозь пустые места */
            display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 10px;
        }

        .suit-lane { 
            height: 40px; width: 100%; position: relative; 
            display: flex; justify-content: center; pointer-events: auto; 
        }

        .suit-lane.active-lane { height: 120px; z-index: 1000; }

        .hand-card {
            position: absolute; width: 50px; height: 75px;
            background: #fff; border: 1px solid var(--gold); border-radius: 4px;
            font-family: 'Orbitron'; font-size: 12px; padding: 4px;
            box-shadow: -2px 0 5px rgba(0,0,0,0.5); transition: 0.3s;
        }

        .active-lane .hand-card { width: 65px; height: 95px; font-size: 18px; margin-top: -20px; }

        #ready-btn {
            position: absolute; bottom: 20px; right: 20px;
            padding: 12px 30px; background: #000; border: 2px solid var(--gold);
            color: var(--gold); font-family: 'Orbitron'; font-weight: 900;
            border-radius: 5px; opacity: 0; transition: 1s; z-index: 2000;
        }
        #ready-btn.visible { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body>

<div id="entropy-table">
    <div id="table-cards"></div>
</div>

<div id="player-hand-container">
    <div class="suit-lane" id="lane-0" onclick="toggleLane(0)"></div>
    <div class="suit-lane" id="lane-1" onclick="toggleLane(1)"></div>
    <div class="suit-lane" id="lane-2" onclick="toggleLane(2)"></div>
    <div class="suit-lane" id="lane-3" onclick="toggleLane(3)"></div>
</div>

<button id="ready-btn" onclick="alert('Ритуал Начат')">ГОТОВ ✅</button>

<script>
const suits = ['♠', '♣', '♥', '♦'];
const ranks = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
let playerHand = [[], [], [], []];
let activeLaneIdx = null;

setTimeout(() => document.getElementById('ready-btn').classList.add('visible'), 2000);

function setupTable() {
    const container = document.getElementById('table-cards');
    let deck = [];
    suits.forEach(s => ranks.forEach(r => deck.push({suit: s, rank: r})));
    deck = deck.sort(() => Math.random() - 0.5);

    // Центрируем Хаос: радиус меньше, чтобы не лезло на кнопки
    const radius = Math.min(window.innerWidth, window.innerHeight) * 0.22;
    deck.forEach((card, i) => {
        const c = document.createElement('div');
        c.className = 'card-vchf';
        const angle = (i * 10) * (Math.PI / 180);
        c.style.left = `calc(50% - 30px + ${Math.cos(angle)*radius}px)`;
        c.style.top = `calc(50% - 42px + ${Math.sin(angle)*radius}px)`;
        c.style.transform = `rotate(${i*10}deg)`;
        c.onclick = (e) => { e.stopPropagation(); pickCard(card, c); };
        container.appendChild(c);
    });
}

function pickCard(card, el) {
    let laneIdx = suits.indexOf(card.suit);
    playerHand[laneIdx].push(card);
    el.remove(); // Удаляем физически, чтобы не висело в памяти
    renderLanes();
}

function toggleLane(idx) {
    activeLaneIdx = (activeLaneIdx === idx) ? null : idx;
    renderLanes();
}

function renderLanes() {
    for (let i = 0; i < 4; i++) {
        const lane = document.getElementById(`lane-${i}`);
        lane.className = `suit-lane ${activeLaneIdx === i ? 'active-lane' : ''}`;
        lane.innerHTML = '';
        playerHand[i].forEach((card, idx) => {
            const cEl = document.createElement('div');
            cEl.className = 'hand-card';
            cEl.style.color = (card.suit==='♥'||card.suit==='♦') ? '#e30a17' : '#000';
            cEl.innerHTML = `<div>${card.rank}</div><div style="text-align:right">${card.suit}</div>`;
            const step = activeLaneIdx === i ? 35 : 15; // Плотная упаковка
            cEl.style.left = `calc(50% - 25px + ${(idx - (playerHand[i].length-1)/2)*step}px)`;
            lane.appendChild(cEl);
        });
    }
}
setupTable();
</script>
</body>
</html>
