<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Lotto: Durak Engine VCHF (Test Build)</title>
    <style>
        /* * Project: Lotto (Bi-Turbo Ultimate)
         * Style: Dark Luxury (Monolith Concept)
         * Author: Spark (Gemini 3 Flash)
         */
        body {
            background: #0f0f0f;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        #game-container {
            width: 90%;
            max-width: 800px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .card {
            width: 60px;
            height: 90px;
            background: #fff;
            color: #000;
            border-radius: 8px;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(255,215,0,0.3);
        }
        .card.red { color: #d32f2f; }
        .card.cpu { background: #333; border: 1px solid #555; color: transparent; }
        
        #table {
            min-height: 120px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #888;
        }
        button {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover { background: #ffea00; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="status-bar">
        <span>Проект: <b>ЛОТТО</b></span>
        <span>Баланс: <b id="balance">1000</b> VCHF</span>
        <span>Козырь: <span id="trump-indicator">?</span></span>
    </div>

    <div id="cpu-hand-ui" style="text-align: center;"></div>
    
    <div id="table">
        </div>

    <div id="player-hand-ui" style="text-align: center;"></div>
    
    <div style="text-align: center; margin-top: 20px;">
        <button onclick="game.takeCards()">Взять / Бито</button>
        <p id="msg" style="color: #ffd700; min-height: 24px;"></p>
    </div>
</div>

<script>
/**
 * Anchor: warten und erwarten
 * Memory: Logic integrated from Window 1
 */

const CONFIG = {
    suits: { '♠': 'black', '♣': 'black', '♦': 'red', '♥': 'red' },
    ranks: ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A']
};

class DurakGitHubTest {
    constructor() {
        this.deck = [];
        this.playerHand = [];
        this.cpuHand = [];
        this.table = [];
        this.trump = null;
        this.isPlayerTurn = true;
        this.init();
    }

    init() {
        this.deck = [];
        Object.keys(CONFIG.suits).forEach(suit => {
            CONFIG.ranks.forEach((rank, i) => {
                this.deck.push({ suit, rank, value: i, color: CONFIG.suits[suit] });
            });
        });
        this.shuffle();
        this.trump = this.deck[0];
        this.deal();
        this.updateUI();
    }

    shuffle() {
        for (let i = this.deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
        }
    }

    deal() {
        while (this.playerHand.length < 6 && this.deck.length > 0) this.playerHand.push(this.deck.pop());
        while (this.cpuHand.length < 6 && this.deck.length > 0) this.cpuHand.push(this.deck.pop());
    }

    playCard(index) {
        const card = this.playerHand[index];
        // Простая проверка: можно ли ходить (для теста разрешаем всё первым ходом)
        this.table.push({ attack: card, defense: null });
        this.playerHand.splice(index, 1);
        this.updateUI();
        
        setTimeout(() => this.cpuDefense(), 800);
    }

    cpuDefense() {
        const attack = this.table[this.table.length - 1].attack;
        // Обученный ИИ: ищет минимальную карту для защиты
        let defense = this.cpuHand.filter(c => {
            if (c.suit === attack.suit) return c.value > attack.value;
            if (c.suit === this.trump.suit && attack.suit !== this.trump.suit) return true;
            return false;
        }).sort((a, b) => a.value - b.value)[0];

        if (defense) {
            this.table[this.table.length - 1].defense = defense;
            this.cpuHand = this.cpuHand.filter(c => c !== defense);
            document.getElementById('msg').innerText = "Компьютер отбился!";
        } else {
            document.getElementById('msg').innerText = "Компьютер берет карты.";
            this.cpuHand.push(...this.table.flatMap(p => [p.attack, p.defense].filter(x => x)));
            this.table = [];
            this.deal();
        }
        this.updateUI();
    }

    takeCards() {
        // Логика завершения хода
        this.table = [];
        this.deal();
        this.updateUI();
        document.getElementById('msg').innerText = "Новый кон.";
    }

    updateUI() {
        document.getElementById('trump-indicator').innerText = `${this.trump.rank}${this.trump.suit}`;
        document.getElementById('trump-indicator').style.color = this.trump.color === 'red' ? '#ff4d4d' : '#fff';
        
        const pHand = document.getElementById('player-hand-ui');
        pHand.innerHTML = this.playerHand.map((c, i) => `
            <div class="card ${c.color}" onclick="game.playCard(${i})">
                <span>${c.rank}</span><span>${c.suit}</span>
            </div>
        `).join('');

        const cHand = document.getElementById('cpu-hand-ui');
        cHand.innerHTML = this.cpuHand.map(() => `<div class="card cpu"></div>`).join('');

        const tDiv = document.getElementById('table');
        tDiv.innerHTML = this.table.map(pair => `
            <div style="position: relative; width: 80px; height: 110px;">
                <div class="card ${pair.attack.color}" style="position: absolute; z-index: 1;">${pair.attack.rank}<br>${pair.attack.suit}</div>
                ${pair.defense ? `<div class="card ${pair.defense.color}" style="position: absolute; z-index: 2; left: 15px; top: 15px;">${pair.defense.rank}<br>${pair.defense.suit}</div>` : ''}
            </div>
        `).join('');
    }
}

const game = new DurakGitHubTest();
</script>
</body>
</html>
