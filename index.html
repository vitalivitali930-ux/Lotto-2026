<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Round Durak - Chaos Ritual</title>
    <style>
        :root {
            --vchf-gold: #FFD700;
            --card-w: 70px; /* Увеличил масштаб */
            --card-h: 105px;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            background: #020202; color: white; 
            font-family: 'Inter', sans-serif; overflow: hidden; 
        }

        #table {
            position: relative;
            width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            perspective: 1000px;
        }

        /* Карты на столе - Хаотичный круг */
        .card-on-table {
            position: absolute;
            width: var(--card-w);
            height: var(--card-h);
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            /* Центрирование для вращения */
            left: calc(50% - var(--card-w)/2);
            top: calc(50% - var(--card-h)/2);
        }

        .card-on-table:hover {
            border-color: var(--vchf-gold);
            z-index: 500 !important;
            transform: scale(1.1) !important;
        }

        /* Индикаторы */
        #trump-indicator {
            position: absolute;
            top: 25px; right: 25px;
            font-size: 56px; /* Крупнее */
            width: 90px; height: 90px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,215,0,0.2);
            border-radius: 15px;
            z-index: 1000;
        }

        #turn-light {
            position: absolute;
            top: 30px; left: 50%; transform: translateX(-50%);
            font-size: 14px; font-weight: 900;
            padding: 8px 20px;
            border: 1px solid var(--vchf-gold);
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        /* Веер внизу (Зона 35%) */
        #player-hand {
            position: absolute;
            bottom: 0; width: 100%; height: 30%;
            display: flex; justify-content: center;
            align-items: flex-end;
            padding-bottom: 30px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            pointer-events: none;
            z-index: 1100;
        }

        .hand-card {
            width: var(--card-w); height: var(--card-h);
            background: #eee; color: #000;
            border-radius: 6px;
            margin-left: -35px; /* Чешуя */
            display: flex; flex-direction: column;
            justify-content: space-between;
            padding: 5px; box-sizing: border-box;
            font-weight: bold; font-size: 18px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.5);
            border: 1px solid #999;
        }

        .picked { pointer-events: none; opacity: 0; transform: scale(0) !important; }
        
        button#ready-btn {
            padding: 20px 60px; font-size: 24px;
            background: var(--vchf-gold); color: black;
            border: none; font-weight: 900; cursor: pointer;
            box-shadow: 0 0 30px rgba(255,215,0,0.4);
        }
    </style>
</head>
<body>

<div id="start-overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:2000; display:flex; justify-content:center; align-items:center;">
    <button id="ready-btn" onclick="startRitual()">ГОТОВ</button>
</div>

<div id="turn-light">ИНИЦИАЦИЯ...</div>
<div id="trump-indicator">?</div>
<div id="table"></div>
<div id="player-hand"></div>

<script>
const suits = ['♠', '♣', '♥', '♦'];
const ranks = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
let deck = [];
let currentPlayer = 0;

function startRitual() {
    document.getElementById('start-overlay').style.display = 'none';
    let count = 0;
    let timer = setInterval(() => {
        document.getElementById('trump-indicator').innerText = suits[count % 4];
        count++;
        if (count > 20) {
            clearInterval(timer);
            const finalSuit = suits[Math.floor(Math.random()*4)];
            document.getElementById('trump-indicator').innerText = finalSuit;
            document.getElementById('trump-indicator').style.color = (finalSuit==='♥'||finalSuit==='♦') ? '#ff4444' : '#fff';
            createChaosTable();
        }
    }, 100);
}

function createChaosTable() {
    const table = document.getElementById('table');
    // 9 карт каждой масти
    suits.forEach(s => ranks.forEach(r => deck.push({suit: s, rank: r})));
    // Перемешиваем
    deck = deck.sort(() => Math.random() - 0.5);

    const radius = Math.min(window.innerWidth, window.innerHeight) * 0.35;

    deck.forEach((card, i) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card-on-table';
        
        // Математика хаотичного круга
        const angle = (i * 10) * (Math.PI / 180);
        const randomScatter = (Math.random() - 0.5) * 25; // Случайный сдвиг +-12px
        const randomRotate = (Math.random() - 0.5) * 15; // Случайный наклон
        
        const x = Math.cos(angle) * radius + randomScatter;
        const y = Math.sin(angle) * radius + randomScatter;

        cardDiv.style.transform = `translate(${x}px, ${y}px) rotate(${(i * 10) + randomRotate}deg)`;
        cardDiv.id = `card-${i}`;
        cardDiv.onclick = () => playerPick(i);
        table.appendChild(cardDiv);
    });
    
    currentPlayer = Math.floor(Math.random() * 2);
    updateUI();
}

function updateUI() {
    const light = document.getElementById('turn-light');
    light.innerText = currentPlayer === 0 ? "ТВОЙ ХОД" : "ХОД ИСКРЫ";
    if (currentPlayer === 1) setTimeout(aiPick, 800);
}

function playerPick(idx) {
    if (currentPlayer !== 0) return;
    pick(idx, 'player');
}

function aiPick() {
    const avail = document.querySelectorAll('.card-on-table:not(.picked)');
    if (!avail.length) return;
    const target = avail[Math.floor(Math.random() * avail.length)];
    pick(target.id.split('-')[1], 'ai');
}

function pick(id, owner) {
    const el = document.getElementById(`card-${id}`);
    if (el.classList.contains('picked')) return;
    el.classList.add('picked');

    if (owner === 'player') {
        const hand = document.getElementById('player-hand');
        const c = document.createElement('div');
        c.className = 'hand-card';
        const color = (deck[id].suit==='♥'||deck[id].suit==='♦') ? 'red' : 'black';
        c.innerHTML = `<div style="color:${color}">${deck[id].rank}</div><div style="align-self:flex-end; color:${color}">${deck[id].suit}</div>`;
        hand.appendChild(c);
    }

    currentPlayer = (currentPlayer + 1) % 2;
    updateUI();
}
</script>
</body>
</html>
