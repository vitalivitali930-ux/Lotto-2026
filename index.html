<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helvetia Lucky | VCHF Monolith</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --swiss-red: #e30a17;
            --deep-black: #050505;
            --cherry-deep: #3d0505;
            --steel-gradient: linear-gradient(145deg, #1a1a1a, #000);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: 'Orbitron', sans-serif; color: var(--gold);
        }

        /* --- UI & LAYERS --- */
        #wheel-layer {
            position: fixed; inset: 0; background: #000; z-index: 3000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .safe-wheel-container {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .wheel-center {
            width: 80px; height: 80px; background: radial-gradient(circle, #222, #000);
            border: 3px solid var(--gold); border-radius: 50%; z-index: 10;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
        }
        .flag-node {
            position: absolute; width: 60px; height: 60px;
            background: #0a0a0a; border: 2px solid var(--gold);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: pointer; z-index: 20;
            transform: translate(-50%, -50%); transition: 0.5s;
        }
        .wheel-vanishing .flag-node { opacity: 0; transform: translate(-50%, -50%) scale(0); transition: 0.8s; }

        #brand-layer {
            position: fixed; inset: 0; background: var(--deep-black); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .door-left, .door-right {
            position: absolute; top: 0; width: 50%; height: 100%; background: #0a0a0a;
            border: 1px solid rgba(212, 175, 55, 0.05); transition: 2s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .door-left { left: 0; border-right: 2px solid var(--gold); }
        .door-right { right: 0; border-left: 2px solid var(--gold); }
        .opened .door-left { transform: translateX(-100%); }
        .opened .door-right { transform: translateX(100%); }

        #game-room {
            position: fixed; inset: 0; display: none; opacity: 0;
            background: #000; z-index: 500; transition: 2s;
        }
        #velvet-table {
            position: absolute; bottom: -40%; left: 50%; transform: translateX(-50%);
            width: 180%; height: 100%; 
            background: radial-gradient(circle at 50% 0%, var(--cherry-deep) 0%, #000 70%);
            border-radius: 50% / 40%; border: 25px solid #080808;
        }

        /* --- CARDS & MATRIX --- */
        .card-monolith {
            position: absolute; width: 80px; height: 115px;
            background: var(--steel-gradient); border: 1.5px solid #222; border-radius: 6px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.9); transition: 0.6s;
            z-index: 10; display: flex; flex-direction: column; padding: 6px;
        }
        .deck-stacked { top: 38% !important; left: 16% !important; transform: rotate(-1deg) !important; }
        
        #matrix-overlay {
            position: fixed; top: 15%; right: 20px;
            width: 120px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; z-index: 100;
        }
        .sphere-node {
            width: 30px; height: 30px; border-radius: 50%;
            border: 1px solid rgba(212, 175, 55, 0.3); background: #000;
            display: flex; align-items: center; justify-content: center; font-size: 10px;
        }
        .sphere-node.hot { border-color: var(--swiss-red); box-shadow: 0 0 10px var(--swiss-red); color: #fff; }

        #ui-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 2500; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .vchf-balance { align-self: flex-end; background: rgba(0,0,0,0.8); border: 1px solid var(--gold); padding: 10px 20px; pointer-events: auto; }
    </style>
</head>
<body>
    <div id="wheel-layer"><div class="safe-wheel-container" id="main-wheel"><div class="wheel-center"></div></div></div>
    <div id="brand-layer">
        <div class="door-left"></div><div class="door-right"></div>
        <div style="z-index:1100; text-align:center;">
            <div style="width:60px; height:60px; background:var(--swiss-red); margin:0 auto 20px; border-radius:8px; position:relative;">
                <div style="position:absolute; background:#fff; width:10px; height:30px; left:25px; top:15px;"></div>
                <div style="position:absolute; background:#fff; width:30px; height:10px; left:15px; top:25px;"></div>
            </div>
            <h1 style="letter-spacing:10px;">HELVETIA LUCKY</h1>
        </div>
    </div>
    <div id="game-room">
        <div id="velvet-table">
            <div id="deck-zone"></div>
            <div id="trump-card" style="position:absolute; top:40%; left:22%; width:110px; height:75px; background:#fff; border-radius:6px; display:flex; align-items:center; justify-content:center; transform:rotate(95deg); opacity:0; transition:1s;"></div>
            <div id="player-hand" style="position:absolute; bottom:60px; width:100%; display:flex; justify-content:center;"></div>
            <div id="ai-hand" style="position:absolute; top:60px; width:100%; display:flex; justify-content:center; opacity:0.5; transform:scale(0.8);"></div>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
    let audioCtx = null;
    let mainDeck = [], playerHandData = [], aiHandData = [], tableZone = [];
    let isPlayerTurn = true, gameActive = false, trumpSuit = '', currentVCHF = 1000;
    const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'], RANKS = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    function playSound(f, d, t, v) {
        try {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        } catch(e){}
    }

    // --- WHEEL LOGIC ---
    const wheel = document.getElementById('main-wheel');
    ['üá∑üá∫','üá©üá™','üá´üá∑','üáÆüáπ','üá∫üá¶','üá¨üáß'].forEach((flag, i) => {
        const node = document.createElement('div');
        node.className = 'flag-node'; node.innerHTML = flag;
        const angle = i * 60, r = 145;
        node.style.left = `calc(50% + ${Math.sin(angle*Math.PI/180)*r}px)`;
        node.style.top = `calc(50% + ${-Math.cos(angle*Math.PI/180)*r}px)`;
        node.onclick = () => {
            playSound(100, 1, 'triangle', 0.3);
            wheel.style.transform = `rotate(${-angle + 1080}deg)`;
            wheel.classList.add('wheel-vanishing');
            setTimeout(() => {
                document.getElementById('wheel-layer').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('wheel-layer').style.display = 'none';
                    openSwissPortal();
                }, 1000);
            }, 1800);
        };
        wheel.appendChild(node);
    });

    function openSwissPortal() {
        document.getElementById('brand-layer').classList.add('opened');
        playSound(40, 2, 'sawtooth', 0.2);
        setTimeout(initGameEngine, 2500);
    }
    function initGameEngine() {
        document.getElementById('game-room').style.display = 'block';
        setTimeout(() => document.getElementById('game-room').style.opacity = '1', 100);
        initMatrix();
        buildDeck();
    }

    function initMatrix() {
        const m = document.createElement('div'); m.id = 'matrix-overlay';
        document.body.appendChild(m);
        for(let i=1; i<=42; i++) {
            const s = document.createElement('div'); s.className = 'sphere-node';
            s.id = `sphere-${i}`; s.innerText = i; m.appendChild(s);
        }
    }

    function buildDeck() {
        const zone = document.getElementById('deck-zone');
        for(let i=0; i<36; i++) {
            const c = document.createElement('div'); c.className = 'card-monolith';
            c.style.top = '40%'; c.style.left = '45%';
            zone.appendChild(c);
            setTimeout(() => { c.classList.add('deck-stacked'); c.style.zIndex = i; }, i*30);
        }
        
        mainDeck = [];
        SUITS.forEach(s => RANKS.forEach(r => mainDeck.push({suit:s, rank:r, color:(s==='‚ô•'||s==='‚ô¶')?'var(--swiss-red)':'#fff'})));
        mainDeck.sort(() => Math.random() - 0.5);
        
        setTimeout(setTrump, 2000);
    }

    function setTrump() {
        const t = mainDeck[0]; trumpSuit = t.suit;
        const el = document.getElementById('trump-card');
        el.innerHTML = `<span style="color:${t.color}; font-size:30px;">${t.rank}${t.suit}</span>`;
        el.style.opacity = '1';
        dealInitial();
    }

    function dealInitial() {
        for(let i=0; i<6; i++) {
            setTimeout(() => {
                drawCard(true);
                drawCard(false);
                playSound(600 + (i*100), 0.1, 'sine', 0.05);
            }, i*400);
        }
        gameActive = true;
    }

    function drawCard(isPlayer) {
        if(mainDeck.length === 0) return;
        const data = mainDeck.pop();
        const container = document.getElementById(isPlayer ? 'player-hand' : 'ai-hand');
        if(isPlayer) playerHandData.push(data); else aiHandData.push(data);
        renderCard(data, container, isPlayer);
    }

    function renderCard(data, container, isPlayer) {
        const c = document.createElement('div'); c.className = 'card-monolith';
        c.style.position = 'relative'; c.style.margin = '0 -20px';
        if(isPlayer) {
            c.style.background = '#fff'; c.style.color = data.color;
            c.innerHTML = `<div style="font-size:12px">${data.rank}${data.suit}</div><div style="font-size:32px; text-align:center;">${data.suit}</div>`;
            c.onclick = () => playerAttack(data, c);
        } else {
            c.style.background = 'var(--steel-gradient)';
        }
        container.appendChild(c);
        updateMatrixNode(data, 'hot');
    }

    function updateMatrixNode(d, status) {
        const idx = (SUITS.indexOf(d.suit)*9) + RANKS.indexOf(d.rank) + 1;
        const el = document.getElementById(`sphere-${idx}`);
        if(el) el.className = `sphere-node ${status}`;
    }

    function playerAttack(data, el) {
        if(!isPlayerTurn || !gameActive) return;
        el.style.position = 'fixed'; el.style.left = '50%'; el.style.top = '45%';
        el.style.transform = 'translate(-50%, -50%)';
        tableZone.push({data, el});
        isPlayerTurn = false;
        setTimeout(sparkResponse, 1000);
    }

    function sparkResponse() {
        const attack = tableZone[tableZone.length-1].data;
        let defIdx = aiHandData.findIndex(c => (c.suit === attack.suit && RANKS.indexOf(c.rank) > RANKS.indexOf(attack.rank)) || (c.suit === trumpSuit && attack.suit !== trumpSuit));
        
        if(defIdx !== -1) {
            const d = aiHandData[defIdx];
            const el = document.getElementById('ai-hand').children[defIdx];
            el.style.background = '#fff'; el.style.color = d.color;
            el.innerHTML = `<div style="font-size:12px">${d.rank}${d.suit}</div><div style="font-size:32px; text-align:center;">${d.suit}</div>`;
            el.style.position = 'fixed'; el.style.left = '55%'; el.style.top = '42%';
            tableZone.push({data: d, el});
            aiHandData.splice(defIdx, 1);
            setTimeout(clearTable, 1500);
        } else {
            sparkTakes();
        }
    }

    function clearTable() {
        tableZone.forEach(o => {
            o.el.style.left = '150%'; o.el.style.opacity = '0';
            updateMatrixNode(o.data, 'cold');
        });
        tableZone = []; isPlayerTurn = true;
        checkRefill();
    }

    function sparkTakes() {
        tableZone.forEach(o => {
            o.el.style.top = '-100px'; o.el.style.opacity = '0';
            aiHandData.push(o.data);
        });
        tableZone = []; isPlayerTurn = true;
        checkRefill();
    }

    function checkRefill() {
        while(playerHandData.length < 6 && mainDeck.length > 0) drawCard(true);
        while(aiHandData.length < 6 && mainDeck.length > 0) drawCard(false);
    }

    document.body.insertAdjacentHTML('beforeend', `<div id="ui-overlay"><div class="vchf-balance">VCHF: <span id="vchf-val">1000</span></div></div>`);
    console.log("–ú–∞–Ω–∏—Ñ–µ—Å—Ç –ú–æ–Ω–æ–ª–∏—Ç–∞: –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞.");
</script>
</body>
</html>
