<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helvetia Lucky | VCHF Monolith</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=JetBrains+Mono:wght@300;700&display=swap" rel="stylesheet">
    
    <style>
    /* // [ORIGINAL BLOCK START: INTRO STYLES] */
        :root {
            --gold: #d4af37;
            --swiss-red: #e30a17;
            --deep-black: #050505;
            --cherry-deep: #3d0505;
            --steel-gradient: linear-gradient(145deg, #1a1a1a, #000);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: 'Orbitron', sans-serif; color: var(--gold);
        }

        #wheel-layer {
            position: fixed; inset: 0; background: #000; z-index: 5000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .safe-wheel-container {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .wheel-center {
            width: 80px; height: 80px; background: radial-gradient(circle, #222, #000);
            border: 3px solid var(--gold); border-radius: 50%; z-index: 10;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
        }
        .flag-node {
            position: absolute; width: 60px; height: 60px;
            background: #0a0a0a; border: 2px solid var(--gold);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: pointer; z-index: 20;
            transform: translate(-50%, -50%); transition: 0.5s;
        }
        .wheel-vanishing .flag-node { opacity: 0; transform: translate(-50%, -50%) scale(0); transition: 0.8s; }

        #brand-layer {
            position: fixed; inset: 0; background: var(--deep-black); z-index: 4000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .door-left, .door-right {
            position: absolute; top: 0; width: 50%; height: 100%; background: #0a0a0a;
            border: 1px solid rgba(212, 175, 55, 0.05); transition: 2s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .door-left { left: 0; border-right: 2px solid var(--gold); }
        .door-right { right: 0; border-left: 2px solid var(--gold); }
        .opened .door-left { transform: translateX(-100%); }
        .opened .door-right { transform: translateX(100%); }
    /* // [ORIGINAL BLOCK END: INTRO STYLES] */

    /* // [ORIGINAL BLOCK START: TABLE STYLES] */
        :root {
            --cherry-velvet: radial-gradient(circle at center, #800020 0%, #2a000a 100%);
            --red-genius: #FF0000;
            --green-active: #00FF41;
            --gold-swiss: #d4af37;
            --vchf-dark: #050505;
        }
        #table-room {
            position: fixed; inset: 0; display: none; opacity: 0;
            background: var(--vchf-dark); z-index: 500; transition: 2s;
        }
        #table-surface {
            position: absolute; width: 100%; height: 100%;
            background: var(--cherry-velvet); border: 6px solid #1a0005;
            box-shadow: inset 0 0 120px rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
        }
        .lamp {
            position: absolute; width: 12px; height: 12px;
            border-radius: 50%; border: 1px solid rgba(255,255,255,0.2);
            transition: 0.5s; z-index: 100;
        }
        .lamp.waiting { background: var(--red-genius); box-shadow: 0 0 15px var(--red-genius); }
        .lamp.active { background: var(--green-active); box-shadow: 0 0 15px var(--green-active); }
        
        /* –ü–æ–∑–∏—Ü–∏–∏ */
        #lamp-top { top: 50px; left: 50%; transform: translateX(-50%); }
        #lamp-bottom { bottom: 175px; left: 50%; transform: translateX(-50%); }
        
        .main-deck {
            width: 100px; height: 140px; border: 2px solid var(--gold-swiss); border-radius: 10px;
            background: radial-gradient(circle, #000 30%, #4a0012 100%);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 10px 10px 30px rgba(0,0,0,0.8); z-index: 5;
        }
        /* –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85px;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            border-top: 1px solid var(--gold-swiss);
            display: flex; justify-content: center; align-items: center; gap: 20px; z-index: 2000;
        }
        .nav-btn {
            width: 160px; height: 45px; background: #000; border: 1.5px solid var(--gold-swiss);
            color: var(--gold-swiss); font-family: 'Orbitron'; font-size: 11px;
            display: flex; align-items: center; justify-content: center;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }
    /* // [ORIGINAL BLOCK END: TABLE STYLES] */

        /* –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –ü–†–ê–í–ò–õ–ê */
        #rules-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 6000; display: none; align-items: center; justify-content: center;
        }
        .rules-box {
            background: #0a0a0a; border: 2px solid var(--gold); padding: 30px;
            width: 90%; max-width: 400px; text-align: center;
        }
    </style>
</head>
<body>
    <div id="wheel-layer"><div class="safe-wheel-container" id="main-wheel"><div class="wheel-center"></div></div></div>
    
    <div id="brand-layer">
        <div class="door-left"></div><div class="door-right"></div>
        <div style="z-index:1100; text-align:center;">
            <div style="width:60px; height:60px; background:var(--swiss-red); margin:0 auto 20px; border-radius:8px; position:relative;">
                <div style="position:absolute; background:#fff; width:10px; height:30px; left:25px; top:15px;"></div>
                <div style="position:absolute; background:#fff; width:30px; height:10px; left:15px; top:25px;"></div>
            </div>
            <h1 style="letter-spacing:10px;">HELVETIA LUCKY</h1>
        </div>
    </div>

    <div id="table-room">
        <div id="table-surface">
            <div id="lamp-top" class="lamp waiting"></div>
            <div id="lamp-bottom" class="lamp active"></div>
            <div class="main-deck"><img src="1771489965074(1).png" style="width:80%" alt="Logo"></div>
        </div>
        <div class="nav-bar">
            <div class="nav-btn" id="btn-bar">–ë–ê–† (CHAT) üç∑</div>
            <div class="nav-btn" id="btn-games">–î–†–£–ì–ò–ï –ò–ì–†–´ üÉè</div>
        </div>
    </div>
    <div id="rules-overlay">
        <div class="rules-box">
            <h2 id="rules-title">RULES</h2>
            <div id="rules-text" style="margin: 20px 0; font-family: 'JetBrains Mono'; font-size: 14px;"></div>
            <button id="rules-close-btn" class="nav-btn" style="width: 100%; clip-path: none;">OK</button>
        </div>
    </div>
<script>
    // [ORIGINAL BLOCK START: CONFIG & DATA]
    const tg = window.Telegram.WebApp;
    tg.expand();

    const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
    const RANKS = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    
    let selectedLang = 'ru';
    let isPlayerTurn = true;
    let trumpSuit = '';
    let playerHandData = [];
    let aiHandData = [];
    let mainDeck = [];
    let tableZone = [];
    let gameActive = false;

    const translations = {
        ru: {
            title: "–ü–†–ê–í–ò–õ–ê",
            text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–ª–∏—Ç–Ω—ã–π –∑–∞–ª. –ò–≥—Ä–∞: –î—É—Ä–∞–∫ (36 –∫–∞—Ä—Ç). –í–∞—à–∞ —Ü–µ–ª—å ‚Äî –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –≤—Å–µ—Ö –∫–∞—Ä—Ç. –ö–æ–∑—ã—Ä—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ. –ù–∞—á–∏–Ω–∞–π—Ç–µ –∞—Ç–∞–∫—É!",
            button: "–ü–†–ò–ù–Ø–¢–¨",
            bar: "–ë–ê–† (CHAT) üç∑",
            games: "–î–†–£–ì–ò–ï –ò–ì–†–´ üÉè"
        },
        en: {
            title: "RULES",
            text: "Welcome to the elite room. Game: Durak (36 cards). Your goal is to get rid of all cards. The trump is random. Start your attack!",
            button: "ACCEPT",
            bar: "BAR (CHAT) üç∑",
            games: "OTHER GAMES üÉè"
        },
        de: {
            title: "REGELN",
            text: "Willkommen im Elite-Saal. Spiel: Durak (36 Karten). Ziel ist es, alle Karten abzulegen. Trumpf ist zuf√§llig. Starten Sie den Angriff!",
            button: "BEST√ÑTIGEN",
            bar: "BAR (CHAT) üç∑",
            games: "ANDERE SPIELE üÉè"
        },
        fr: {
            title: "R√àGLES",
            text: "Bienvenue dans la salle d'√©lite. Jeu: Durak (36 cartes). Votre but est de vous d√©barrasser de toutes les cartes. L'atout est al√©atoire.",
            button: "ACCEPTER",
            bar: "BAR (CHAT) üç∑",
            games: "AUTRES JEUX üÉè"
        },
        it: {
            title: "REGOLE",
            text: "Benvenuti nella sala elite. Gioco: Durak (36 carte). L'obiettivo √® sbarazzarsi di tutte le carte. La briscola √® casuale.",
            button: "ACCETTA",
            bar: "BAR (CHAT) üç∑",
            games: "ALTRI GIOCHI üÉè"
        },
        ch: {
            title: "Ë¶èÂâá",
            text: "Ê¨¢ËøéÊù•Âà∞Á≤æËã±ÂéÖ„ÄÇÊ∏∏ÊàèÔºöÊùúÊãâÂÖãÔºà36Âº†ÁâåÔºâ„ÄÇÁõÆÊ†áÊòØÊâìÊéâÊâÄÊúâÁâå„ÄÇÁéãÁâåÊòØÈöèÊú∫ÁöÑ„ÄÇÂºÄÂßãËøõÊîªÔºÅ",
            button: "Êé•Âèó",
            bar: "ÈÖíÂêß (CHAT) üç∑",
            games: "ÂÖ∂‰ªñÊ∏∏Êàè üÉè"
        }
    };
    // [ORIGINAL BLOCK END: CONFIG & DATA]

    // --- SOUND ENGINE ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, duration, type = 'sine', vol = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    // --- SAFE WHEEL LOGIC (THE SACRED MECHANISM) ---
    function initSafe() {
        const wheel = document.getElementById('main-wheel');
        const langs = ['ru', 'en', 'de', 'fr', 'it', 'ch'];
        const flags = ['üá∑üá∫', 'üá∫üá∏', 'üá©üá™', 'üá´üá∑', 'üáÆüáπ', 'üá®üá≥'];

        flags.forEach((flag, i) => {
            const angle = (i * 60) * (Math.PI / 180);
            const node = document.createElement('div');
            node.className = 'flag-node';
            node.innerHTML = flag;
            node.style.left = `${170 + Math.cos(angle) * 130}px`;
            node.style.top = `${170 + Math.sin(angle) * 130}px`;
            
            node.onclick = (e) => {
                e.stopPropagation();
                selectedLang = langs[i];
                openSafe(i * 60);
            };
            wheel.appendChild(node);
        });
    }

    function openSafe(angle) {
        const wheel = document.getElementById('main-wheel');
        const layer = document.getElementById('wheel-layer');
        const brand = document.getElementById('brand-layer');
        
        playSound(440, 0.5, 'square', 0.05);
        wheel.style.transform = `rotate(${-angle - 720}deg)`;
        wheel.classList.add('wheel-vanishing');

        setTimeout(() => {
            layer.style.opacity = '0';
            brand.style.display = 'flex';
            setTimeout(() => {
                layer.style.display = 'none';
                brand.classList.add('opened');
                playSound(100, 1.5, 'brown', 0.2); // –ó–≤—É–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–≤–µ—Ä–µ–π
                setTimeout(showRules, 2200);
            }, 100);
        }, 1500);
    }

    // --- RULES & TRANSITION ---
    function showRules() {
        const overlay = document.getElementById('rules-overlay');
        const title = document.getElementById('rules-title');
        const text = document.getElementById('rules-text');
        const btn = document.getElementById('rules-close-btn');

        const langData = translations[selectedLang];
        title.innerText = langData.title;
        text.innerText = langData.text;
        btn.innerText = langData.button; // –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥

        overlay.style.display = 'flex';
        
        btn.onclick = () => {
            playSound(800, 0.2, 'sine', 0.1);
            overlay.style.display = 'none';
            enterGameRoom();
        };
    }

    function enterGameRoom() {
        const room = document.getElementById('table-room');
        const brand = document.getElementById('brand-layer');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –ª–æ–±–±–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —è–∑—ã–∫—É
        document.getElementById('btn-bar').innerText = translations[selectedLang].bar;
        document.getElementById('btn-games').innerText = translations[selectedLang].games;

        room.style.display = 'block';
        setTimeout(() => room.style.opacity = '1', 50);
        brand.style.opacity = '0';
        setTimeout(() => brand.style.display = 'none', 2000);
        
        // –ú–∞–Ω–∏—Ñ–µ—Å—Ç: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–∫–∞ –∏–∑ Window 3
        if(typeof initGameEngine === 'function') initGameEngine();
    }

    window.onload = initSafe;
</script>
    // [ORIGINAL BLOCK START: GAME ENGINE]
    function initGameEngine() {
        console.log("–î–≤–∏–∂–æ–∫ VCHF –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ '–î—É—Ä–∞–∫'...");
        createGameElements();
        buildDeck();
        initMatrix();
    }

    function createGameElements() {
        const table = document.getElementById('table-surface');
        
        // –ó–æ–Ω—ã –¥–ª—è –∫–∞—Ä—Ç
        const playerHand = document.createElement('div');
        playerHand.id = 'player-hand';
        playerHand.style.cssText = "position:fixed; bottom:110px; width:100%; display:flex; justify-content:center; gap:5px; z-index:1500;";
        
        const aiHand = document.createElement('div');
        aiHand.id = 'ai-hand';
        aiHand.style.cssText = "position:fixed; top:80px; width:100%; display:flex; justify-content:center; gap:5px; z-index:1500; opacity:0.6; transform:scale(0.8);";
        
        const playZone = document.createElement('div');
        playZone.id = 'play-zone';
        playZone.style.cssText = "position:absolute; width:100%; height:200px; display:flex; align-items:center; justify-content:center; z-index:1000;";

        table.appendChild(playerHand);
        table.appendChild(aiHand);
        table.appendChild(playZone);
    }

    function buildDeck() {
        mainDeck = [];
        SUITS.forEach(s => {
            RANKS.forEach(r => {
                mainDeck.push({
                    suit: s, 
                    rank: r, 
                    value: RANKS.indexOf(r),
                    color: (s === '‚ô•' || s === '‚ô¶') ? 'var(--swiss-red)' : '#fff'
                });
            });
        });
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –ø–æ —à–≤–µ–π—Ü–∞—Ä—Å–∫–æ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É
        for (let i = mainDeck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [mainDeck[i], mainDeck[j]] = [mainDeck[j], mainDeck[i]];
        }
        
        const trump = mainDeck[0];
        trumpSuit = trump.suit;
        
        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–∑—ã—Ä—è
        const trumpCard = document.createElement('div');
        trumpCard.className = 'trump-indicator';
        trumpCard.style.cssText = `position:fixed; left:20px; top:50%; transform:translateY(-50%) rotate(90deg); background:#fff; color:${trump.color}; padding:5px 15px; border-radius:5px; border:2px solid var(--gold-swiss); font-weight:900; font-size:20px; z-index:100; box-shadow:0 0 20px rgba(212,175,55,0.4);`;
        trumpCard.innerHTML = trump.rank + trump.suit;
        document.body.appendChild(trumpCard);

        dealCards();
    }

    function dealCards() {
        for(let i=0; i<6; i++) {
            setTimeout(() => {
                drawCard(true);
                drawCard(false);
                playSound(500 + (i * 100), 0.1, 'sine', 0.05);
            }, i * 300);
        }
        gameActive = true;
    }

    function drawCard(isPlayer) {
        if(mainDeck.length === 0) return;
        const data = mainDeck.pop();
        const container = document.getElementById(isPlayer ? 'player-hand' : 'ai-hand');
        
        const cardEl = document.createElement('div');
        cardEl.style.cssText = "width:65px; height:95px; background:#fff; border-radius:6px; border:1px solid #000; display:flex; flex-direction:column; align-items:center; justify-content:center; color:" + data.color + "; font-family:'JetBrains Mono'; cursor:pointer; box-shadow:3px 3px 10px rgba(0,0,0,0.5); transition:0.3s; position:relative;";
        
        if(isPlayer) {
            cardEl.innerHTML = `<b style="font-size:14px; position:absolute; top:5px; left:5px;">${data.rank}</b><span style="font-size:30px;">${data.suit}</span>`;
            cardEl.onclick = () => playerMove(data, cardEl);
            playerHandData.push(data);
        } else {
            cardEl.style.background = 'var(--steel-gradient)';
            cardEl.innerHTML = '<div style="width:100%; height:100%; border:1px solid var(--gold-swiss); border-radius:4px; opacity:0.4;"></div>';
            aiHandData.push(data);
        }
        
        container.appendChild(cardEl);
        updateMatrix(data, true);
    }

    function playerMove(data, el) {
        if(!isPlayerTurn || !gameActive) return;
        
        const zone = document.getElementById('play-zone');
        el.style.position = 'static';
        el.style.transform = 'scale(1.1) rotate(' + (Math.random()*10 - 5) + 'deg)';
        zone.appendChild(el);
        
        isPlayerTurn = false;
        setTimeout(() => aiResponse(data), 1000);
    }

    function aiResponse(attackCard) {
        const zone = document.getElementById('play-zone');
        const aiHand = document.getElementById('ai-hand');
        
        // –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã
        let defenseIdx = aiHandData.findIndex(c => 
            (c.suit === attackCard.suit && c.value > attackCard.value) || 
            (c.suit === trumpSuit && attackCard.suit !== trumpSuit)
        );

        if(defenseIdx !== -1) {
            const defCard = aiHandData[defenseIdx];
            const defEl = aiHand.children[defenseIdx];
            
            defEl.style.background = '#fff';
            defEl.style.color = defCard.color;
            defEl.innerHTML = `<b style="font-size:14px; position:absolute; top:5px; left:5px;">${defCard.rank}</b><span style="font-size:30px;">${defCard.suit}</span>`;
            
            zone.appendChild(defEl);
            aiHandData.splice(defenseIdx, 1);
            playSound(300, 0.3, 'triangle', 0.1);
            
            setTimeout(() => {
                zone.innerHTML = '';
                isPlayerTurn = true;
                refillHands();
            }, 1500);
        } else {
            // –ò–ò –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—É
            setTimeout(() => {
                aiHandData.push(attackCard);
                const el = zone.firstChild;
                el.style.transform = 'scale(0.5)';
                el.style.opacity = '0';
                setTimeout(() => zone.innerHTML = '', 500);
                isPlayerTurn = true;
                refillHands();
            }, 1000);
        }
    }

    function refillHands() {
        while(playerHandData.length < 6 && mainDeck.length > 0) drawCard(true);
        while(aiHandData.length < 6 && mainDeck.length > 0) drawCard(false);
    }

    function initMatrix() {
        const m = document.createElement('div');
        m.style.cssText = "position:fixed; top:20px; right:20px; display:grid; grid-template-columns:repeat(4, 1fr); gap:5px; z-index:100;";
        SUITS.forEach(s => {
            const node = document.createElement('div');
            node.id = 'matrix-' + s;
            node.style.cssText = "width:25px; height:25px; background:rgba(0,0,0,0.5); border:1px solid var(--gold-swiss); color:var(--gold-swiss); display:flex; align-items:center; justify-content:center; font-size:12px; border-radius:50%; opacity:0.3;";
            node.innerText = s;
            m.appendChild(node);
        });
        document.body.appendChild(m);
    }

    function updateMatrix(data, active) {
        const el = document.getElementById('matrix-' + data.suit);
        if(el && active) {
            el.style.opacity = '1';
            el.style.boxShadow = "0 0 10px var(--gold-swiss)";
        }
    }
    // [ORIGINAL BLOCK END: GAME ENGINE]

    console.log("–ú–∞–Ω–∏—Ñ–µ—Å—Ç –ú–æ–Ω–æ–ª–∏—Ç–∞: –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã.");
</script>
</body>
</html>
