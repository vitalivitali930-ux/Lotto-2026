<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Нулевой хаос 1.2 | GitHub Ready</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --cherry: radial-gradient(circle at center, #600010 0%, #050505 100%);
            --glass: rgba(0, 0, 0, 0.85);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body, html { width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'JetBrains Mono', monospace; }

        #entropy-table { width: 100vw; height: 100vh; background: var(--cherry); position: relative; overflow: hidden; }

        /* Козырь-Штурвал */
        #trump-totem { 
            position: absolute; top: 15px; right: 15px; font-size: 35px; 
            color: var(--gold); text-shadow: 0 0 10px var(--gold); z-index: 1000;
        }

        /* Поле боя: поднято выше, чтобы не пересекаться с Бутоном */
        #battlefield { 
            position: absolute; top: 15%; width: 100%; height: 45%; 
            display: flex; flex-direction: column; align-items: center; z-index: 10; 
        }
        #table-drop-zone { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; width: 90%; }

        .card-pair { position: relative; width: 60px; height: 90px; }
        .table-card { 
            position: absolute; width: 60px; height: 90px; background: #fff; 
            border-radius: 6px; border: 1px solid var(--gold); padding: 5px;
            font-size: 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
        }
        .attack-card { transform: rotate(-5deg); z-index: 1; }
        .defense-card { transform: translate(10px, 10px) rotate(5deg); z-index: 2; }

        /* Враг */
        #enemy-hand { position: absolute; top: -40px; width: 100%; display: flex; justify-content: center; transform: rotate(180deg); }
        .card-back { 
            width: 40px; height: 60px; background: url('1771489965074(1).png') center/cover; 
            border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 4px; margin-left: -25px; 
        }

        /* Бутон 35% (Слой управления) */
        #bud-overlay { 
            position: absolute; bottom: 0; width: 100%; height: 35%; 
            background: var(--glass); backdrop-filter: blur(15px); 
            border-top: 2px solid var(--gold); z-index: 500; 
            display: flex; flex-direction: column; justify-content: space-evenly;
        }
        #burning-line { position: absolute; top: -2px; left: 0; width: 100%; height: 4px; background: #00ff00; }

        .suit-lane { height: 20%; position: relative; display: flex; justify-content: center; }
        .hand-card { 
            position: absolute; width: 55px; height: 75px; background: #fff; color: #000;
            border-radius: 4px; border: 1px solid var(--gold); padding: 4px;
            font-size: 12px; transition: 0.3s; cursor: pointer;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .hand-card.selected { transform: translateY(-30px) scale(1.15); z-index: 2000 !important; border: 2px solid var(--gold); box-shadow: 0 0 20px var(--gold); }
        .dimmed { opacity: 0.3; filter: grayscale(1); }

        #action-btn { 
            position: absolute; top: -60px; right: 20px; padding: 10px 20px; 
            background: #000; border: 2px solid var(--gold); color: var(--gold);
            font-family: 'Orbitron'; border-radius: 5px; display: none;
        }
    </style>
</head>
<body>
<div id="entropy-table">
    <div id="trump-totem">♠</div>
    <div id="battlefield">
        <div id="enemy-hand"></div>
        <div id="table-drop-zone"></div>
        <button id="action-btn"></button>
    </div>
    <div id="bud-overlay">
        <div id="burning-line"></div>
        <div class="suit-lane" id="lane-spades"></div>
        <div class="suit-lane" id="lane-clubs"></div>
        <div class="suit-lane" id="lane-hearts"></div>
        <div class="suit-lane" id="lane-diamonds"></div>
    </div>
</div>
<script>
/** * Протокол 1.1: Манифест Монолита. Исправлено наложение слоев.
 * Добавлен "Штурвал" выбора козыря.
 */
const CONFIG = {
    suits: ['♠', '♣', '♥', '♦'],
    ranks: ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'],
    val: {'6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14}
};

let game = {
    pHand: [], eHand: [], table: [],
    trump: '', isPlayerAtk: true, sel: null,
    timer: 30, tInt: null
};

function init() {
    // Анимация штурвала козыря (3 сек)
    let i = 0;
    let roll = setInterval(() => {
        document.getElementById('trump-totem').innerText = CONFIG.suits[i % 4];
        i++;
    }, 100);

    setTimeout(() => {
        clearInterval(roll);
        setupGame();
    }, 2500);
}

function setupGame() {
    let deck = [];
    CONFIG.suits.forEach(s => CONFIG.ranks.forEach(r => deck.push({s, r, v: CONFIG.val[r]})));
    deck.sort(() => Math.random() - 0.5);
    
    game.pHand = deck.slice(0, 18);
    game.eHand = deck.slice(18, 36);
    game.trump = document.getElementById('trump-totem').innerText;
    
    sync();
    startTimer();
}

function sync() {
    renderE(); renderP(); renderT(); updateBtn();
}

function renderE() {
    const el = document.getElementById('enemy-hand'); el.innerHTML = '';
    game.eHand.forEach((_, i) => {
        const c = document.createElement('div'); c.className = 'card-back';
        const rot = (i - (game.eHand.length/2)) * 3;
        c.style.transform = `rotate(${rot}deg) translateX(${rot}px)`;
        el.appendChild(c);
    });
}

function renderP() {
    const lanes = {'♠':'lane-spades', '♣':'lane-clubs', '♥':'lane-hearts', '♦':'lane-diamonds'};
    Object.values(lanes).forEach(id => document.getElementById(id).innerHTML = '');
    
    game.pHand.sort((a,b) => a.v - b.v).forEach(c => {
        const lane = document.getElementById(lanes[c.s]);
        const cardEl = document.createElement('div');
        cardEl.className = `hand-card ${game.sel === c ? 'selected' : ''} ${game.sel && game.sel !== c ? 'dimmed' : ''}`;
        cardEl.style.color = (c.s === '♥' || c.s === '♦') ? '#ff4444' : '#000';
        cardEl.innerHTML = `<b>${c.r}</b><i style="font-size:18px">${c.s}</i><b>${c.r}</b>`;
        
        cardEl.onclick = (e) => {
            e.stopPropagation();
            if(game.sel === c) executeMove(c);
            else { game.sel = c; sync(); }
        };
        
        const count = game.pHand.filter(x => x.s === c.s).length;
        const idx = game.pHand.filter(x => x.s === c.s).indexOf(c);
        cardEl.style.left = `calc(50% - 27px + ${(idx - (count-1)/2)*30}px)`;
        lane.appendChild(cardEl);
    });
}

function renderT() {
    const zone = document.getElementById('table-drop-zone'); zone.innerHTML = '';
    game.table.forEach(slot => {
        const pair = document.createElement('div'); pair.className = 'card-pair';
        pair.appendChild(createTCard(slot.atk, 'attack-card'));
        if(slot.def) pair.appendChild(createTCard(slot.def, 'defense-card'));
        zone.appendChild(pair);
    });
}

function createTCard(c, type) {
    const d = document.createElement('div'); d.className = `table-card ${type}`;
    d.style.color = (c.s === '♥' || c.s === '♦') ? '#ff4444' : '#000';
    d.innerHTML = `<div>${c.r}</div><div>${c.s}</div>`;
    return d;
}

function executeMove(c) {
    if(game.isPlayerAtk) {
        if(!game.table.length || game.table.some(s => s.atk.r === c.r || (s.def && s.def.r === c.r))) {
            game.table.push({atk:c, def:null});
            game.pHand = game.pHand.filter(x => x !== c);
            game.sel = null; sync(); setTimeout(aiDefense, 1000);
        }
    } else {
        let t = game.table.find(s => !s.def);
        if(t && ((c.s === t.atk.s && c.v > t.atk.v) || (c.s === game.trump && t.atk.s !== game.trump))) {
            t.def = c; game.pHand = game.pHand.filter(x => x !== c);
            game.sel = null; sync(); checkPhase();
        }
    }
}

function aiDefense() {
    let t = game.table.find(s => !s.def); if(!t) return;
    let opts = game.eHand.filter(c => (c.s === t.atk.s && c.v > t.atk.v) || (c.s === game.trump && t.atk.s !== game.trump)).sort((a,b) => a.v - b.v);
    if(opts.length && Math.random() > 0.15) {
        t.def = opts[0]; game.eHand = game.eHand.filter(x => x !== opts[0]);
        sync(); setTimeout(checkPhase, 800);
    } else take('enemy');
}

function take(who) {
    let cards = []; game.table.forEach(s => { cards.push(s.atk); if(s.def) cards.push(s.def); });
    if(who === 'player' || (!game.isPlayerAtk && who === 'enemy')) game.pHand.push(...cards);
    else game.eHand.push(...cards);
    game.table = []; game.isPlayerAtk = (who !== 'player'); sync();
}

function bito() {
    game.table = []; game.isPlayerAtk = !game.isPlayerAtk; sync();
    if(!game.isPlayerAtk) setTimeout(() => {
        let nt = game.eHand.filter(x => x.s !== game.trump).sort((a,b) => a.v - b.v);
        let c = nt[0] || game.eHand[0];
        game.table.push({atk:c, def:null}); game.eHand = game.eHand.filter(x => x !== c); sync();
    }, 1000);
}

function updateBtn() {
    const b = document.getElementById('action-btn');
    if(!game.table.length) { b.style.display = 'none'; return; }
    b.style.display = 'block';
    if(game.isPlayerAtk) { b.innerText = 'БИТО'; b.onclick = bito; }
    else { b.innerText = 'ВЗЯТЬ'; b.onclick = () => take('player'); }
}

function checkPhase() { if(game.table.every(s => s.def)) updateBtn(); }

function startTimer() {
    const l = document.getElementById('burning-line');
    game.tInt = setInterval(() => {
        game.timer -= 0.1;
        let p = (game.timer / 30) * 100;
        l.style.width = p + '%';
        if(p < 20) l.style.background = '#ff0000';
        if(game.timer <= 0) { bito(); game.timer = 30; }
    }, 100);
}

window.onload = init;
</script>
</body>
</html>
