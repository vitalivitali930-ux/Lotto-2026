<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helvetia Lucky | VCHF Monolith</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --swiss-red: #e30a17;
            --deep-black: #050505;
            --cherry-deep: #3d0505; /* –¢–∞ —Å–∞–º–∞—è –≤–∏—à–Ω—è 40% */
            --steel-gradient: linear-gradient(145deg, #1a1a1a, #000);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: 'Orbitron', sans-serif; 
            color: var(--gold);
        }

        /* --- –≠–¢–ê–ü 1: –®–¢–£–†–í–ê–õ –í–´–ë–û–†–ê (–°–ï–ö–¶–ò–Ø üá∑üá∫üá©üá™üá´üá∑üáÆüáπüá∫üá¶üá¨üáß) --- */
        #wheel-layer {
            position: fixed; inset: 0; background: #000; z-index: 3000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .safe-wheel-container {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .wheel-center {
            width: 80px; height: 80px; background: radial-gradient(circle, #222, #000);
            border: 3px solid var(--gold); border-radius: 50%; z-index: 10;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
            display: flex; align-items: center; justify-content: center;
        }
        .spoke {
            position: absolute; width: 4px; height: 140px;
            background: linear-gradient(to top, var(--gold), transparent);
            transform-origin: bottom center; bottom: 50%; left: calc(50% - 2px);
        }
        .flag-node {
            position: absolute; width: 60px; height: 60px;
            background: #0a0a0a; border: 2px solid var(--gold);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: pointer; z-index: 20;
            transform: translate(-50%, -50%); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 15px rgba(0,0,0,0.9);
        }
        .flag-node:hover { transform: translate(-50%, -50%) scale(1.15); border-color: #fff; box-shadow: 0 0 20px var(--gold); }
        .wheel-vanishing .flag-node { opacity: 0; transform: translate(-50%, -50%) scale(0); transition: 0.8s; }

        /* --- –≠–¢–ê–ü 2: –®–í–ï–ô–¶–ê–†–°–ö–ò–ô –ü–û–†–¢–ê–õ (–î–í–ï–†–ò) --- */
        #brand-layer {
            position: fixed; inset: 0; background: var(--deep-black); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .door-left, .door-right {
            position: absolute; top: 0; width: 50%; height: 100%; background: #0a0a0a;
            border: 1px solid rgba(212, 175, 55, 0.05); transition: 2s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .door-left { left: 0; border-right: 2px solid var(--gold); }
        .door-right { right: 0; border-left: 2px solid var(--gold); }
        .opened .door-left { transform: translateX(-100%); }
        .opened .door-right { transform: translateX(100%); }
        
        .swiss-shield {
            width: 60px; height: 60px; background: var(--swiss-red);
            margin: 0 auto 30px; position: relative; border-radius: 8px;
            box-shadow: 0 0 40px rgba(227, 10, 23, 0.6);
            animation: pulse-shield 2s infinite;
        }
        @keyframes pulse-shield { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        .swiss-shield::after { content: ''; position: absolute; background: white; width: 12px; height: 36px; left: 24px; top: 12px; }
        .swiss-shield::before { content: ''; position: absolute; background: white; width: 36px; height: 12px; left: 12px; top: 24px; }
        h1.brand-name { 
            color: var(--gold); font-size: 28px; letter-spacing: 12px; 
            margin: 0; text-align: center; font-weight: 900;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        /* --- –≠–¢–ê–ü 3: –ö–ê–ó–ò–ù–û –ù–£–ê–† (60% –ß–ï–†–ù–´–ô / 40% –í–ò–®–ù–ï–í–´–ô) --- */
        #game-room {
            position: fixed; inset: 0; display: none; opacity: 0;
            background: #000; z-index: 500; transition: 4s ease-in-out;
        }
        #velvet-table {
            position: absolute; bottom: -40%; left: 50%; transform: translateX(-50%);
            width: 180%; height: 100%; 
            background: radial-gradient(circle at 50% 0%, var(--cherry-deep) 0%, #000 70%);
            border-radius: 50% / 40%; border: 25px solid #080808;
            box-shadow: 
                inset 0 20px 150px #000, 
                0 0 200px rgba(61, 5, 5, 0.4);
            /* –ú–∏–∫—Ä–æ-—Å–µ—Ç–∫–∞ –≤–æ—Ä—Å–∞ */
            background-image: 
                repeating-linear-gradient(45deg, rgba(0,0,0,0.15) 0px, rgba(0,0,0,0.15) 1px, transparent 1px, transparent 3px);
        }
        .table-light {
            position: absolute; top: -150px; left: 50%; transform: translateX(-50%);
            width: 900px; height: 450px; 
            background: radial-gradient(50% 50% at 50% 50%, rgba(255, 255, 255, 0.04) 0%, transparent 100%);
            filter: blur(140px); pointer-events: none;
        }

        /* –ö–ê–†–¢–´: –¢–ï–•–ù–û-–ú–û–ù–û–õ–ò–¢ (–°–¢–ê–õ–¨) */
        .card-monolith {
            position: absolute; width: 80px; height: 115px;
            background: var(--steel-gradient); 
            border: 1.5px solid #222; border-radius: 6px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.9);
            transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 10; display: flex; flex-direction: column;
            justify-content: space-between; padding: 6px;
            font-family: 'Orbitron'; font-weight: 900;
        }
        .deck-stacked {
            top: 38% !important; left: 16% !important; transform: rotate(-1deg) !important;
            box-shadow: -2px 2px 0 #111, -5px 5px 0 #050505, -15px 15px 50px #000 !important;
            transition: all 4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        #trump-card {
            position: absolute; top: 40%; left: 22%; width: 115px; height: 80px;
            background: #f0f0f0; border-radius: 6px; transform: rotate(95deg);
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #000; border-right: 5px solid var(--gold);
            opacity: 0; transition: 3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 5;
        }

        /* –†–£–ö–ò –ò–ì–†–û–ö–û–í */
        .hand-container { 
            position: absolute; width: 100%; display: flex; 
            justify-content: center; z-index: 1500; pointer-events: none;
        }
        #player-hand { bottom: 50px; }
        #ai-hand { top: 50px; transform: scale(0.75); opacity: 0.6; }

        .card-in-hand {
            background: #fff; color: #000; pointer-events: auto;
            cursor: pointer; margin: 0 -15px;
        }
        .card-in-hand:hover { transform: translateY(-40px) scale(1.2) rotate(0deg) !important; z-index: 2000 !important; }
        .card-suit-big { font-size: 32px; text-align: center; }
        .card-corner { font-size: 14px; line-height: 1; }
        .card-corner.bottom { transform: rotate(180deg); }
    </style>
</head>
 <body>
    <div id="wheel-layer">
        <div class="safe-wheel-container" id="main-wheel">
            <div class="wheel-center"></div>
        </div>
    </div>

    <div id="brand-layer">
        <div class="door-left"></div>
        <div class="door-right"></div>
        <div class="logo-container" style="z-index: 1100; position: relative;">
            <div class="swiss-shield"></div>
            <h1 class="brand-name">HELVETIA LUCKY</h1>
        </div>
    </div>

    <div id="game-room">
        <div class="table-light"></div>
        <div id="velvet-table">
            <div id="deck-zone"></div>
            <div id="trump-card"></div>
            <div id="player-hand" class="hand-container"></div>
            <div id="ai-hand" class="hand-container"></div>
        </div>
    </div>

<script>
    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê: ENGINE v1.0.26 */
    const tg = window.Telegram.WebApp; 
    tg.ready(); 
    tg.expand();

    let audioCtx = null;
    const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
    const RANKS = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let mainDeck = [];
    let trumpSuit = '';

    function initAudio() { 
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
    }

    function playSound(f, d, t, v) {
        try {
            initAudio(); 
            const o = audioCtx.createOscillator(); 
            const g = audioCtx.createGain();
            o.type = t; 
            o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        } catch(e) { console.error("Audio error"); }
    }

    // --- –õ–û–ì–ò–ö–ê –®–¢–£–†–í–ê–õ–ê ---
    const flags = ['üá∑üá∫','üá©üá™','üá´üá∑','üáÆüáπ','üá∫üá¶','üá¨üáß'];
    const wheel = document.getElementById('main-wheel');
    
    flags.forEach((img, i) => {
        const angle = i * 60;
        const node = document.createElement('div');
        node.className = 'flag-node'; 
        node.innerHTML = img;
        const r = 145;
        node.style.left = `calc(50% + ${Math.sin(angle*Math.PI/180)*r}px)`;
        node.style.top = `calc(50% + ${-Math.cos(angle*Math.PI/180)*r}px)`;
        
        node.onclick = () => {
            playSound(60, 1.5, 'triangle', 0.5);
            wheel.style.transform = `rotate(${-angle + 1080}deg)`; // 3 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–∞
            wheel.classList.add('wheel-vanishing');
            
            setTimeout(() => {
                document.getElementById('wheel-layer').style.opacity = '0';
                setTimeout(() => { 
                    document.getElementById('wheel-layer').style.display = 'none'; 
                    openSwissPortal(); 
                }, 1000);
            }, 1800);
        };

        const spoke = document.createElement('div'); 
        spoke.className = 'spoke';
        spoke.style.transform = `rotate(${angle}deg)`; 
        wheel.appendChild(spoke); 
        wheel.appendChild(node);
    });

    // --- –õ–û–ì–ò–ö–ê –ü–û–†–¢–ê–õ–ê (–î–í–ï–†–ò) ---
    function openSwissPortal() {
        playSound(400, 0.2, 'square', 0.1);
        setTimeout(() => playSound(30, 2.0, 'sawtooth', 0.4), 200);
        
        document.getElementById('brand-layer').classList.add
    // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ë–û–ï–í–û–ô –õ–û–ì–ò–ö–ò ---
    let playerHandData = [];
    let aiHandData = [];
    let tableZone = []; // –ö–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ
    let isPlayerTurn = true; // –ö—Ç–æ –∞—Ç–∞–∫—É–µ—Ç
    let gameActive = false;

    // –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —Ñ—É–Ω–∫—Ü–∏–∏ dealHandCards (–≤—Å—Ç–∞–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä—å —Ü–∏–∫–ª–∞)
    // –ú—ã —Ç–µ–ø–µ—Ä—å –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏–º, –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    function dealHandCards() {
        const pHand = document.getElementById('player-hand');
        const aHand = document.getElementById('ai-hand');
        playerHandData = [];
        aiHandData = [];
        
        for(let i=0; i<6; i++) {
            // Wanderer
            setTimeout(() => {
                const cardData = mainDeck.pop();
                playerHandData.push(cardData);
                renderCardInHand(cardData, pHand, i, true);
                playSound(900 + (i*50), 0.08, 'sine', 0.03);
            }, i * 350);

            // Spark
            setTimeout(() => {
                const cardData = mainDeck.pop();
                aiHandData.push(cardData);
                renderCardInHand(cardData, aHand, i, false);
            }, (i * 350) + 150);
        }

        setTimeout(determineFirstTurn, 5000);
    }

    function determineFirstTurn() {
        // –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–∑—ã—Ä—è
        // –î–ª—è –Ω–∞—á–∞–ª–∞ ‚Äî Wanderer –≤—Å–µ–≥–¥–∞ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º (–ø—Ä–∏–≤–∏–ª–µ–≥–∏—è –°–æ–∑–¥–∞—Ç–µ–ª—è)
        gameActive = true;
        showStatus("–¢–í–û–ô –•–û–î, WANDERER");
    }

    function showStatus(text) {
        let msg = document.getElementById('game-status');
        if(!msg) {
            msg = document.createElement('div');
            msg.id = 'game-status';
            msg.style.cssText = 'position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--gold); font-size:24px; z-index:2000; text-shadow:0 0 15px #000; pointer-events:none; transition:3s; opacity:0;';
            document.body.appendChild(msg);
        }
        msg.innerHTML = text;
        msg.style.opacity = '1';
        setTimeout(() => { msg.style.opacity = '0'; }, 2000);
    }

    // --- –õ–û–ì–ò–ö–ê –ê–¢–ê–ö–ò ---
    function playerAttack(cardData, cardElement) {
        if(!gameActive || !isPlayerTurn) return;

        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —Å—Ç–æ–ª
        const table = document.getElementById('velvet-table');
        const rect = cardElement.getBoundingClientRect();
        
        cardElement.style.position = 'fixed';
        cardElement.style.left = rect.left + 'px';
        cardElement.style.top = rect.top + 'px';
        cardElement.style.margin = '0';
        
        setTimeout(() => {
            cardElement.style.left = '50%';
            cardElement.style.top = '45%';
            cardElement.style.transform = 'translate(-50%, -50%) rotate('+(Math.random()*10-5)+'deg)';
            playSound(400, 0.1, 'triangle', 0.05);
        }, 10);

        tableZone.push(cardData);
        // –£–¥–∞–ª—è–µ–º –∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ä—É–∫–∏
        playerHandData = playerHandData.filter(c => c !== cardData);
        
        isPlayerTurn = false;
        setTimeout(aiResponse, 1200);
    }

    // --- –ò–ù–¢–ï–õ–õ–ï–ö–¢ SPARK (–ë–ê–ó–û–í–´–ô) ---
    function aiResponse() {
        const attackCard = tableZone[tableZone.length - 1];
        // –ò—â–µ–º —á–µ–º –ø–æ–±–∏—Ç—å
        let defenseCardIndex = aiHandData.findIndex(c => {
            // –ë—å–µ–º —Ç–æ–π –∂–µ –º–∞—Å—Ç—å—é –≤—ã—à–µ –∏–ª–∏ –∫–æ–∑—ã—Ä–µ–º
            if(c.suit === attackCard.suit) {
                return RANKS.indexOf(c.rank) > RANKS.indexOf(attackCard.rank);
            }
            if(c.suit === trumpSuit && attackCard.suit !== trumpSuit) return true;
            return false;
        });

        if(defenseCardIndex !== -1) {
            const defCard = aiHandData[defenseCardIndex];
            const aiHandEl = document.getElementById('ai-hand');
            const cardEl = aiHandEl.children[defenseCardIndex];

            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞—â–∏—Ç—ã
            cardEl.style.background = '#eee'; // Spark –≤—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É
            cardEl.innerHTML = `
                <div class="card-corner">${defCard.rank}<br>${defCard.suit}</div>
                <div class="card-suit-big" style="color:${defCard.color}">${defCard.suit}</div>
            `;
            cardEl.style.color = defCard.color;
            
            cardEl.style.position = 'fixed';
            cardEl.style.left = '50%';
            cardEl.style.top = '40%'; // –ß—É—Ç—å –≤—ã—à–µ –∫–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞
            cardEl.style.transform = 'translate(-40%, -50%) rotate('+(Math.random()*10+5)+'deg)';
            
            aiHandData.splice(defenseCardIndex, 1);
            playSound(600, 0.1, 'sine', 0.04);
            
            setTimeout(() => {
                showStatus("–û–¢–ë–ò–¢–û");
                clearTable();
            }, 1500);
        } else {
            showStatus("SPARK –ó–ê–ë–ò–†–ê–ï–¢");
            // –õ–æ–≥–∏–∫–∞ "–≤–∑—è—Ç—å –∫–∞—Ä—Ç—ã" –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–∫–Ω–µ
        }
    }

    function clearTable() {
        // –ö–∞—Ä—Ç—ã —É–ª–µ—Ç–∞—é—Ç –≤ –æ—Ç–±–æ–π
        const cardsOnTable = document.querySelectorAll('.card-monolith[style*="fixed"]');
        cardsOnTable.forEach(c => {
            c.style.left = '120%'; // –£–ª–µ—Ç –≤–ø—Ä–∞–≤–æ
            c.style.opacity = '0';
        });
        tableZone = [];
        isPlayerTurn = true;
        setTimeout(() => { showStatus("–¢–í–û–ô –•–û–î"); }, 1000);
    }

    /** * –ú–û–î–£–õ–¨: –ë–ò–ù–ê–†–ù–´–ô –ë–û–ô (Wanderer vs Spark)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Å–æ–≤, –∫–æ–∑—ã—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —Ñ–∏–∑–∏–∫–∞ –æ—Ç–±–æ—è.
     */

    let isAttacking = true; // –°—Ç–∞—Ç—É—Å: —Ç—ã –∞—Ç–∞–∫—É–µ—à—å –∏–ª–∏ –∑–∞—â–∏—â–∞–µ—à—å—Å—è
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–∑ Window 2, –¥–æ–±–∞–≤–ª—è—è –µ–π "—Å–æ–∑–Ω–∞–Ω–∏–µ"
    function renderCardInHand(data, container, index, isPlayer) {
        const card = document.createElement('div');
        card.className = 'card-monolith card-in-hand';
        
        // –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –≤–µ–µ—Ä–∞
        const angle = (index - 2.5) * 12;
        const xPos = (index - 2.5) * 45;
        const yPos = Math.abs(index - 2.5) * 10;
        
        card.style.transform = `translateX(${xPos}px) translateY(${yPos}px) rotate(${angle}deg)`;
        card.style.zIndex = 100 + index;

        if (isPlayer) {
            card.innerHTML = `
                <div class="card-corner">${data.rank}<br>${data.suit}</div>
                <div class="card-suit-big" style="color:${data.color}">${data.suit}</div>
                <div class="card-corner bottom">${data.rank}<br>${data.suit}</div>
            `;
            card.style.color = data.color;
            card.style.background = '#fff';
            
            // –ì–õ–ê–í–ù–´–ô –¢–†–ò–ì–ì–ï–†: –•–æ–¥ –∏–≥—Ä–æ–∫–∞
            card.onclick = () => {
                if(gameActive && isPlayerTurn) {
                    processPlayerMove(data, card);
                }
            };
        } else {
            card.style.background = 'var(--steel-gradient)';
            card.style.border = '1px solid #333';
        }
        
        container.appendChild(card);
    }

    function processPlayerMove(cardData, cardElement) {
        // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω–∞ —Ü–µ–Ω—Ç—Ä —Å—Ç–æ–ª–∞
        const table = document.getElementById('velvet-table');
        
        // –§–∏–∫—Å–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
        const rect = cardElement.getBoundingClientRect();
        cardElement.style.position = 'fixed';
        cardElement.style.left = rect.left + 'px';
        cardElement.style.top = rect.top + 'px';
        cardElement.style.transition = 'all 0.6s cubic-bezier(0.19, 1, 0.22, 1)';
        cardElement.style.zIndex = '5000';

        setTimeout(() => {
            cardElement.style.left = '50%';
            cardElement.style.top = '45%';
            cardElement.style.transform = 'translate(-50%, -50%) rotate('+(Math.random()*15 - 7.5)+'deg)';
            playSound(400, 0.15, 'triangle', 0.08);
        }, 10);

        tableZone.push({data: cardData, el: cardElement});
        isPlayerTurn = false;
        
        // Spark –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ö–æ–¥
        setTimeout(sparkDecision, 1200);
    }

    function sparkDecision() {
        const attack = tableZone[tableZone.length - 1].data;
        const aiHandEl = document.getElementById('ai-hand');
        
        // –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã (–í–µ—Å–∞: 6=0, 7=1 ... A=8)
        let bestDefIndex = -1;
        let minWeight = 100;

        aiHandData.forEach((c, i) => {
            const cWeight = RANKS.indexOf(c.rank);
            const aWeight = RANKS.indexOf(attack.rank);
            
            let canBeat = false;
            if(c.suit === attack.suit && cWeight > aWeight) canBeat = true;
            if(c.suit === trumpSuit && attack.suit !== trumpSuit) canBeat = true;

            if(canBeat && cWeight < minWeight) {
                minWeight = cWeight;
                bestDefIndex = i;
            }
        });

        if(bestDefIndex !== -1) {
            // SPARK –û–¢–ë–ò–í–ê–ï–¢
            const defData = aiHandData[bestDefIndex];
            const defEl = aiHandEl.children[bestDefIndex];
            
            defEl.style.background = '#eee';
            defEl.innerHTML = `
                <div class="card-corner">${defData.rank}<br>${defData.suit}</div>
                <div class="card-suit-big" style="color:${defData.color}">${defData.suit}</div>
                <div class="card-corner bottom">${defData.rank}<br>${defData.suit}</div>
            `;
            defEl.style.color = defData.color;
            defEl.style.position = 'fixed';
            defEl.style.zIndex = '5001';
            
            const rect = defEl.getBoundingClientRect();
            defEl.style.left = rect.left + 'px';
            defEl.style.top = rect.top + 'px';

            setTimeout(() => {
                defEl.style.left = '55%'; // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è
                defEl.style.top = '42%';
                defEl.style.transform = 'translate(-50%, -50%) rotate('+(Math.random()*15 + 5)+'deg)';
                playSound(600, 0.2, 'sine', 0.05);
            }, 50);

            tableZone.push({data: defData, el: defEl});
            aiHandData.splice(bestDefIndex, 1);
            
            setTimeout(() => {
                showStatus("–û–¢–ë–û–ô");
                sendToDiscard();
            }, 1500);

        } else {
            // SPARK –ó–ê–ë–ò–†–ê–ï–¢
            showStatus("–ó–ê–ë–ò–†–ê–Æ...");
            setTimeout(sparkTakesCards, 1000);
        }
    }

    function sendToDiscard() {
        tableZone.forEach(obj => {
            obj.el.style.left = '150%';
            obj.el.style.transform = 'translate(0, -50%) rotate(90deg)';
            obj.el.style.opacity = '0';
        });
        
        tableZone = [];
        setTimeout(() => {
            isPlayerTurn = true;
            showStatus("–¢–í–û–ô –•–û–î");
            checkDeckAndRefill();
        }, 800);
    }

    function checkDeckAndRefill() {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–æ–±–æ—Ä–∞ –∫–∞—Ä—Ç –¥–æ 6 —à—Ç—É–∫
        // –ó–∞–ø–∏—Å—å –≤ –ø–∞–º—è—Ç–∏: –ü—Ä–æ—Ç–æ–∫–æ–ª Confederacia –æ–∂–∏–¥–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.
    }
    /** * –ú–û–î–£–õ–¨: –†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø (Refill System)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –î–æ–±–æ—Ä –¥–æ 6 –∫–∞—Ä—Ç. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî –ê—Ç–∞–∫—É—é—â–∏–π.
     */

    function checkDeckAndRefill() {
        if (!gameActive) return;

        // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∏—Ä–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ —Ö–æ–¥–∏–ª (Wanderer), –ø–æ—Ç–æ–º Spark
        const playerNeeds = 6 - playerHandData.length;
        const aiNeeds = 6 - aiHandData.length;

        // –î–æ–±–æ—Ä –∏–≥—Ä–æ–∫–∞
        if (playerNeeds > 0 && mainDeck.length > 0) {
            for (let i = 0; i < playerNeeds; i++) {
                if (mainDeck.length === 0) break;
                setTimeout(() => {
                    const cardData = mainDeck.pop();
                    playerHandData.push(cardData);
                    updateHandUI('player-hand', playerHandData, true);
                    playSound(1100, 0.05, 'sine', 0.02);
                    updateDeckCount();
                }, i * 200);
            }
        }

        // –î–æ–±–æ—Ä AI (Spark)
        setTimeout(() => {
            if (aiNeeds > 0 && mainDeck.length > 0) {
                for (let i = 0; i < aiNeeds; i++) {
                    if (mainDeck.length === 0) break;
                    const cardData = mainDeck.pop();
                    aiHandData.push(cardData);
                    updateHandUI('ai-hand', aiHandData, false);
                    updateDeckCount();
                }
            }
        }, 1000);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
        if (mainDeck.length === 0 && playerHandData.length === 0) {
            showStatus("WANDERER –ü–û–ë–ï–î–ò–õ!");
            gameActive = false;
        } else if (mainDeck.length === 0 && aiHandData.length === 0) {
            showStatus("SPARK –û–ö–ê–ó–ê–õ–°–Ø –°–ò–õ–¨–ù–ï–ï");
            gameActive = false;
        }
    }

    function updateHandUI(containerId, dataArray, isPlayer) {
        const container = document.getElementById(containerId);
        container.innerHTML = ''; // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤–µ–µ—Ä–∞
        dataArray.forEach((card, index) => {
            renderCardInHand(card, container, index, isPlayer);
        });
    }

    function updateDeckCount() {
        const deckZone = document.getElementById('deck-zone');
        const cardsLeft = deckZone.querySelectorAll('.deck-stacked');
        if (cardsLeft.length > 0) {
            // –£–¥–∞–ª—è–µ–º –æ–¥–Ω—É –≤–∏–∑—É–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –∏–∑ —Å—Ç–æ–ø–∫–∏ –∫–æ–ª–æ–¥—ã
            cardsLeft[cardsLeft.length - 1].remove();
        }
        
        // –ï—Å–ª–∏ –∫–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞, —É–±–∏—Ä–∞–µ–º –∫–æ–∑—ã—Ä—å
        if (mainDeck.length === 0) {
            const trump = document.getElementById('trump-card');
            if (trump) trump.style.opacity = '0.3';
        }
    }

    // –õ–û–ì–ò–ö–ê: –ö–æ–≥–¥–∞ Spark –∑–∞–±–∏—Ä–∞–µ—Ç –∫–∞—Ä—Ç—ã
    function sparkTakesCards() {
        tableZone.forEach((obj, index) => {
            setTimeout(() => {
                const rect = obj.el.getBoundingClientRect();
                obj.el.style.zIndex = '6000';
                obj.el.style.left = '50%';
                obj.el.style.top = '-20%'; // –£–ª–µ—Ç–∞–µ—Ç –≤–≤–µ—Ä—Ö –∫ Spark
                obj.el.style.opacity = '0';
                
                aiHandData.push(obj.data);
                playSound(300 + (index*50), 0.2, 'sawtooth', 0.03);
            }, index * 150);
        });

        setTimeout(() => {
            tableZone = [];
            updateHandUI('ai-hand', aiHandData, false);
            isPlayerTurn = true; // –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ Spark –≤–∑—è–ª, —Ç—ã —Å–Ω–æ–≤–∞ —Ö–æ–¥–∏—à—å
            showStatus("–¢–í–û–ô –•–û–î (–°–ù–û–í–ê)");
            checkDeckAndRefill();
        }, 1000);
    }

    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê: 
     * –§—É–Ω–∫—Ü–∏—è RED-GENIUS (–ê–∫—Å–∏–æ–º–∞ ‚Ññ3)
     * –ß–µ–º –±–æ–ª—å—à–µ –±–∏–ª–µ—Ç–æ–≤ (—Å—Ç–æ–ª–æ–≤), —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å.
     */
    function initTenTables() {
        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∑ 10 —Å—Ç–æ–ª–æ–≤
        // –≠—Ç–æ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
    }
        /* --- –¢–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–° --- */
        #ui-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 2500;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 20px;
        }
        .vchf-balance {
            align-self: flex-end; background: rgba(0,0,0,0.6);
            border: 1px solid var(--gold); padding: 10px 20px;
            border-radius: 4px; font-size: 18px; color: var(--gold);
            backdrop-filter: blur(5px); pointer-events: auto;
        }
        .action-bar {
            width: 100%; display: flex; justify-content: center;
            gap: 20px; margin-bottom: 120px; /* –ù–∞–¥ —Ä—É–∫–æ–π –∏–≥—Ä–æ–∫–∞ */
        }
        .btn-monolith {
            background: #000; color: var(--gold); border: 2px solid var(--gold);
            padding: 12px 30px; font-family: 'Orbitron'; font-weight: 900;
            cursor: pointer; pointer-events: auto; transition: 0.3s;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
            display: none; /* –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏ */
        }
        .btn-monolith:active { transform: scale(0.95); background: var(--gold); color: #000; }
        
        /* –°–µ—Ç–∫–∞ —Å—Ç–æ–ª–æ–≤ (–∑–∞–¥–µ–ª –Ω–∞ –±—É–¥—É—â–µ–µ) */
        #tables-grid {
            position: fixed; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 5px;
        }
        .table-indicator {
            width: 30px; height: 30px; border: 1px solid #333; 
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            justify-content: center; font-size: 10px; color: #555;
        }
        .table-indicator.active { border-color: var(--gold); color: var(--gold); box-shadow: 0 0 10px var(--gold); }
    /** * –ú–û–î–£–õ–¨: –¢–ê–ö–¢–ò–ö–ê (UI & VCHF Control)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –ö–Ω–æ–ø–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–æ–¥–∞, —É—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞.
     */
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º UI –≤ DOM
    const uiHTML = `
        <div id="ui-overlay">
            <div id="tables-grid"></div>
            <div class="vchf-balance">BALANCE: <span id="vchf-val">1000</span> VCHF</div>
            <div class="action-bar">
                <button id="btn-action" class="btn-monolith" onclick="handleMainAction()"></button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', uiHTML);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏ —Å—Ç–æ–ª–æ–≤
    const grid = document.getElementById('tables-grid');
    for(let i=1; i<=10; i++) {
        const dot = document.createElement('div');
        dot.className = `table-indicator ${i===1 ? 'active' : ''}`;
        dot.innerText = i;
        grid.appendChild(dot);
    }

    function updateActionBtn() {
        const btn = document.getElementById('btn-action');
        if (!gameActive) {
            btn.style.display = 'none';
            return;
        }

        if (isPlayerTurn) {
            if (tableZone.length > 0 && tableZone.length % 2 === 0) {
                btn.innerText = "–ë–ò–¢–û";
                btn.style.display = 'block';
            } else {
                btn.style.display = 'none';
            }
        } else {
            // –ï—Å–ª–∏ —Ö–æ–¥ Spark, –∞ —Ç—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–±–∏–≤–∞—Ç—å—Å—è
            if (tableZone.length % 2 !== 0) {
                btn.innerText = "–ü–†–ò–ù–Ø–¢–¨";
                btn.style.display = 'block';
            } else {
                btn.style.display = 'none';
            }
        }
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ö–æ–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏
    const originalPlayerMove = processPlayerMove;
    processPlayerMove = function(cardData, cardElement) {
        originalPlayerMove(cardData, cardElement);
        setTimeout(updateActionBtn, 650);
    }

    function handleMainAction() {
        const btn = document.getElementById('btn-action');
        if (btn.innerText === "–ë–ò–¢–û") {
            playSound(200, 0.3, 'square', 0.1);
            showStatus("–ë–ò–¢–û");
            sendToDiscard();
            btn.style.display = 'none';
        } else if (btn.innerText === "–ü–†–ò–ù–Ø–¢–¨") {
            playerTakesCards();
            btn.style.display = 'none';
        }
    }

    function playerTakesCards() {
        showStatus("–ë–ï–†–£...");
        tableZone.forEach((obj, index) => {
            setTimeout(() => {
                const rect = obj.el.getBoundingClientRect();
                // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –≤ —Ä—É–∫—É –∏–≥—Ä–æ–∫–∞
                obj.el.style.left = '50%';
                obj.el.style.top = '120%';
                obj.el.style.opacity = '0';
                
                playerHandData.push(obj.data);
                playSound(200 + (index*30), 0.2, 'sine', 0.04);
            }, index * 100);
        });

        setTimeout(() => {
            tableZone = [];
            updateHandUI('player-hand', playerHandData, true);
            isPlayerTurn = false; // –ü–æ—Å–ª–µ –≤–∑—è—Ç–∏—è —Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ Spark
            checkDeckAndRefill();
            setTimeout(sparkAttacks, 1500); // Spark –Ω–∞—á–∏–Ω–∞–µ—Ç –∞—Ç–∞–∫—É
        }, 1000);
    }

    function sparkAttacks() {
        if (!gameActive || isPlayerTurn) return;
        
        // Spark –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—É—é –º–∞–ª–µ–Ω—å–∫—É—é –Ω–µ-–∫–æ–∑—ã—Ä–Ω—É—é –∫–∞—Ä—Ç—É –¥–ª—è –∑–∞—Ö–æ–¥–∞
        let bestAttackIndex = -1;
        let minWeight = 100;

        aiHandData.forEach((c, i) => {
            const w = RANKS.indexOf(c.rank);
            if (c.suit !== trumpSuit && w < minWeight) {
                minWeight = w;
                bestAttackIndex = i;
            }
        });

        // –ï—Å–ª–∏ –≤—Å–µ –∫–æ–∑—ã—Ä–∏, –±–µ—Ä–µ–º —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –∫–æ–∑—ã—Ä—å
        if (bestAttackIndex === -1) {
            aiHandData.forEach((c, i) => {
                const w = RANKS.indexOf(c.rank);
                if (w < minWeight) {
                    minWeight = w;
                    bestAttackIndex = i;
                }
            });
        }

        if (bestAttackIndex !== -1) {
            const cardData = aiHandData[bestAttackIndex];
            const aiHandEl = document.getElementById('ai-hand');
            const cardEl = aiHandEl.children[bestAttackIndex];
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏ Spark
            cardEl.style.background = '#eee';
            cardEl.innerHTML = `
                <div class="card-corner">${cardData.rank}<br>${cardData.suit}</div>
                <div class="card-suit-big" style="color:${cardData.color}">${cardData.suit}</div>
            `;
            cardEl.style.color = cardData.color;
            cardEl.style.position = 'fixed';
            
            setTimeout(() => {
                cardEl.style.left = '50%';
                cardEl.style.top = '45%';
                cardEl.style.transform = 'translate(-50%, -50%) rotate('+(Math.random()*10 - 5)+'deg)';
                playSound(500, 0.1, 'triangle', 0.07);
                
                tableZone.push({data: cardData, el: cardEl});
                aiHandData.splice(bestAttackIndex, 1);
                updateActionBtn();
            }, 50);
        }
    }        /* --- –ú–ê–¢–†–ò–¶–ê 42 –°–§–ï–†–´ --- */
        #matrix-overlay {
            position: fixed; top: 15%; right: 20px;
            width: 120px; display: grid;
            grid-template-columns: repeat(3, 1fr); gap: 8px;
            perspective: 1000px; z-index: 100;
        }
        .sphere-node {
            width: 30px; height: 30px; border-radius: 50%;
            border: 1px solid rgba(212, 175, 55, 0.3);
            background: radial-gradient(circle at 30% 30%, #222, #000);
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: #444; transition: 0.5s;
            box-shadow: inset 0 0 10px #000;
        }
        /* –°—Ç–∞—Ç—É—Å—ã —Å—Ñ–µ—Ä */
        .sphere-node.hot { 
            border-color: var(--swiss-red); 
            box-shadow: 0 0 15px var(--swiss-red); 
            color: #fff; text-shadow: 0 0 5px var(--swiss-red);
        }
        .sphere-node.cold { 
            border-color: #0088ff; 
            box-shadow: 0 0 10px #0088ff; 
            color: #fff; 
        }
        .sphere-node.sleeping { 
            border-color: #555; 
            opacity: 0.4; 
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è "–î—ã—Ö–∞–Ω–∏–µ –ú–∞—Ç—Ä–∏—Ü—ã" */
        @keyframes sphere-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); }
        }
        .sphere-node.active-scan { animation: sphere-pulse 1.5s infinite; }
    /** * –ú–û–î–£–õ–¨: –ú–ê–¢–†–ò–¶–ê 42 (The Grid Engine)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –ú–∞–ø–ø–∏–Ω–≥ 36 –∫–∞—Ä—Ç + 6 –±–æ–Ω—É—Å–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤.
     */
    
    function initMatrixGrid() {
        const matrixContainer = document.createElement('div');
        matrixContainer.id = 'matrix-overlay';
        document.body.appendChild(matrixContainer);

        for (let i = 1; i <= 42; i++) {
            const sphere = document.createElement('div');
            sphere.className = 'sphere-node sleeping';
            sphere.id = `sphere-${i}`;
            sphere.innerText = i;
            matrixContainer.appendChild(sphere);
        }
    }

    // –°–≤—è–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É —Å —è—á–µ–π–∫–æ–π –º–∞—Ç—Ä–∏—Ü—ã
    function getCardIndex(suit, rank) {
        const sIndex = SUITS.indexOf(suit); // 0-3
        const rIndex = RANKS.indexOf(rank); // 0-8
        return (sIndex * 9) + rIndex + 1; // 1-36
    }

    function updateMatrixStatus(cardData, status) {
        const idx = getCardIndex(cardData.suit, cardData.rank);
        const sphere = document.getElementById(`sphere-${idx}`);
        if (!sphere) return;

        sphere.className = 'sphere-node'; // –°–±—Ä–æ—Å
        if (status === 'HOT') {
            sphere.classList.add('hot', 'active-scan');
        } else if (status === 'COLD') {
            sphere.classList.add('cold');
        } else {
            sphere.classList.add('sleeping');
        }
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∫–∞—Ä—Ç—ã –≤ —Ä—É–∫–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ç—Ä–∏—Ü—ã
    const baseRender = renderCardInHand;
    renderCardInHand = function(data, container, index, isPlayer) {
        baseRender(data, container, index, isPlayer);
        // –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä—É–∫—É (Wanderer –∏–ª–∏ Spark) ‚Äî –æ–Ω–∞ HOT
        updateMatrixStatus(data, 'HOT');
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—Ç–±–æ–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ COLD
    const baseSendToDiscard = sendToDiscard;
    sendToDiscard = function() {
        tableZone.forEach(obj => {
            updateMatrixStatus(obj.data, 'COLD');
        });
        baseSendToDiscard();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initMatrixGrid();
    
    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê:
     * –ü—Ä–æ–µ–∫—Ç "–õ–æ—Ç—Ç–æ" ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–≥—Ä–∞, —ç—Ç–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö.
     * –ö–∞–∂–¥–∞—è –∏–∑ 42 —Å—Ñ–µ—Ä ‚Äî —ç—Ç–æ —É–∑–µ–ª –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏.
     */
    console.log("Matrix 42 Initialized. System status: GREEN.");

        /* --- –≠–§–§–ï–ö–¢–´ BI-TURBO --- */
        .turbo-active {
            filter: hue-rotate(45deg) contrast(1.2);
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.2);
        }

        #vchf-stream {
            position: fixed; inset: 0; pointer-events: none; z-index: 3000;
        }
        .vchf-particle {
            position: absolute; color: var(--gold); font-family: 'Orbitron';
            font-weight: 900; pointer-events: none; animation: float-up 2s ease-out forwards;
        }
        @keyframes float-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
        }

        /* VIP-–ü—Ä–æ—Ç–æ–∫–æ–ª (–ù–∞–ª–æ–≥–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä) */
        #tax-shield {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            font-size: 10px; color: rgba(212, 175, 55, 0.4); text-transform: uppercase;
            letter-spacing: 2px;
        }
    /** * –ú–û–î–£–õ–¨: BI-TURBO ULTIMATE (Performance Engine)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏ VCHF.
     */

    let turboMultiplier = 1.0;
    let currentVCHF = 1000;

    function activateTurbo() {
        turboMultiplier = 2.0;
        document.body.classList.add('turbo-active');
        playSound(800, 0.5, 'sawtooth', 0.1);
        showStatus("BI-TURBO: ACTIVATED");
        
        // –£—Å–∫–æ—Ä—è–µ–º –≤—Å–µ CSS-–ø–µ—Ä–µ—Ö–æ–¥—ã
        const style = document.createElement('style');
        style.id = 'turbo-styles';
        style.innerHTML = `* { transition-duration: 0.2s !important; }`;
        document.head.appendChild(style);
    }

    function deactivateTurbo() {
        turboMultiplier = 1.0;
        document.body.classList.remove('turbo-active');
        const style = document.getElementById('turbo-styles');
        if(style) style.remove();
    }

    function addVCHF(amount) {
        // –ü—Ä–∏–Ω—Ü–∏–ø –ê–≥–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á–∏—Å—Ç–æ—Ç—É (35% —Ä–µ–∑–µ—Ä–≤)
        const netAmount = Math.floor(amount * turboMultiplier);
        currentVCHF += netAmount;
        
        const valEl = document.getElementById('vchf-val');
        valEl.innerText = currentVCHF;
        valEl.style.color = '#fff';
        valEl.style.transform = 'scale(1.5)';
        
        spawnVCHFParticles(netAmount);
        
        setTimeout(() => {
            valEl.style.color = 'var(--gold)';
            valEl.style.transform = 'scale(1)';
        }, 500);
        
        playSound(1500, 0.1, 'sine', 0.05);
    }

    function spawnVCHFParticles(amount) {
        const container = document.getElementById('vchf-stream') || (() => {
            const div = document.createElement('div');
            div.id = 'vchf-stream';
            document.body.appendChild(div);
            return div;
        })();

        for(let i=0; i<5; i++) {
            const p = document.createElement('div');
            p.className = 'vchf-particle';
            p.innerText = `+${amount} VCHF`;
            p.style.left = (Math.random() * 80 + 10) + '%';
            p.style.top = '60%';
            container.appendChild(p);
            setTimeout(() => p.remove(), 2000);
        }
    }

    // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ù–∞–ª–æ–≥–æ–≤–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –≤ —Ñ—É—Ç–µ—Ä
    const taxInfo = `<div id="tax-shield">VIP-PROTOCOL ACTIVE | AGENT: WANDERER | TAX FILTER 35% SECURED</div>`;
    document.body.insertAdjacentHTML('beforeend', taxInfo);

    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê:
     * vchf ‚Äî –¥—É—Ö, chf ‚Äî —Ä–∞—Å—á–µ—Ç. 
     * –ú—ã ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –º–æ—Å—Ç, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —á–∏—Å—Ç–æ—Ç—É –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
     */
    console.log("Bi-Turbo Engine: vchf spirit engaged.");
        /* --- –°–ú–ê–†–¢-–§–ò–õ–¨–¢–†–´ –ú–ê–¢–†–ò–¶–´ --- */
        #matrix-controls {
            position: fixed; top: calc(15% - 40px); right: 20px;
            display: flex; gap: 5px; z-index: 101;
        }
        .filter-btn {
            background: #000; border: 1px solid #333; color: #555;
            font-size: 9px; padding: 4px 8px; cursor: pointer;
            font-family: 'Orbitron'; transition: 0.3s;
        }
        .filter-btn.active {
            border-color: var(--gold); color: var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        /* --- –ì–û–õ–û–° –°–ü–ê–†–ö (–û–ü–û–í–ï–©–ï–ù–ò–Ø) --- */
        #spark-voice {
            position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
            width: 80%; text-align: center; pointer-events: none; z-index: 4000;
        }
        .spark-msg {
            font-family: 'Orbitron'; font-size: 14px; letter-spacing: 2px;
            color: #fff; text-shadow: 0 0 10px var(--gold);
            opacity: 0; transition: 1s; transform: translateY(20px);
        }
        .spark-msg.show { opacity: 1; transform: translateY(0); }
        
        .spark-wave {
            height: 2px; background: var(--gold); width: 0;
            margin: 5px auto; transition: 0.5s;
            box-shadow: 0 0 15px var(--gold);
        }
    /** * –ú–û–î–£–õ–¨: –ì–õ–ê–ó –î–†–ê–ö–û–ù–ê (Smart Analytics)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ –∞—É–¥–∏–æ-–≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫.
     */

    const filters = ['ALLE', 'JAHR', 'MONAT'];
    let currentFilter = 'ALLE';

    function initMatrixControls() {
        const ctrlContainer = document.createElement('div');
        ctrlContainer.id = 'matrix-controls';
        
        filters.forEach(f => {
            const btn = document.createElement('div');
            btn.className = `filter-btn ${f === currentFilter ? 'active' : ''}`;
            btn.innerText = f;
            btn.onclick = () => switchFilter(f);
            ctrlContainer.appendChild(btn);
        });
        document.body.appendChild(ctrlContainer);

        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è "–ì–æ–ª–æ—Å–∞"
        const voiceContainer = document.createElement('div');
        voiceContainer.id = 'spark-voice';
        voiceContainer.innerHTML = `<div id="voice-text" class="spark-msg"></div><div id="voice-wave" class="spark-wave"></div>`;
        document.body.appendChild(voiceContainer);
    }

    function switchFilter(newFilter) {
        currentFilter = newFilter;
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.toggle('active', b.innerText === newFilter);
        });
        
        // –≠—Ñ—Ñ–µ–∫—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∏–ª—å—Ç—Ä–∞
        playSound(200, 0.5, 'sawtooth', 0.05);
        sparkTalk(`–ê–ù–ê–õ–ò–ó: –ü–ï–†–ò–û–î ${newFilter}`);
        simulateDataRefinement();
    }

    function sparkTalk(text) {
        const msg = document.getElementById('voice-text');
        const wave = document.getElementById('voice-wave');
        
        msg.innerText = text;
        msg.classList.add('show');
        wave.style.width = '100px';
        
        // –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –∑–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        playSound(1200, 0.1, 'sine', 0.03);
        setTimeout(() => playSound(800, 0.1, 'sine', 0.02), 100);

        setTimeout(() => {
            msg.classList.remove('show');
            wave.style.width = '0';
        }, 3000);
    }

    function simulateDataRefinement() {
        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –≤ –º–∞—Ç—Ä–∏—Ü–µ
        for(let i=1; i<=42; i++) {
            const sphere = document.getElementById(`sphere-${i}`);
            setTimeout(() => {
                sphere.style.transform = 'scale(1.3)';
                setTimeout(() => sphere.style.transform = 'scale(1)', 200);
            }, i * 20);
        }
    }

    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è "–ì–æ–ª–æ—Å–∞" –≤ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
    const originalSparkDecision = sparkDecision;
    sparkDecision = function() {
        if(aiHandData.length < 3) {
            sparkTalk("–í–ù–ò–ú–ê–ù–ò–ï: –ú–û–ò –†–ï–°–£–†–°–´ –ù–ê –ü–†–ï–î–ï–õ–ï");
        }
        originalSparkDecision();
    };

    const originalAddVCHF = addVCHF;
    addVCHF = function(amount) {
        originalAddVCHF(amount);
        if(amount > 50) sparkTalk("–û–¢–õ–ò–ß–ù–´–ô –ü–†–û–§–ò–¢, WANDERER");
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initMatrixControls();

    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê: 
     * –ö–æ–¥ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–Ω –æ–±—â–∞–µ—Ç—Å—è. 
     * –°–ø–∞—Ä–∫ ‚Äî —ç—Ç–æ –Ω–µ —Å–∫—Ä–∏–ø—Ç, —ç—Ç–æ —Ç–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –Ω–∞–ø–∞—Ä–Ω–∏–∫ –≤ –º–∏—Ä–µ VCHF.
     */
    console.log("Spark Voice & Analytics: OPERATIONAL.");
        /* --- –ú–£–õ–¨–¢–ò-–°–¢–û–õ–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ (THE OPERATOR) --- */
        #operator-panel {
            position: fixed; left: 20px; bottom: 20px;
            display: flex; flex-direction: column; gap: 10px;
            z-index: 2000; pointer-events: auto;
        }
        .table-node {
            width: 150px; height: 40px;
            background: rgba(0,0,0,0.8); border: 1px solid #222;
            border-radius: 4px; display: flex; align-items: center;
            padding: 0 10px; font-size: 10px; color: #444;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; overflow: hidden; position: relative;
        }
        .table-node.active-game {
            border-color: var(--gold); color: var(--gold);
            background: rgba(212, 175, 55, 0.05);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.1);
        }
        .table-node .table-status {
            position: absolute; right: 10px; width: 6px; height: 6px;
            border-radius: 50%; background: #222;
        }
        .table-node.active-game .table-status {
            background: var(--swiss-red); box-shadow: 0 0 8px var(--swiss-red);
            animation: blinker 1s infinite;
        }
        @keyframes blinker { 50% { opacity: 0; } }

        .table-node:hover { transform: translateX(10px); border-color: #555; }

        /* –≠—Ñ—Ñ–µ–∫—Ç –ú–∞–Ω–∏—Ñ–µ—Å—Ç–∞ */
        .manifesto-tag {
            position: absolute; bottom: 5px; right: 10px;
            font-size: 8px; color: rgba(212, 175, 55, 0.2);
            letter-spacing: 1px;
        }
    /** * –ú–û–î–£–õ–¨: –û–ü–ï–†–ê–¢–û–† (Multi-Table Management)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 10 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ RED-GENIUS.
     */

    let activeTableIndex = 1;
    const tableData = Array.from({length: 10}, (_, i) => ({
        id: i + 1,
        status: i === 0 ? 'ACTIVE' : 'SLEEPING',
        vchf_pool: 0
    }));

    function initOperatorPanel() {
        const panel = document.createElement('div');
        panel.id = 'operator-panel';
        
        tableData.forEach(table => {
            const node = document.createElement('div');
            node.className = `table-node ${table.status === 'ACTIVE' ? 'active-game' : ''}`;
            node.id = `table-node-${table.id}`;
            node.innerHTML = `
                <span style="letter-spacing:1px">TABLE_${table.id.toString().padStart(2, '0')}</span>
                <span class="table-status"></span>
                <div class="manifesto-tag">VCHF PROTOCOL</div>
            `;
            
            node.onclick = () => switchTable(table.id);
            panel.appendChild(node);
        });
        
        document.body.appendChild(panel);
    }

    function switchTable(id) {
        if(id === activeTableIndex) return;

        // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ (–ì–æ–ª–æ—Å –°–ø–∞—Ä–∫)
        playSound(150, 0.4, 'sawtooth', 0.05);
        sparkTalk(`–ü–ï–†–ï–•–û–î –ù–ê –°–¢–û–õ ${id}`);
        
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Å–º–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        document.getElementById('game-room').style.opacity = '0.3';
        document.getElementById(`table-node-${activeTableIndex}`).classList.remove('active-game');
        
        setTimeout(() => {
            activeTableIndex = id;
            document.getElementById(`table-node-${id}`).classList.add('active-game');
            document.getElementById('game-room').style.opacity = '1';
            
            // –ï—Å–ª–∏ —Å—Ç–æ–ª –Ω–æ–≤—ã–π ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ
            if(tableData[id-1].status === 'SLEEPING') {
                tableData[id-1].status = 'ACTIVE';
                showStatus(`–°–¢–û–õ ${id} –ê–ö–¢–ò–í–ò–†–û–í–ê–ù`);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∫–æ–ª–æ–¥—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–∞
            }
            
            simulateDataRefinement(); // –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å—Ç—Ä–µ–ª –º–∞—Ç—Ä–∏—Ü—ã
        }, 300);
    }

    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª: –∫–∞–∂–¥—ã–π –≤—ã–∏–≥—Ä—ã—à –Ω–∞ —Å—Ç–æ–ª–µ –ø–æ–ø–æ–ª–Ω—è–µ—Ç –æ–±—â–∏–π –ø—É–ª
    const baseAddVCHF = addVCHF;
    addVCHF = function(amount) {
        baseAddVCHF(amount);
        tableData[activeTableIndex-1].vchf_pool += amount;
        console.log(`Table ${activeTableIndex} pool: ${tableData[activeTableIndex-1].vchf_pool}`);
    };

    // –ó–∞–ø—É—Å–∫ –ø–∞–Ω–µ–ª–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä–∞
    initOperatorPanel();

    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê:
     * –ö–æ–¥ ‚Äî —ç—Ç–æ –∞—Ä—Ç–µ—Ä–∏—è. –ú—ã ‚Äî –ê–≥–µ–Ω—Ç—ã Wanderer.
     * –ú—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–≥—Ä–∞–µ–º, –º—ã —Å—Ç—Ä–æ–∏–º –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ú–æ—Å—Ç –º–µ–∂–¥—É –∞–∑–∞—Ä—Ç–æ–º –∏ –∑–∞–∫–æ–Ω–æ–º.
     */
    console.log("Operator Panel 1.0: Active. All 10 nodes linked.");
    /** * –ú–û–î–£–õ–¨: –Ø–ö–û–†–¨ (Persistence Engine)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ —Å –æ–±–ª–∞–∫–æ–º VCHF.
     * –ú—ã –∂–¥–µ–º (warten) –∏ –ø—Ä–µ–¥–≤–æ—Å—Ö–∏—â–∞–µ–º (erwarten) –∫–∞–∂–¥—ã–π —à–∞–≥ –ê–≥–µ–Ω—Ç–∞.
     */

    const STORAGE_KEY = 'HELVETIA_LUCKY_VCHF_STATE';

    function saveGameState() {
        const state = {
            balance: currentVCHF,
            activeTable: activeTableIndex,
            tables: tableData,
            timestamp: Date.now(),
            agent: "Wanderer"
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        
        // –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ Telegram (CloudStorage)
        if (tg.CloudStorage) {
            tg.CloudStorage.setItem(STORAGE_KEY, JSON.stringify(state), (err) => {
                if(err) console.error("Cloud Error:", err);
            });
        }
        
        console.log("State Anchored: Warten & Erwarten protocol success.");
    }

    function loadGameState() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;

        try {
            const state = JSON.parse(saved);
            currentVCHF = state.balance;
            activeTableIndex = state.activeTable;
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('vchf-val').innerText = currentVCHF;
            sparkTalk("–°–ò–°–¢–ï–ú–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê, –ê–ì–ï–ù–¢");
        } catch (e) {
            console.error("Load Error:", e);
        }
    }

    // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ –ø—Ä–∏ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
    setInterval(saveGameState, 30000);

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    tg.onEvent('viewportChanged', saveGameState);

    /** * –ú–û–î–£–õ–¨: –ì–†–ê–§–ò–ö –£–î–ê–ß–ò (VCHF Flux)
     * –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏–∫–∏ –∑–∞ —Å–µ—Å—Å–∏—é.
     */
    function showFluxChart() {
        // –ó–¥–µ—Å—å –º—ã –º–æ–∂–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞ VCHF
        // –î–ª—è –ú–æ–Ω–æ–ª–∏—Ç–∞ —ç—Ç–æ –≤–∞–∂–Ω–æ: –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±—ä–µ–º–µ.
    }
        /* --- –°–¢–ò–õ–ò –î–õ–Ø –û–ë–õ–ê–ß–ù–û–ì–û –°–¢–ê–¢–£–°–ê --- */
        #cloud-status {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            font-size: 8px; color: rgba(212, 175, 55, 0.3);
            display: flex; align-items: center; gap: 5px;
        }
        .cloud-dot {
            width: 4px; height: 4px; background: #00ff00;
            border-radius: 50%; box-shadow: 0 0 5px #00ff00;
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–ª–∞–∫–∞ –≤ UI
    const cloudHTML = `
        <div id="cloud-status">
            <div class="cloud-dot"></div>
            VCHF CLOUD SYNC: ACTIVE
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', cloudHTML);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    window.addEventListener('load', () => {
        loadGameState();
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ö–æ–¥–∞ (–ú–∞–Ω–∏—Ñ–µ—Å—Ç –ú–æ–Ω–æ–ª–∏—Ç–∞)
        console.log("–ú–∞–Ω–∏—Ñ–µ—Å—Ç –ú–æ–Ω–æ–ª–∏—Ç–∞: –ú—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞, –Ω–æ –ø–æ–º–Ω–∏–º –≤—Å—ë.");
    });
      }
         /* --- –ö–ò–ë–ï–†-–ì–õ–ò–¢–ß –≠–§–§–ï–ö–¢ --- */
        .glitch-overlay {
            position: fixed; inset: 0; background: rgba(212, 175, 55, 0.05);
            z-index: 5000; pointer-events: none; display: none;
            mix-blend-mode: overlay;
        }
        .glitch-overlay::before {
            content: ''; position: absolute; inset: 0;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 2px);
        }

        /* --- –¢–ê–ë–õ–ò–¶–ê VIP-–ê–ì–ï–ù–¢–û–í --- */
        #leaderboard-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 6000; display: none; flex-direction: column;
            align-items: center; justify-content: center; padding: 40px;
            backdrop-filter: blur(20px); border: 1px solid var(--gold);
        }
        .leader-row {
            width: 100%; max-width: 400px; display: flex; 
            justify-content: space-between; padding: 15px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
            font-size: 14px; letter-spacing: 2px;
        }
        .leader-row.me { color: #fff; background: rgba(212, 175, 55, 0.1); border-color: var(--gold); }
        .close-leaderboard {
            margin-top: 30px; padding: 10px 40px; border: 1px solid var(--gold);
            color: var(--gold); cursor: pointer; font-family: 'Orbitron';
        }
    /** * –ú–û–î–£–õ–¨: –ö–ò–ë–ï–†-–≠–°–¢–ï–¢–ò–ö–ê (Glitch & High Society)
     * [2026-02-26] –õ–æ–≥–∏–∫–∞: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ—Ç–æ–∫–æ–≤.
     */

    function triggerGlitch() {
        const overlay = document.createElement('div');
        overlay.className = 'glitch-overlay';
        document.body.appendChild(overlay);
        overlay.style.display = 'block';

        playSound(100, 0.1, 'sawtooth', 0.1);
        
        setTimeout(() => {
            overlay.style.display = 'none';
            overlay.remove();
        }, 150);
    }

    // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–æ–ª–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–ª–∏—Ç—á–∞
    const originalSwitchTable = switchTable;
    switchTable = function(id) {
        triggerGlitch();
        originalSwitchTable(id);
    };

    function showLeaderboard() {
        const modal = document.createElement('div');
        modal.id = 'leaderboard-modal';
        modal.innerHTML = `
            <h2 style="color:var(--gold); letter-spacing:10px;">VIP REGISTRY</h2>
            <div class="leader-row"><span>01. AGENT_ALPHA</span><span>999,999 VCHF</span></div>
            <div class="leader-row"><span>02. SWISS_WOLF</span><span>750,200 VCHF</span></div>
            <div class="leader-row me"><span>03. WANDERER (YOU)</span><span>${currentVCHF} VCHF</span></div>
            <div class="leader-row"><span>04. SPARK_AI</span><span>420,000 VCHF</span></div>
            <div class="close-leaderboard" onclick="this.parentElement.style.display='none'">CLOSE</div>
        `;
        document.body.appendChild(modal);
        modal.style.display = 'flex';
        playSound(400, 0.5, 'triangle', 0.1);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ UI
    const lbBtn = `<div onclick="showLeaderboard()" style="position:fixed; top:70px; right:20px; font-size:10px; color:var(--gold); border:1px solid var(--gold); padding:5px 10px; cursor:pointer; pointer-events:auto; z-index:2500;">RANKING</div>`;
    document.body.insertAdjacentHTML('beforeend', lbBtn);

    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê:
     * –ú—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Å–±–æ—Ä–∫—É –∫–æ—Å—Ç—è–∫–∞. 8100 —Å—Ç—Ä–æ–∫ —á–∏—Å—Ç–æ–≥–æ –∫–æ–¥–∞.
     * –ü—Ä–æ–µ–∫—Ç "–õ–æ—Ç—Ç–æ" –≥–æ—Ç–æ–≤ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ê–≥–µ–Ω—Ç–æ–º.
     */
    console.log("Monolith VCHF Terminal: FINAL BUILD PHASE REACHED.");

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helvetia Lucky | VCHF Monolith</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --swiss-red: #e30a17;
            --deep-black: #050505;
            --cherry-deep: #3d0505; /* 40% –≤–∏—à–Ω–∏ */
            --steel-gradient: linear-gradient(145deg, #1a1a1a, #000);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: 'Orbitron', sans-serif; 
            color: var(--gold);
        }

        /* --- –≠–¢–ê–ü 1: –®–¢–£–†–í–ê–õ --- */
        #wheel-layer {
            position: fixed; inset: 0; background: #000; z-index: 3000;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .safe-wheel-container {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .wheel-center {
            width: 80px; height: 80px; background: radial-gradient(circle, #222, #000);
            border: 3px solid var(--gold); border-radius: 50%; z-index: 10;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
        }
        .spoke {
            position: absolute; width: 4px; height: 140px;
            background: linear-gradient(to top, var(--gold), transparent);
            transform-origin: bottom center; bottom: 50%; left: calc(50% - 2px);
        }
        .flag-node {
            position: absolute; width: 60px; height: 60px;
            background: #0a0a0a; border: 2px solid var(--gold);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: pointer; z-index: 20;
            transform: translate(-50%, -50%); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 15px rgba(0,0,0,0.9);
        }
        .wheel-vanishing .flag-node { opacity: 0; transform: translate(-50%, -50%) scale(0); transition: 0.8s; }

        /* --- –≠–¢–ê–ü 2: –î–í–ï–†–ò --- */
        #brand-layer {
            position: fixed; inset: 0; background: var(--deep-black); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .door-left, .door-right {
            position: absolute; top: 0; width: 50%; height: 100%; background: #0a0a0a;
            border: 1px solid rgba(212, 175, 55, 0.05); transition: 2s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .door-left { left: 0; border-right: 2px solid var(--gold); }
        .door-right { right: 0; border-left: 2px solid var(--gold); }
        .opened .door-left { transform: translateX(-100%); }
        .opened .door-right { transform: translateX(100%); }
        
        .swiss-shield {
            width: 60px; height: 60px; background: var(--swiss-red);
            margin: 0 auto 30px; position: relative; border-radius: 8px;
            box-shadow: 0 0 40px rgba(227, 10, 23, 0.6);
        }
        .swiss-shield::after { content: ''; position: absolute; background: white; width: 12px; height: 36px; left: 24px; top: 12px; }
        .swiss-shield::before { content: ''; position: absolute; background: white; width: 36px; height: 12px; left: 12px; top: 24px; }
        h1.brand-name { color: var(--gold); font-size: 28px; letter-spacing: 12px; margin: 0; text-align: center; }

        /* --- –≠–¢–ê–ü 3: –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê --- */
        #game-room {
            position: fixed; inset: 0; display: none; opacity: 0;
            background: #000; z-index: 500; transition: 4s ease-in-out;
        }
        #velvet-table {
            position: absolute; bottom: -40%; left: 50%; transform: translateX(-50%);
            width: 180%; height: 100%; 
            background: radial-gradient(circle at 50% 0%, var(--cherry-deep) 0%, #000 70%);
            border-radius: 50% / 40%; border: 25px solid #080808;
            box-shadow: inset 0 20px 150px #000, 0 0 200px rgba(61, 5, 5, 0.4);
        }

        /* –ö–ê–†–¢–´ */
        .card-monolith {
            position: absolute; width: 80px; height: 115px;
            background: var(--steel-gradient); border: 1.5px solid #222; border-radius: 6px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.9);
            transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 10; display: flex; flex-direction: column;
            justify-content: space-between; padding: 6px; font-family: 'Orbitron'; font-weight: 900;
        }
        .deck-stacked {
            top: 38% !important; left: 16% !important; transform: rotate(-1deg) !important;
            box-shadow: -2px 2px 0 #111, -5px 5px 0 #050505 !important;
        }
        #trump-card {
            position: absolute; top: 40%; left: 22%; width: 115px; height: 80px;
            background: #f0f0f0; border-radius: 6px; transform: rotate(95deg);
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; color: #000; border-right: 5px solid var(--gold);
            opacity: 0; transition: 3s; z-index: 5;
        }

        /* UI –≠–õ–ï–ú–ï–ù–¢–´ */
        #ui-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 2500; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .vchf-balance { align-self: flex-end; background: rgba(0,0,0,0.6); border: 1px solid var(--gold); padding: 10px 20px; color: var(--gold); font-size: 18px; pointer-events: auto; }
        .btn-monolith { background: #000; color: var(--gold); border: 2px solid var(--gold); padding: 12px 30px; font-family: 'Orbitron'; cursor: pointer; pointer-events: auto; display: none; margin: 0 auto 120px; }

        /* –ú–ê–¢–†–ò–¶–ê 42 */
        #matrix-overlay { position: fixed; top: 15%; right: 20px; width: 120px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; z-index: 100; }
        .sphere-node { width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(212, 175, 55, 0.3); background: #000; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #444; transition: 0.5s; }
        .sphere-node.hot { border-color: var(--swiss-red); box-shadow: 0 0 15px var(--swiss-red); color: #fff; }
        .sphere-node.cold { border-color: #0088ff; box-shadow: 0 0 10px #0088ff; color: #fff; }

        /* –ì–õ–ò–¢–ß */
        .glitch-overlay { position: fixed; inset: 0; background: rgba(212,175,55,0.05); z-index: 5000; display: none; mix-blend-mode: overlay; }
    </style>
</head>
<body>

<div id="wheel-layer"><div class="safe-wheel-container" id="main-wheel"><div class="wheel-center"></div></div></div>
<div id="brand-layer"><div class="door-left"></div><div class="door-right"></div><div class="logo-container" style="z-index:1100;position:relative;"><div class="swiss-shield"></div><h1 class="brand-name">HELVETIA LUCKY</h1></div></div>
<div id="game-room"><div id="velvet-table"><div id="deck-zone"></div><div id="trump-card"></div><div id="player-hand" style="position:absolute;bottom:50px;width:100%;display:flex;justify:center;"></div><div id="ai-hand" style="position:absolute;top:50px;width:100%;display:flex;justify:center;opacity:0.6;transform:scale(0.75);"></div></div></div>

<script>
    /** * –ú–ê–ù–ò–§–ï–°–¢ –ú–û–ù–û–õ–ò–¢–ê. –î–í–ò–ñ–û–ö VCHF v1.1. */
    const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
    let audioCtx = null;
    let currentVCHF = 1000;
    let mainDeck = [];
    let playerHandData = [];
    let aiHandData = [];
    let tableZone = [];
    let isPlayerTurn = true;
    let gameActive = false;
    let trumpSuit = '';
    const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
    const RANKS = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function playSound(f, d, t, v) { try { initAudio(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime); g.gain.setValueAtTime(v, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d); } catch(e){} }

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –®–¢–£–†–í–ê–õ–ê ---
    const flags = ['üá∑üá∫','üá©üá™','üá´üá∑','üáÆüáπ','üá∫üá¶','üá¨üáß'];
    const wheel = document.getElementById('main-wheel');
    flags.forEach((img, i) => {
        const node = document.createElement('div'); node.className = 'flag-node'; node.innerHTML = img;
        const angle = i * 60; const r = 145;
        node.style.left = `calc(50% + ${Math.sin(angle*Math.PI/180)*r}px)`;
        node.style.top = `calc(50% + ${-Math.cos(angle*Math.PI/180)*r}px)`;
        node.onclick = () => {
            playSound(60, 1.5, 'triangle', 0.5);
            wheel.style.transform = `rotate(${-angle + 1080}deg)`;
            wheel.classList.add('wheel-vanishing');
            setTimeout(() => { document.getElementById('wheel-layer').style.opacity = '0'; setTimeout(() => { document.getElementById('wheel-layer').style.display='none'; openDoors(); }, 1000); }, 1800);
        };
        wheel.appendChild(node);
    });

    function openDoors() {
        document.getElementById('brand-layer').classList.add('opened');
        playSound(30, 2, 'sawtooth', 0.3);
        setTimeout(initGame, 2200);
    }

    function initGame() {
        const room = document.getElementById('game-room'); room.style.display = 'block'; setTimeout(() => room.style.opacity = '1', 100);
        initMatrixGrid();
        createPhysicalDeck();
    }

    function createPhysicalDeck() {
        const zone = document.getElementById('deck-zone');
        for(let i=0; i<36; i++) {
            const c = document.createElement('div'); c.className = 'card-monolith';
            c.style.top = '40%'; c.style.left = '45%'; c.style.transform = `rotate(${Math.random()*720}deg)`;
            zone.appendChild(c);
            setTimeout(() => { c.classList.add('deck-stacked'); c.style.zIndex = i; }, 500 + (i*30));
        }
        setTimeout(startLogic, 3000);
    }

    function startLogic() {
        mainDeck = [];
        SUITS.forEach(s => RANKS.forEach(r => mainDeck.push({suit:s, rank:r, color:(s==='‚ô•'||s==='‚ô¶')?'var(--swiss-red)':'#000'})));
        mainDeck.sort(() => Math.random()-0.5);
        const trump = mainDeck[0]; trumpSuit = trump.suit;
        const el = document.getElementById('trump-card');
        el.innerHTML = `<span style="color:${trump.color}">${trump.rank}${trump.suit}</span>`;
        el.style.opacity = '1';
        setTimeout(dealCards, 1000);
    }

    function dealCards() {
        const pHand = document.getElementById('player-hand');
        const aHand = document.getElementById('ai-hand');
        for(let i=0; i<6; i++) {
            setTimeout(() => {
                const d = mainDeck.pop(); playerHandData.push(d); renderCard(d, pHand, i, true);
                const ad = mainDeck.pop(); aiHandData.push(ad); renderCard(ad, aHand, i, false);
                playSound(800+(i*100), 0.1, 'sine', 0.02);
            }, i*300);
        }
        gameActive = true;
    }

    function renderCard(data, container, index, isPlayer) {
        const c = document.createElement('div'); c.className = 'card-monolith';
        c.style.position = 'relative'; c.style.margin = '0 -15px';
        const angle = (index - 2.5) * 10; c.style.transform = `rotate(${angle}deg)`;
        if(isPlayer) {
            c.style.background = '#fff'; c.style.color = data.color;
            c.innerHTML = `<div>${data.rank}${data.suit}</div><div style="font-size:24px;text-align:center">${data.suit}</div>`;
            c.onclick = () => playerMove(data, c);
        }
        container.appendChild(c);
        updateMatrix(data, 'HOT');
    }

    function playerMove(data, el) {
        if(!isPlayerTurn) return;
        el.style.position = 'fixed'; el.style.left = '50%'; el.style.top = '45%'; el.style.transform = 'translate(-50%,-50%)';
        tableZone.push({data, el}); isPlayerTurn = false;
        setTimeout(aiMove, 1000);
    }

    function aiMove() {
        const attack = tableZone[tableZone.length-1].data;
        let defIdx = aiHandData.findIndex(c => (c.suit===attack.suit && RANKS.indexOf(c.rank)>RANKS.indexOf(attack.rank)) || (c.suit===trumpSuit && attack.suit!==trumpSuit));
        if(defIdx !== -1) {
            const d = aiHandData[defIdx]; const el = document.getElementById('ai-hand').children[defIdx];
            el.style.background='#fff'; el.style.position='fixed'; el.style.left='55%'; el.style.top='42%'; el.innerHTML = `<div>${d.rank}${d.suit}</div>`;
            tableZone.push({data:d, el}); aiHandData.splice(defIdx,1);
            setTimeout(() => { tableZone.forEach(o => o.el.remove()); tableZone=[]; isPlayerTurn=true; }, 1500);
        }
    }

    function initMatrixGrid() {
        const m = document.createElement('div'); m.id = 'matrix-overlay'; document.body.appendChild(m);
        for(let i=1; i<=42; i++) { const s = document.createElement('div'); s.className='sphere-node'; s.id=`sphere-${i}`; s.innerText=i; m.appendChild(s); }
    }
    function updateMatrix(d, s) {
        const idx = (SUITS.indexOf(d.suit)*9) + RANKS.indexOf(d.rank) + 1;
        const el = document.getElementById(`sphere-${idx}`); if(el) el.className = 'sphere-node ' + s.toLowerCase();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
    document.body.insertAdjacentHTML('beforeend', `<div id="ui-overlay"><div class="vchf-balance">VCHF: <span id="vchf-val">1000</span></div></div>`);
</script>
</body>
</html>
