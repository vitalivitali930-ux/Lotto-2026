<!DOCTYPE html>
<html lang="ru" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VCHF Durak Elite | Mobile Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --cherry: #4a0404; /* Вишневый бархат */
            --bg: #000000;
            --card-w: 65px;
            --card-h: 100px;
        }
        body {
            background: radial-gradient(circle at center, var(--cherry) 0%, var(--bg) 100%);
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Стол */
        #table {
            flex-grow: 1;
            position: relative;
            margin: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 30px;
            background: rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Карты */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            background: #fff;
            border-radius: 6px;
            position: absolute;
            transition: all 0.4s ease-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            box-sizing: border-box;
            color: #000;
        }
        
        /* Рубашка */
        .card.back {
            background: #fff;
            border: 2px solid var(--gold);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .card.back::after {
            content: 'GLOBAL\nLOTTO\nTOOL';
            font-size: 8px;
            color: #000;
            white-space: pre;
            font-weight: bold;
        }

        .card .suit { font-size: 22px; align-self: center; }
        .card .val { font-size: 14px; font-weight: bold; }

        /* Зоны */
        #ai-hand { height: 110px; display: flex; justify-content: center; padding-top: 10px; }
        #player-hand { height: 130px; display: flex; justify-content: center; gap: -20px; padding-bottom: 20px; }
        #battle-area { width: 100%; height: 220px; position: relative; }

        /* Козырь и Колода */
        #deck-info { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); }
        .trump-card { transform: rotate(90deg); margin-bottom: 20px; }

        /* Кнопки */
        .controls { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 10px; }
        button {
            background: rgba(0,0,0,0.7);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 12px;
            border-radius: 10px;
            font-family: 'Orbitron';
            font-size: 10px;
        }
        .status-msg { position: absolute; width: 100%; text-align: center; top: 5px; color: var(--gold); font-size: 12px; }
    </style>
</head>
<body>

<div id="status" class="status-msg">Ваш ход, Wanderer</div>

<div id="ai-hand"></div>

<div id="table">
    <div id="deck-info">
        <div id="trump-slot"></div>
        <div id="deck-count" style="font-size: 10px; text-align: center; margin-top: 40px;">36</div>
    </div>
    <div id="battle-area"></div>
    <div class="controls">
        <button onclick="playerTake()">ВЗЯТЬ</button>
        <button onclick="finishTurn()">БИТО</button>
    </div>
</div>

<div id="player-hand"></div>

<script>
    const suits = ['♠', '♣', '♥', '♦'];
    const values = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const power = {'6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14};
    
    let deck = [], pHand = [], aHand = [], table = [], trump = null;
    let isPlayerTurn = true;

    function init() {
        deck = [];
        suits.forEach(s => values.forEach(v => deck.push({s, v, p: power[v]})));
        deck.sort(() => Math.random() - 0.5);
        
        for(let i=0; i<6; i++) {
            pHand.push(deck.pop());
            aHand.push(deck.pop());
        }
        trump = deck[0];
        render();
    }

    function createCardEl(card, hidden = false) {
        const div = document.createElement('div');
        div.className = `card ${hidden ? 'back' : ''}`;
        if(!hidden) {
            div.style.color = (card.s === '♥' || card.s === '♦') ? '#d00' : '#000';
            div.innerHTML = `<div class="val">${card.v}</div><div class="suit">${card.s}</div><div class="val" style="transform:rotate(180deg)">${card.v}</div>`;
        }
        return div;
    }

    function render() {
        const pDiv = document.getElementById('player-hand');
        pDiv.innerHTML = '';
        pHand.forEach((c, i) => {
            const el = createCardEl(c);
            el.style.position = 'relative';
            el.style.marginLeft = i > 0 ? '-30px' : '0';
            el.onclick = () => attack(i);
            pDiv.appendChild(el);
        });

        const aDiv = document.getElementById('ai-hand');
        aDiv.innerHTML = '';
        aHand.forEach(() => aDiv.appendChild(createCardEl({}, true)));

        const tSlot = document.getElementById('trump-slot');
        tSlot.innerHTML = '';
        if(deck.length > 0) tSlot.appendChild(createCardEl(trump));
        
        document.getElementById('deck-count').innerText = deck.length;
        renderTable();
    }

    function renderTable() {
        const area = document.getElementById('battle-area');
        area.innerHTML = '';
        table.forEach((pair, i) => {
            const wrap = document.createElement('div');
            wrap.style.position = 'absolute';
            wrap.style.left = (20 + i * 50) + 'px';
            wrap.appendChild(createCardEl(pair.att));
            if(pair.def) {
                const defEl = createCardEl(pair.def);
                defEl.style.marginTop = '20px';
                defEl.style.marginLeft = '10px';
                wrap.appendChild(defEl);
            }
            area.appendChild(wrap);
        });
    }

    function attack(idx) {
        if(!isPlayerTurn && table.length === 0) return;
        const card = pHand[idx];
        
        if(table.length === 0 || table.some(p => p.att.v === card.v || (p.def && p.def.v === card.v))) {
            pHand.splice(idx, 1);
            table.push({att: card, def: null});
            render();
            setTimeout(aiDefend, 600);
        }
    }

    function aiDefend() {
        const lastPair = table[table.length - 1];
        if(lastPair.def) return;

        // Поиск карты для защиты
        const target = lastPair.att;
        let choice = aHand
            .filter(c => (c.s === target.s && c.p > target.p) || (c.s === trump.s && target.s !== trump.s))
            .sort((a,b) => a.p - b.p)[0];

        if(choice) {
            aHand = aHand.filter(c => c !== choice);
            lastPair.def = choice;
            document.getElementById('status').innerText = "Искра отбилась...";
        } else {
            document.getElementById('status').innerText = "Искра берет карты";
            setTimeout(aiTake, 1000);
        }
        render();
    }

    function aiTake() {
        table.forEach(p => {
            aHand.push(p.att);
            if(p.def) aHand.push(p.def);
        });
        table = [];
        drawCards();
        render();
    }

    function finishTurn() {
        if(table.every(p => p.def)) {
            table = [];
            drawCards();
            isPlayerTurn = false;
            document.getElementById('status').innerText = "Ход Искры...";
            setTimeout(aiAttack, 1000);
        }
    }

    function aiAttack() {
        if(aHand.length > 0) {
            const card = aHand.sort((a,b) => a.p - b.p)[0];
            aHand = aHand.filter(c => c !== card);
            table.push({att: card, def: null});
            isPlayerTurn = true;
            render();
        }
    }

    function drawCards() {
        while(pHand.length < 6 && deck.length > 0) pHand.push(deck.pop());
        while(aHand.length < 6 && deck.length > 0) aHand.push(deck.pop());
    }

    function playerTake() {
        table.forEach(p => {
            pHand.push(p.att);
            if(p.def) pHand.push(p.def);
        });
        table = [];
        drawCards();
        isPlayerTurn = false;
        render();
        setTimeout(aiAttack, 1000);
    }

    init();
</script>
</body>
</html>
