<!DOCTYPE html>
<html lang="en" translate="no"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vchf Durak Elite | Bi-Turbo</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffcc00;
            --onyx: #0a0a0a;
            --neon: #00f3ff;
            --platinum: #ffffff;
        }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--onyx); overflow: hidden;
            font-family: 'Orbitron', sans-serif;
        }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; touch-action: none; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.9) 100%);
            pointer-events: none;
        }
        .logo-box { width: 130px; height: 130px; opacity: 0; transition: opacity 2s; margin-bottom: 25px; }
        .logo-box img { width: 100%; filter: drop-shadow(0 0 15px var(--gold)); }
        .status-label {
            color: var(--neon); font-size: 10px; letter-spacing: 5px;
            text-transform: uppercase; text-shadow: 0 0 10px var(--neon);
        }
        #game-controls { 
            position: absolute; bottom: 30px; z-index: 20; 
            display: none; width: 100%; justify-content: center; 
            gap: 15px; pointer-events: auto; 
        }
        button { 
            background: rgba(0,0,0,0.6); border: 1px solid var(--gold); 
            color: var(--gold); padding: 12px 25px; font-family: 'Orbitron'; 
            cursor: pointer; text-transform: uppercase; font-size: 11px;
            box-shadow: 0 0 10px rgba(255,204,0,0.2);
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <div id="ui-layer">
        <div id="mainLogo" class="logo-box"><img src="1771489965074(1).png"></div>
        <div id="mainStatus" class="status-label">INITIALIZING ENGINE...</div>
    </div>
    <div id="game-controls">
        <button onclick="takeCards()">Взять</button>
        <button onclick="passTurn()">Бито</button>
    </div>

    <script>
    // Автор: Искра. Кодовое слово: движок vchf.
    // Правка: Видимость карт + Разноцветные лазеры (по видео Бродяги)
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('mainStatus');
    const logo = document.getElementById('mainLogo');
    const controls = document.getElementById('game-controls');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const spheres = [
        { x: 0.15, y: 0.25, colors: ['#000', '#ffcc00', '#000'], laser: '#ffcc00' },
        { x: 0.85, y: 0.25, colors: ['#eee', '#ffffff', '#eee'], laser: '#ffffff' },
        { x: 0.15, y: 0.50, colors: ['#0057b7', '#ffd700'], laser: '#0057b7' },
        { x: 0.85, y: 0.50, colors: ['#fff', '#0039a6', '#d52b1e'], laser: '#d52b1e' },
        { x: 0.15, y: 0.75, colors: ['#002395', '#ffffff', '#ed2939'], laser: '#ed2939' },
        { x: 0.85, y: 0.75, colors: ['#008c45', '#f4f5f0', '#cd212a'], laser: '#008c45' }
    ];

    let drawnItems = spheres.map(s => ({ ...s, grow: 0, ink: 0 }));
    let l1 = { x: canvas.width/2, y: 0 }, l2 = { x: canvas.width/2, y: canvas.height };
    let step1 = 0, step2 = 0;
    let active2 = false, introFade = 1.0;
    let deck = [], playerHand = [], aiHand = [], table = [];
    let trump = null, phase = 'intro';

    const CARD_W = 65, CARD_H = 95;
    const SUITS = ['♠', '♣', '♥', '♦'];
    const VALUES = ['6','7','8','9','10','J','Q','K','A'];
    // Исправлено: Масти ярче, чтобы не сливались
    const COLORS = { '♠':'#222', '♣':'#222', '♥':'#ff0000', '♦':'#ff0000' };

    function drawSphere(s) {
        if (s.grow <= 0) return;
        const x = s.x * canvas.width, y = s.y * canvas.height, r = 42 * s.grow;
        ctx.save();
        ctx.shadowBlur = 20; ctx.shadowColor = 'black';
        ctx.fillStyle = '#111'; ctx.beginPath(); ctx.arc(x, y, r, 0, 7); ctx.fill();
        let gBody = ctx.createRadialGradient(x-12, y-12, r/10, x, y, r);
        gBody.addColorStop(0, '#fff'); gBody.addColorStop(1, '#000');
        ctx.fillStyle = gBody; ctx.beginPath(); ctx.arc(x, y, r, 0, 7); ctx.fill();
        if (s.ink > 0) {
            ctx.beginPath(); ctx.arc(x, y, r-3, 0, 7); ctx.clip();
            let gFlag = ctx.createLinearGradient(x-r, y-r, x+r, y+r);
            s.colors.forEach((c, i) => gFlag.addColorStop(i/(s.colors.length-1), c));
            ctx.globalAlpha = s.ink; ctx.fillStyle = gFlag; ctx.fill();
        }
        ctx.restore();
    }
    // Конец Window 1
    // --- БЛОК РЕНДЕРА КАРТ (Фикс видимости) ---
    function drawCard3D(c, x, y, scale = 1) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(c.angle || 0);
        const w = CARD_W * scale, h = CARD_H * scale;

        // Тень
        ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(0,0,0,0.8)';
        // Рамка (Золотая для всех, чтобы видеть на черном)
        ctx.strokeStyle = 'var(--gold)'; ctx.lineWidth = 1;
        
        // Тело карты
        ctx.fillStyle = c.faceUp ? '#ffffff' : '#1a1a1a';
        ctx.beginPath(); ctx.roundRect(-w/2, -h/2, w, h, 6); ctx.fill();
        ctx.stroke();
        ctx.shadowBlur = 0;

        if (c.faceUp) {
            ctx.fillStyle = COLORS[c.suit];
            ctx.font = `bold ${16*scale}px Orbitron`;
            ctx.textAlign = "left";
            ctx.fillText(c.value, -w/2+7, -h/2+18);
            ctx.font = `${28*scale}px Arial`;
            ctx.textAlign = "center";
            ctx.fillText(c.suit, 0, 10);
        } else {
            ctx.fillStyle = 'var(--gold)';
            ctx.font = `${9*scale}px Orbitron`; ctx.textAlign = "center";
            ctx.fillText('VCHF', 0, 5);
        }
        ctx.restore();
    }

    function drawTable() {
        // Отрисовка фона только один раз или в начале цикла
        let bgGrad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 100, canvas.width/2, canvas.height/2, canvas.width);
        bgGrad.addColorStop(0, '#111'); bgGrad.addColorStop(1, '#000');
        ctx.fillStyle = bgGrad; ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (deck.length > 0) {
            drawCard3D(trump, 60, canvas.height/2, 0.8);
            if (deck.length > 1) drawCard3D({ faceUp: false }, 65, canvas.height/2 - 5, 0.8);
        }

        playerHand.forEach((c, i) => {
            c.targetX = (canvas.width/2 - (playerHand.length*50)/2) + i*55;
            c.targetY = canvas.height - 110;
            c.x += (c.targetX - c.x) * 0.1; c.y += (c.targetY - c.y) * 0.1;
            drawCard3D(c, c.x, c.y, 1.1);
        });

        aiHand.forEach((c, i) => {
            c.targetX = (canvas.width/2 - (aiHand.length*30)/2) + i*35;
            c.targetY = 90;
            c.x += (c.targetX - c.x) * 0.1; c.y += (c.targetY - c.y) * 0.1;
            drawCard3D(c, c.x, c.y, 0.7);
        });

        table.forEach((pair, i) => {
            let tx = (canvas.width/2 - (table.length*90)/2) + i*95;
            pair.attack.targetX = tx; pair.attack.targetY = canvas.height/2 - 20;
            pair.attack.x += (pair.attack.targetX - pair.attack.x) * 0.1;
            pair.attack.y += (pair.attack.targetY - pair.attack.y) * 0.1;
            drawCard3D(pair.attack, pair.attack.x, pair.attack.y, 0.9);

            if (pair.defense) {
                pair.defense.targetX = tx + 10; pair.defense.targetY = canvas.height/2 + 20;
                pair.defense.x += (pair.defense.targetX - pair.defense.x) * 0.1;
                pair.defense.y += (pair.defense.targetY - pair.defense.y) * 0.1;
                drawCard3D(pair.defense, pair.defense.x, pair.defense.y, 0.9);
            }
        });

        if (phase === 'dealing') updateDealing();
    }

    function render() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (phase === 'intro') {
            ctx.globalAlpha = introFade;
            // Разноцветные лазеры по видео
            if (step1 < spheres.length) {
                let s = drawnItems[step1];
                ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(l1.x, l1.y);
                ctx.strokeStyle = s.laser; ctx.lineWidth = 2; ctx.stroke();
                l1.x += (s.x*canvas.width - l1.x) * 0.1; l1.y += (s.y*canvas.height - l1.y) * 0.1;
                if (Math.abs(l1.x - s.x*canvas.width) < 2) { if (s.grow < 1) s.grow += 0.05; else step1++; }
            }
            if (active2 && step2 < spheres.length) {
                let s = drawnItems[step2];
                ctx.beginPath(); ctx.moveTo(canvas.width/2, canvas.height); ctx.lineTo(l2.x, l2.y);
                ctx.strokeStyle = s.laser; ctx.stroke();
                l2.x += (s.x*canvas.width - l2.x) * 0.1; l2.y += (s.y*canvas.height - l2.y) * 0.1;
                if (Math.abs(l2.x - s.x*canvas.width) < 2) { if (s.ink < 1) s.ink += 0.05; else step2++; }
            }
            drawnItems.forEach(drawSphere);
            if (step2 === spheres.length) {
                status.innerText = "VCHF ENGINE READY";
                setTimeout(() => { if (introFade > 0) introFade -= 0.05; else { phase = 'dealing'; initDeck(); logo.style.opacity=0; } }, 1500);
            }
        } else { drawTable(); }
        requestAnimationFrame(render);
    }
    // Остальные функции (aiDefense, initDeck, updateDealing) из твоего кода без изменений, 
    // но убедись, что COLORS['♠'] = '#222' для контраста!
    </script>
</body>
</html>
