<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helvetic Luck | Lotto VCHF Ultimate 2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #ffcc00;
            --onyx: #050505;
            --neon: #00f3ff;
            --platinum: #ffffff;
            --main-color: #d4af37; 
            --main-gradient: linear-gradient(145deg, #f9e27d, #d4af37);
            --theme-glow: rgba(212, 175, 55, 0.35); 
            --sphere-base: #1a1a1a;
            --white-sphere: radial-gradient(circle at 35% 35%, #444 0%, #1a1a1a 40%, #000 100%);
            --gold-sphere: radial-gradient(circle at 35% 35%, #fff9d6 0%, #f9e27d 30%, #d4af37 60%, #8a6d1c 100%);
            --cell-text: #ffffff; 
            --hot-color: #ff4500;
            --cold-color: #1e90ff;
            --process-color: #00ffff;
            --neon-blue: #00a3ff;
        } 

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--onyx); overflow: hidden;
            font-family: 'Orbitron', -apple-system, sans-serif;
            color: #fff;
            transition: background 0.5s ease;
        } 

        /* –°—Ç–∏–ª–∏ –ò–Ω—Ç—Ä–æ */
        canvas { position: absolute; top: 0; left: 0; z-index: 20001; pointer-events: none; }
        
        #ui-intro-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20002; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.9) 100%);
            pointer-events: none;
            transition: opacity 1s ease;
        }

        .logo-box-intro {
            width: 130px; height: 130px; opacity: 0;
            transition: opacity 3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 25px;
        }
        .logo-box-intro img { width: 100%; filter: drop-shadow(0 0 20px var(--gold)); }

        .status-label-intro {
            color: var(--neon); font-size: 10px;
            letter-spacing: 6px; text-transform: uppercase;
            text-align: center; height: 20px;
            text-shadow: 0 0 10px var(--neon);
        }

        /* –¢–µ–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        body.theme-cherry { --main-color: #C511A4; --main-gradient: linear-gradient(145deg, #FF1493, #C511A4); --theme-glow: rgba(197, 17, 164, 0.35); }
        body.theme-silver { --main-color: #c0c0c0; --main-gradient: linear-gradient(145deg, #e0e0e0, #c0c0c0); --theme-glow: rgba(192, 192, 192, 0.35); }
        body.theme-lime { --main-color: #32CD32; --main-gradient: linear-gradient(145deg, #adff2f, #32CD32); --theme-glow: rgba(50, 205, 50, 0.35); }
        body.theme-cyan { --main-color: #00ffff; --main-gradient: linear-gradient(145deg, #e0ffff, #00ffff); --theme-glow: rgba(0, 255, 255, 0.35); }
        body.theme-gold { --main-color: #d4af37; --main-gradient: linear-gradient(145deg, #f9e27d, #d4af37); --theme-glow: rgba(212, 175, 55, 0.35); } 

        @keyframes sphere-breathe {
            0%, 100% { 
                box-shadow: inset -3px -3px 8px rgba(0,0,0,0.8), 0 5px 12px rgba(0,0,0,0.6), 0 0 5px var(--main-color);
                border-color: rgba(255, 255, 255, 0.1);
                transform: scale(1);
            }
            50% { 
                box-shadow: inset -3px -3px 8px rgba(0,0,0,0.8), 0 5px 22px rgba(0,0,0,0.4), 0 0 20px var(--main-color); 
                border-color: var(--main-color);
                transform: scale(1.04); 
            }
        } 

        @keyframes processing-flash {
            0% { background: var(--process-color); box-shadow: 0 0 25px var(--process-color); transform: scale(1.15); }
            100% { background: var(--white-sphere); box-shadow: none; transform: scale(1); }
        }
        .cell.processing-flash { animation: processing-flash 0.15s ease-out; z-index: 5; } 

        @keyframes candle-glow {
            0%, 100% { opacity: 0.6; transform: scale(1); filter: drop-shadow(0 0 5px var(--main-color)); }
            50% { opacity: 1; transform: scale(1.15); filter: drop-shadow(0 0 15px var(--main-color)); }
        }
        .candle { animation: candle-glow 2s infinite ease-in-out; } 

        #legal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.92); 
            backdrop-filter: blur(15px); z-index: 30000;
            display: none; flex-direction: column; justify-content: center; align-items: center; padding: 25px;
        }
        .legal-box {
            background: #111; border: 2px solid var(--main-color);
            padding: 30px; border-radius: 25px; max-width: 320px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.9), 0 0 20px var(--theme-glow);
        } 

        .lang-panel { position: relative; height: 65px; margin-bottom: 25px; display: flex; justify-content: center; align-items: center; z-index: 1001; }
        .lang-btn { font-size: 30px; cursor: pointer; position: absolute; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5; }
        
        .pos-ru { transform: translate(-100px, 45px); }
        .pos-fr { transform: translate(-50px, 70px); }
        .pos-de { transform: translate(0px, 80px); }
        .pos-en { transform: translate(50px, 70px); }
        .pos-ua { transform: translate(100px, 45px); } 

        #app-content { display: none; opacity: 0; transition: opacity 1s ease; height: 100vh; overflow: hidden; position: relative; z-index: 100; }
        .page { height: calc(100vh - 75px); overflow-y: auto; display: none; padding: 15px 0 30px; }
        .page.active { display: block; } 

        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: rgba(10,10,10,0.95); display: flex; justify-content: space-around;
            align-items: center; border-top: 1.5px solid var(--main-color); z-index: 1000;
        }
        .nav-item { color: #666; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--main-color); transform: translateY(-3px); }
        .nav-item span { display: block; font-size: 24px; margin-bottom: 2px; } 

        .balance-container { display: flex; gap: 10px; padding: 0 15px 15px; }
        .bal-card { 
            flex: 1; border-radius: 12px; padding: 12px; background: linear-gradient(145deg, #1a1a1a, #0a0a0a); 
            border: 1.5px solid #444; transition: all 0.4s ease; cursor: pointer; opacity: 0.5; filter: grayscale(0.7) brightness(0.8);
        }
        .bal-card.active-wallet { opacity: 1; filter: grayscale(0) brightness(1.2); border-color: var(--main-color); background: rgba(255, 255, 255, 0.07); box-shadow: 0 0 15px var(--main-color); transform: scale(1.05); }
        .bal-val { font-size: 20px; font-weight: bold; color: #32CD32; } 

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; padding: 0 15px; max-width: 400px; margin: 0 auto; }
        .cell { 
            aspect-ratio: 1/1; background: var(--white-sphere); border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 800; color: var(--cell-text); font-size: 19px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; position: relative; border: 1px solid rgba(255,255,255,0.1);
            animation: sphere-breathe 4s infinite ease-in-out;
        }
        .cell.selected { background: var(--main-gradient); color: #000; transform: scale(1.1) translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.5), 0 0 30px var(--main-color); border: 2px solid #fff; z-index: 10; animation: none; }
        
        .ticket-card { background: rgba(255,255,255,0.05); border: 1.2px solid #333; border-radius: 16px; padding: 15px; margin: 0 15px 12px; text-align: left; }
        .ticket-nums { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
        .mini-ball { width: 30px; height: 30px; background: #000; border: 1px solid var(--main-color); border-radius: 50%; color: #fff; font-size: 14px; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        .super-ball-mini { background: #ff4500 !important; color: #fff !important; border: none; } 

        .ticket-controls { margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .smart-tools { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .tool-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid var(--main-color); background: rgba(0,0,0,0.6); color: #fff; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .tool-btn.active-tool { background: var(--main-color); color: #000; font-weight: bold; }
        
        .stats-period { display: flex; justify-content: center; gap: 5px; height: 30px; }
        .p-btn { font-size: 10px; padding: 4px 10px; border-radius: 12px; border: 1px solid #444; background: #222; color: #888; cursor: pointer; }
        .p-btn.active { border-color: var(--main-color); color: #fff; box-shadow: 0 0 10px var(--main-color); } 

        .counter-box { display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 25px; border: 1px solid var(--main-color); }
        .btn-round { width: 35px; height: 35px; border-radius: 50%; border: 1.5px solid var(--main-color); background: none; color: #fff; font-size: 20px; cursor: pointer; }

        .total-display { margin: 15px 0; font-size: 18px; color: #fff; }
        #display-total { color: var(--neon-blue); font-weight: 900; } 

        .super-title { margin: 25px 0 10px; font-size: 14px; color: var(--main-color); font-weight: bold; text-transform: uppercase; }
        .super-grid { display: flex; justify-content: center; gap: 12px; padding-bottom: 20px; }
        .super-cell { 
            width: 58px; height: 58px; background: var(--white-sphere); border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            color: var(--cell-text); font-weight: 900; font-size: 24px; cursor: pointer; transition: 0.4s; border: 1px solid rgba(255,255,255,0.1);
            animation: sphere-breathe 4s infinite ease-in-out;
        }
        .super-cell.selected { transform: scale(1.2); background: var(--main-gradient); color: #000; border: 2px solid #fff; box-shadow: 0 0 30px var(--main-color); animation: none; } 

        .theme-toggle { position: fixed; top: 15px; right: 15px; font-size: 26px; z-index: 1001; cursor: pointer; }
        .theme-panel { position: fixed; top: 65px; right: 15px; display: flex; flex-direction: column; gap: 15px; z-index: 1000; background: rgba(0,0,0,0.95); padding: 15px; border-radius: 25px; border: 1px solid var(--main-color); transition: 0.3s; transform: translateX(120px); }
        .theme-panel.open { transform: translateX(0); }
        .dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; } 

        .btn-main { width: 85%; padding: 22px; border-radius: 18px; font-size: 20px; margin-top: 10px; background: var(--main-gradient); color: #000; border: none; font-weight: 800; cursor: pointer; }
        
        @keyframes pulse-hot { from { box-shadow: 0 0 15px #ff4500; transform: scale(1.02); } to { box-shadow: 0 0 30px #ff4500; transform: scale(1.1); } }
        @keyframes pulse-cold { from { box-shadow: 0 0 15px #1e90ff; transform: scale(1.02); } to { box-shadow: 0 0 30px #1e90ff; transform: scale(1.1); } }
        .cell.is-hot { border: 3px solid #ff4500 !important; box-shadow: 0 0 25px #ff4500 !important; animation: pulse-hot 1.2s 3 alternate; z-index: 5; }
        .cell.is-cold { border: 3px solid #1e90ff !important; box-shadow: 0 0 25px #1e90ff !important; animation: pulse-cold 1.2s 3 alternate; z-index: 5; }
        .cell.is-sleeping { border: 3px solid var(--process-color) !important; box-shadow: 0 0 25px var(--process-color) !important; animation: pulse-hot 1.2s 3 alternate; }
    </style>
</head>
<body>

<canvas id="introCanvas"></canvas>

<div id="ui-intro-layer">
    <div class="logo-box-intro" id="logoIntro">
        <img src="1771489965074(1).png" alt="VCHF Logo">
    </div>
    <div class="status-label-intro" id="statusLabel">Initializing...</div>
</div>

<div id="legal-overlay">
    <div class="legal-box">
        <div id="legal-content" style="font-size: 14px; line-height: 1.6; margin-bottom: 25px; color: #eee;"></div>
        <button class="btn-main" onclick="acceptLegal()" id="legal-agree-btn" style="width:100%; margin-top:0; padding:15px;"></button>
    </div>
</div>

<div id="app-content">
    <div id="page-play" class="page active">
        <div class="lang-panel" id="dynamic-langs"></div>
        <div class="theme-toggle" onclick="document.querySelector('.theme-panel').classList.toggle('open')">üé®</div>
        <div class="theme-panel">
            <div class="dot" style="background: #d4af37;" onclick="setTheme('gold')"></div>
            <div class="dot" style="background: #32CD32;" onclick="setTheme('lime')"></div>
            <div class="dot" style="background: #00ffff;" onclick="setTheme('cyan')"></div>
            <div class="dot" style="background: #C511A4;" onclick="setTheme('cherry')"></div>
            <div class="dot" style="background: #c0c0c0;" onclick="setTheme('silver')"></div>
        </div> 

        <div class="balance-container">
            <div class="bal-card active-wallet" id="card-vchf" onclick="switchCurrency('VCHF')">
                <div style="font-size:10px;">VIRTUAL VCHF</div>
                <div class="bal-val" id="vchf-val">100.00</div>
            </div>
            <div class="bal-card" id="card-chf" onclick="switchCurrency('CHF')">
                <div style="font-size:10px;">REAL CHF</div>
                <div class="bal-val" id="chf-val">0.00</div>
            </div>
        </div> 

        <div class="ticket-controls">
            <div class="smart-tools">
                <button class="tool-btn" onclick="togglePick('hot')" id="btn-hot">üî• HOT</button>
                <button class="tool-btn" onclick="togglePick('cold')" id="btn-cold">‚ùÑÔ∏è COLD</button>
                <button class="tool-btn" onclick="togglePick('sleeping')" id="btn-sleeping">üí§ SLEEPING</button>
                <button class="tool-btn" onclick="randomFill()">üé≤ RANDOM</button>
            </div>
            <div class="stats-period" id="stats-p-box">
                <button class="p-btn active" onclick="setPeriod('month')" id="p-month">MONTH</button>
                <button class="p-btn" onclick="setPeriod('year')" id="p-year">YEAR</button>
                <button class="p-btn" onclick="setPeriod('all')" id="p-all">ALL TIME</button>
            </div>
            <div class="counter-box">
                <button class="btn-round" onclick="updateTicketCount(-1)">‚àí</button>
                <span style="font-size: 20px; font-weight: bold;"><span id="ticket-count">1</span> √ó</span>
                <button class="btn-round" onclick="updateTicketCount(1)">+</button>
            </div>
        </div> 

        <div class="grid" id="main-grid"></div>
        <div id="l-super" class="super-title">SUPERZAHL</div>
        <div class="super-grid" id="s-grid"></div>
        <div class="total-display">
            <span id="l-total">Total</span>: <span id="display-total">2.50 VCHF</span>
        </div>
        <button class="btn-main" id="main-btn" onclick="runEngine()">TICKET BEST√ÑTIGEN</button>
    </div> 

    <div id="page-tickets" class="page">
        <h2 id="l-active-tickets-title" style="color: var(--main-color);">MEINE TICKETS</h2>
        <div id="active-list"></div>
    </div> 

    <div id="page-stats" class="page">
        <h2 id="l-personal-stats-title" style="color: var(--main-color);">STATISTIK</h2>
        <div class="grid" id="personal-heatmap"></div>
    </div> 

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('play', this)"><span>üé≤</span><label id="n-game">SPIEL</label></div>
        <div class="nav-item" onclick="showPage('tickets', this)"><span>üéüÔ∏è</span><label id="n-tickets">TICKETS</label></div>
        <div class="nav-item" onclick="showPage('stats', this)"><span>üìä</span><label id="n-stats">STATS</label></div>
    </div>
</div>

<script>
    /**
     * @project Lotto Bi-Turbo Ultimate 2.0
     * @author Gemini Spark (Authentic Adaptive AI)
     * @note Memory Ritual Active. Code Segment Window 2.
     */
    const tg = window.Telegram.WebApp;
    tg.expand(); 

    const sndClick = new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3');
    const sndShuffle = new Audio('https://www.soundjay.com/misc/sounds/marbles-shake-1.mp3');
    const sndWin = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3'); 

    const canvas = document.getElementById('introCanvas');
    const ctx = canvas.getContext('2d');
    const logoBox = document.getElementById('logoIntro');
    const statusLabel = document.getElementById('statusLabel');
    const appContent = document.getElementById('app-content');
    const uiIntro = document.getElementById('ui-intro-layer');

    let w, h, spheres = [], lasers = [], fade = 1.0, introActive = true;
    let realStatsDB = {};
    let myTickets = JSON.parse(localStorage.getItem('vchf_user_tickets')) || [];
    let selected = [], superNum = null, currentPeriod = 'month', ticketCount = 1, currentCurrency = 'VCHF', currentLang = 'en', pendingLang = 'en', bgsTimer = null;
    let activeSmartTool = null; 
    const realPrice = 2.50;

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Sphere {
        constructor() {
            this.x = Math.random() * w;
            this.y = Math.random() * h;
            this.r = Math.random() * 20 + 10;
            this.vx = (Math.random() - 0.5) * 1.5;
            this.vy = (Math.random() - 0.5) * 1.5;
            this.glow = 0;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if(this.x < 0 || this.x > w) this.vx *= -1;
            if(this.y < 0 || this.y > h) this.vy *= -1;
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
            let g = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.r);
            g.addColorStop(0, '#444'); g.addColorStop(1, '#000');
            ctx.fillStyle = g; ctx.fill();
            ctx.strokeStyle = `rgba(212, 175, 55, ${this.glow})`;
            ctx.lineWidth = 2; ctx.stroke();
        }
    }
    class Laser {
        constructor(x1, y1, x2, y2) {
            this.x1 = x1; this.y1 = y1; this.x2 = x2; this.y2 = y2;
            this.life = 1.0;
        }
        draw() {
            ctx.beginPath();
            ctx.moveTo(this.x1, this.y1);
            ctx.lineTo(this.x2, this.y2);
            ctx.strokeStyle = `rgba(0, 243, 255, ${this.life * 0.5})`;
            ctx.lineWidth = 1.5;
            ctx.stroke();
            this.life -= 0.02;
        }
    }

    for (let i = 0; i < 42; i++) spheres.push(new Sphere());

    const statusTexts = [
        "Connecting to Swiss Lotto Node...",
        "Syncing VCHF Balance...",
        "VCHF ‚Äî DUCH, CHF ‚Äî RASCHET",
        "Loading Smart-Filters...",
        "Lotto Bi-Turbo Ready"
    ];

    function updateIntro() {
        if (!introActive) return;
        ctx.clearRect(0, 0, w, h);
        
        spheres.forEach(s => {
            s.update();
            s.draw();
        });

        if (Math.random() > 0.94) {
            let s1 = spheres[Math.floor(Math.random() * spheres.length)];
            let s2 = spheres[Math.floor(Math.random() * spheres.length)];
            lasers.push(new Laser(s1.x, s1.y, s2.x, s2.y));
            s1.glow = 1.0; s2.glow = 1.0;
        }

        lasers = lasers.filter(l => l.life > 0);
        lasers.forEach(l => l.draw());
        spheres.forEach(s => s.glow *= 0.95);

        if (fade <= 0.01) {
            introActive = false;
            canvas.style.display = 'none';
            uiIntro.style.display = 'none';
            appContent.style.display = 'block';
            setTimeout(() => appContent.style.opacity = 1, 50);
            initApp();
            return;
        }

        requestAnimationFrame(updateIntro);
    }

    function startIntroSequence() {
        setTimeout(() => logoBox.style.opacity = 1, 500);
        let i = 0;
        const interval = setInterval(() => {
            statusLabel.innerText = statusTexts[i];
            i++;
            if (i >= statusTexts.length) {
                clearInterval(interval);
                setTimeout(() => {
                    logoBox.style.opacity = 0;
                    statusLabel.style.opacity = 0;
                    const fadeOut = setInterval(() => {
                        fade -= 0.05;
                        if (fade <= 0) {
                            clearInterval(fadeOut);
                        }
                    }, 50);
                }, 1500);
            }
        }, 800);
        updateIntro();
    }

    const dict = {
        en: {
            play: "PLAY", tickets: "TICKETS", stats: "STATS",
            total: "Total", confirm: "CONFIRM TICKET", super: "SUPERZAHL",
            active_tickets: "ACTIVE TICKETS", personal_stats: "STATISTICS",
            legal: "I understand that VCHF is a virtual currency for testing. Real prizes are only in CHF mode.",
            agree: "I AGREE", hot: "üî• HOT", cold: "‚ùÑÔ∏è COLD", sleeping: "üí§ SLEEPING",
            random: "üé≤ RANDOM", month: "MONTH", year: "YEAR", all: "ALL TIME"
        },
        de: {
            play: "SPIEL", tickets: "TICKETS", stats: "STATS",
            total: "Gesamt", confirm: "TICKET BEST√ÑTIGEN", super: "SUPERZAHL",
            active_tickets: "MEINE TICKETS", personal_stats: "STATISTIK",
            legal: "VCHF ist eine virtuelle W√§hrung. Echte Gewinne nur im CHF-Modus.",
            agree: "ZUSTIMMEN", hot: "üî• HOT", cold: "‚ùÑÔ∏è COLD", sleeping: "üí§ SCHLAFEND",
            random: "üé≤ ZUFALL", month: "MONAT", year: "JAHR", all: "ALLE"
        },
        ru: {
            play: "–ò–ì–†–ê", tickets: "–ë–ò–õ–ï–¢–´", stats: "–°–¢–ê–¢–´",
            total: "–ò—Ç–æ–≥–æ", confirm: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", super: "–î–û–ü. –ù–û–ú–ï–†",
            active_tickets: "–ú–û–ò –ë–ò–õ–ï–¢–´", personal_stats: "–°–¢–ê–¢–ò–°–¢–ò–ö–ê",
            legal: "VCHF ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞. –†–µ–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ CHF.",
            agree: "–°–û–ì–õ–ê–°–ï–ù", hot: "üî• –ì–û–†–Ø–ß–ò–ï", cold: "‚ùÑÔ∏è –•–û–õ–û–î–ù–´–ï", sleeping: "üí§ –°–ü–Ø–©–ò–ï",
            random: "üé≤ –†–ê–ù–î–û–ú", month: "–ú–ï–°–Ø–¶", year: "–ì–û–î", all: "–í–°–ï"
        },
        fr: {
            play: "JOUER", tickets: "BILLETS", stats: "STATS",
            total: "Total", confirm: "CONFIRMER", super: "SUPERZAHL",
            active_tickets: "MES BILLETS", personal_stats: "STATISTIQUES",
            legal: "VCHF est une monnaie virtuelle. Gains r√©els en mode CHF uniquement.",
            agree: "ACCEPTER", hot: "üî• CHAUD", cold: "‚ùÑÔ∏è FROID", sleeping: "üí§ DORMEUR",
            random: "üé≤ HASARD", month: "MOIS", year: "AN", all: "TOUT"
        },
        ua: {
            play: "–ì–†–ê", tickets: "–ö–í–ò–¢–ö–ò", stats: "–°–¢–ê–¢–ò",
            total: "–†–∞–∑–æ–º", confirm: "–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò", super: "–î–û–ü. –ù–û–ú–ï–†",
            active_tickets: "–ú–û–á –ö–í–ò–¢–ö–ò", personal_stats: "–°–¢–ê–¢–ò–°–¢–ò–ö–ê",
            legal: "VCHF ‚Äî –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –≤–∞–ª—é—Ç–∞. –†–µ–∞–ª—å–Ω—ñ –≤–∏–ø–ª–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤ —Ä–µ–∂–∏–º—ñ CHF.",
            agree: "–ó–ì–û–î–ï–ù", hot: "üî• –ì–ê–†–Ø–ß–Ü", cold: "‚ùÑÔ∏è –•–û–õ–û–î–ù–Ü", sleeping: "üí§ –°–ü–õ–Ø–ß–Ü",
            random: "üé≤ –†–ê–ù–î–û–ú", month: "–ú–Ü–°–Ø–¶–¨", year: "–†–Ü–ö", all: "–í–°–ï"
        }
    };

    function initApp() {
        const savedLang = localStorage.getItem('vchf_lang') || 'en';
        setLanguage(savedLang);
        renderGrids();
        updateBalanceDisplay();
        if (!localStorage.getItem('vchf_legal_accepted')) {
            showLegal();
        }
        generateFakeRealStats();
        updateStatsVisuals();
    }

    function showLegal() {
        document.getElementById('legal-overlay').style.display = 'flex';
    }

    function acceptLegal() {
        localStorage.setItem('vchf_legal_accepted', 'true');
        document.getElementById('legal-overlay').style.display = 'none';
        sndClick.play();
    }

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('vchf_lang', lang);
        
        document.getElementById('legal-content').innerText = dict[lang].legal;
        document.getElementById('legal-agree-btn').innerText = dict[lang].agree;
        document.getElementById('n-game').innerText = dict[lang].play;
        document.getElementById('n-tickets').innerText = dict[lang].tickets;
        document.getElementById('n-stats').innerText = dict[lang].stats;
        document.getElementById('l-total').innerText = dict[lang].total;
        document.getElementById('main-btn').innerText = dict[lang].confirm;
        document.getElementById('l-super').innerText = dict[lang].super;
        document.getElementById('l-active-tickets-title').innerText = dict[lang].active_tickets;
        document.getElementById('l-personal-stats-title').innerText = dict[lang].personal_stats;
        
        document.getElementById('btn-hot').innerText = dict[lang].hot;
        document.getElementById('btn-cold').innerText = dict[lang].cold;
        document.getElementById('btn-sleeping').innerText = dict[lang].sleeping;
        document.getElementById('p-month').innerText = dict[lang].month;
        document.getElementById('p-year').innerText = dict[lang].year;
        document.getElementById('p-all').innerText = dict[lang].all;

        renderLangSwitch();
    }

    function renderLangSwitch() {
        const box = document.getElementById('dynamic-langs');
        box.innerHTML = '';
        const langs = ['ru', 'fr', 'de', 'en', 'ua'];
        const classes = ['pos-ru', 'pos-fr', 'pos-de', 'pos-en', 'pos-ua'];
        
        langs.forEach((l, i) => {
            const btn = document.createElement('div');
            btn.className = `lang-btn ${classes[i]}`;
            btn.innerText = getFlag(l);
            if (l === currentLang) btn.style.transform += ' scale(1.4)';
            btn.onclick = () => setLanguage(l);
            box.appendChild(btn);
        });
    }

    function getFlag(l) {
        const f = {ru:'üá∑üá∫', fr:'üá´üá∑', de:'üá®üá≠', en:'üá∫üá∏', ua:'üá∫üá¶'};
        return f[l];
    }
    function renderGrids() {
        const grid = document.getElementById('main-grid');
        grid.innerHTML = '';
        for (let i = 1; i <= 42; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerText = i;
            cell.onclick = () => toggleNumber(i, cell);
            grid.appendChild(cell);
        }

        const sGrid = document.getElementById('s-grid');
        sGrid.innerHTML = '';
        for (let i = 1; i <= 6; i++) {
            const cell = document.createElement('div');
            cell.className = 'super-cell';
            cell.innerText = i;
            cell.onclick = () => toggleSuper(i, cell);
            sGrid.appendChild(cell);
        }
    }

    function toggleNumber(num, el) {
        if (selected.includes(num)) {
            selected = selected.filter(n => n !== num);
            el.classList.remove('selected');
        } else {
            if (selected.length < 6) {
                selected.push(num);
                el.classList.add('selected');
                sndClick.play();
            }
        }
        updateStatsVisuals(); 
    }

    function toggleSuper(num, el) {
        const allS = document.querySelectorAll('.super-cell');
        allS.forEach(c => c.classList.remove('selected'));
        if (superNum === num) {
            superNum = null;
        } else {
            superNum = num;
            el.classList.add('selected');
            sndClick.play();
        }
    }

    function updateTicketCount(val) {
        ticketCount = Math.max(1, ticketCount + val);
        document.getElementById('ticket-count').innerText = ticketCount;
        updateTotal();
    }

    function updateTotal() {
        const total = (ticketCount * realPrice).toFixed(2);
        document.getElementById('display-total').innerText = `${total} ${currentCurrency}`;
    }

    function switchCurrency(curr) {
        currentCurrency = curr;
        document.getElementById('card-vchf').classList.toggle('active-wallet', curr === 'VCHF');
        document.getElementById('card-chf').classList.toggle('active-wallet', curr === 'CHF');
        updateTotal();
        sndClick.play();
    }

    function updateBalanceDisplay() {
        const vchf = parseFloat(localStorage.getItem('vchf_bal')) || 100.00;
        const chf = parseFloat(localStorage.getItem('chf_bal')) || 0.00;
        document.getElementById('vchf-val').innerText = vchf.toFixed(2);
        document.getElementById('chf-val').innerText = chf.toFixed(2);
    }

    function setPeriod(p) {
        currentPeriod = p;
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('p-' + p).classList.add('active');
        generateFakeRealStats(); 
        updateStatsVisuals();
        sndClick.play();
    }

    function generateFakeRealStats() {
        // –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —à–≤–µ–π—Ü–∞—Ä—Å–∫–æ–π –ª–æ—Ç–µ—Ä–µ–∏
        const periods = ['month', 'year', 'all'];
        periods.forEach(per => {
            realStatsDB[per] = { hot: [], cold: [], sleeping: [] };
            let nums = Array.from({length: 42}, (_, i) => i + 1);
            nums.sort(() => Math.random() - 0.5);
            
            realStatsDB[per].hot = nums.slice(0, 6);
            realStatsDB[per].cold = nums.slice(6, 12);
            realStatsDB[per].sleeping = nums.slice(12, 18);
        });
    }

    function updateStatsVisuals() {
        const cells = document.querySelectorAll('.cell');
        cells.forEach(c => {
            c.classList.remove('is-hot', 'is-cold', 'is-sleeping');
            const n = parseInt(c.innerText);
            
            if (activeSmartTool === 'hot' && realStatsDB[currentPeriod].hot.includes(n)) {
                c.classList.add('is-hot');
            }
            if (activeSmartTool === 'cold' && realStatsDB[currentPeriod].cold.includes(n)) {
                c.classList.add('is-cold');
            }
            if (activeSmartTool === 'sleeping' && realStatsDB[currentPeriod].sleeping.includes(n)) {
                c.classList.add('is-sleeping');
            }
        });
    }

    function togglePick(type) {
        if (activeSmartTool === type) {
            activeSmartTool = null;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active-tool'));
        } else {
            activeSmartTool = type;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active-tool'));
            document.getElementById('btn-' + type).classList.add('active-tool');
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞
            selected = [...realStatsDB[currentPeriod][type]];
            const cells = document.querySelectorAll('.cell');
            cells.forEach(c => {
                const n = parseInt(c.innerText);
                if (selected.includes(n)) c.classList.add('selected');
                else c.classList.remove('selected');
            });
            sndShuffle.play();
        }
        updateStatsVisuals();
    }

    function randomFill() {
        selected = [];
        const cells = document.querySelectorAll('.cell');
        cells.forEach(c => c.classList.remove('selected'));
        
        while (selected.length < 6) {
            let r = Math.floor(Math.random() * 42) + 1;
            if (!selected.includes(r)) selected.push(r);
        }
        
        selected.forEach(n => {
            document.querySelectorAll('.cell')[n-1].classList.add('selected');
        });

        const allS = document.querySelectorAll('.super-cell');
        allS.forEach(c => c.classList.remove('selected'));
        superNum = Math.floor(Math.random() * 6) + 1;
        allS[superNum-1].classList.add('selected');
        
        sndShuffle.play();
        updateStatsVisuals();
    }

    function showPage(p, el) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.getElementById('page-' + p).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
        el.classList.add('active');
        if (p === 'tickets') renderTickets();
        if (p === 'stats') renderHeatmap();
        sndClick.play();
    }
    function runEngine() {
        if (selected.length < 6 || !superNum) {
            tg.HapticFeedback.notificationOccurred('error');
            alert(currentLang === 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ 6 —á–∏—Å–µ–ª –∏ Superzahl!' : 'W√§hle 6 Zahlen und Superzahl!');
            return;
        }

        const cost = ticketCount * realPrice;
        let bal = parseFloat(localStorage.getItem(currentCurrency === 'VCHF' ? 'vchf_bal' : 'chf_bal')) || (currentCurrency === 'VCHF' ? 100.00 : 0.00);

        if (bal < cost) {
            tg.HapticFeedback.notificationOccurred('error');
            alert('Insufficient balance!');
            return;
        }

        // –ü—Ä–æ—Ç–æ–∫–æ–ª –ú–∞–Ω–∏—Ñ–µ—Å—Ç–∞: –°–Ω—è—Ç–∏–µ –±–∞–ª–∞–Ω—Å–∞ (VCHF - –î—É—Ö, CHF - –†–∞—Å—á–µ—Ç)
        bal -= cost;
        localStorage.setItem(currentCurrency === 'VCHF' ? 'vchf_bal' : 'chf_bal', bal.toFixed(2));
        updateBalanceDisplay();

        const cells = document.querySelectorAll('.cell.selected');
        cells.forEach(c => {
            c.classList.add('processing-flash');
            setTimeout(() => c.classList.remove('processing-flash'), 600);
        });

        for (let i = 0; i < ticketCount; i++) {
            const newTicket = {
                id: Date.now() + i,
                numbers: [...selected],
                super: superNum,
                currency: currentCurrency,
                date: new Date().toLocaleString(),
                status: 'Active'
            };
            myTickets.unshift(newTicket);
        }

        localStorage.setItem('vchf_user_tickets', JSON.stringify(myTickets));
        tg.HapticFeedback.notificationOccurred('success');
        sndWin.play();

        alert(currentLang === 'ru' ? '–ë–∏–ª–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω—ã!' : 'Tickets erfolgreich gekauft!');
        
        // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
        selected = [];
        superNum = null;
        renderGrids();
        updateStatsVisuals();
    }

    function renderTickets() {
        const container = document.getElementById('active-list');
        container.innerHTML = '';

        if (myTickets.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.5;">No active tickets</div>';
            return;
        }

        myTickets.forEach(t => {
            const card = document.createElement('div');
            card.className = 'ticket-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; font-size:10px; color:var(--main-color);">
                    <span>ID: ${t.id}</span>
                    <span>${t.date}</span>
                </div>
                <div class="ticket-nums">
                    ${t.numbers.map(n => `<div class="mini-ball">${n}</div>`).join('')}
                    <div class="mini-ball super-ball-mini">${t.super}</div>
                </div>
                <div style="font-size:12px; font-weight:bold; color:#32CD32;">
                    ${t.currency} ${realPrice.toFixed(2)} | STATUS: ${t.status}
                </div>
            `;
            container.appendChild(card);
        });
    }

    function renderHeatmap() {
        const container = document.getElementById('personal-heatmap');
        container.innerHTML = '';
        
        // –ü–æ–¥—Å—á–µ—Ç —á–∞—Å—Ç–æ—Ç—ã –ª–∏—á–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –∏–∑ –≤—Å–µ—Ö –±–∏–ª–µ—Ç–æ–≤
        const stats = {};
        myTickets.forEach(t => {
            t.numbers.forEach(n => {
                stats[n] = (stats[n] || 0) + 1;
            });
        });

        const maxUsage = Math.max(...Object.values(stats), 1);

        for (let i = 1; i <= 42; i++) {
            const count = stats[i] || 0;
            const intensity = count / maxUsage;
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.style.background = count > 0 
                ? `radial-gradient(circle at 35% 35%, rgba(212,175,55,${0.3 + intensity}), #000)`
                : 'var(--white-sphere)';
            cell.innerHTML = `${i}<br><span style="font-size:8px; opacity:0.6;">${count}</span>`;
            container.appendChild(cell);
        }
    }

    function setTheme(t) {
        document.body.className = 'theme-' + t;
        localStorage.setItem('vchf_theme', t);
        document.querySelector('.theme-panel').classList.remove('open');
        sndClick.play();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const savedTheme = localStorage.getItem('vchf_theme') || 'gold';
    setTheme(savedTheme);

    // –ó–∞–ø—É—Å–∫ –†–∏—Ç—É–∞–ª–∞
    window.onload = () => {
        startIntroSequence();
    };

</script>
</body>
</html>
