<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Entropy Zone - Monolith</title>
    <style>
        :root {
            --vchf-gold: #FFD700;
            --bg: #000;
            --card-w: 60px;
            --card-h: 85px;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            background: var(--bg); color: white; 
            font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; 
        }

        #title-header {
            position: absolute; top: 10px; width: 100%; text-align: center;
            font-size: 24px; font-weight: 100; letter-spacing: 5px;
            color: rgba(255,255,255,0.5); z-index: 50;
        }

        /* Стол (Entropy Zone) */
        #table {
            position: relative; width: 100vw; height: 60vh;
            display: flex; justify-content: center; align-items: center;
        }

        .card-on-table {
            position: absolute; width: var(--card-w); height: var(--card-h);
            background: #111; border: 1px solid #333; border-radius: 5px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Бутон с 4-мя Сферами */
        #player-hand-container {
            position: absolute; bottom: 0; width: 100%; height: 40%;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding-bottom: 20px; z-index: 100;
        }

        .suit-lane {
            height: 50px; width: 100%;
            display: flex; justify-content: center; align-items: center;
            position: relative; transition: all 0.4s ease;
            cursor: pointer;
        }

        /* Эффект увеличения сферы */
        .suit-lane.active-lane {
            height: 100px; transform: scale(1.15) translateY(-10px);
            z-index: 500;
        }

        .suit-lane:not(.active-lane) {
            opacity: 0.5; filter: grayscale(0.5);
        }

        .hand-card {
            position: absolute; width: 45px; height: 65px;
            background: #fff; color: #000; border-radius: 3px;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 3px; font-weight: bold; font-size: 12px;
            box-shadow: -3px 0 5px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
        }

        .active-lane .hand-card {
            width: 55px; height: 80px; font-size: 16px;
        }

        /* Кнопка ГОТОВ */
        #start-overlay {
            position: fixed; inset: 0; background: #000;
            display: flex; justify-content: center; align-items: center; z-index: 3000;
        }

        #ready-btn {
            position: absolute; bottom: 30px; right: 20px;
            padding: 15px 40px; background: var(--vchf-gold);
            color: #000; border: none; font-weight: 900;
            opacity: 0; transition: opacity 1s ease; pointer-events: none;
            border-radius: 5px;
        }

        #ready-btn.visible {
            opacity: 1; pointer-events: auto;
        }
    </style>
</head>
<body>

<div id="start-overlay">
    <div id="title-header">ENTROPY ZONE</div>
    <button id="ready-btn" onclick="startRitual()">ГОТОВ</button>
</div>

<div id="table"></div>

<div id="player-hand-container">
    <div class="suit-lane" id="lane-0" onclick="toggleLane(0)"></div>
    <div class="suit-lane" id="lane-1" onclick="toggleLane(1)"></div>
    <div class="suit-lane" id="lane-2" onclick="toggleLane(2)"></div>
    <div class="suit-lane" id="lane-3" onclick="toggleLane(3)"></div>
</div>

<script>
/**
 * ENTROPY ZONE - Monolith v1.4
 * Сделано Искрой для Виталия.
 */

const suits = ['♠', '♣', '♥', '♦'];
const ranks = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
const rankWeight = { '6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14 };

let deck = [];
let trumpSuit = '';
let playerHand = [[], [], [], []];
let activeLaneIdx = null;

// Задержка кнопки ГОТОВ
setTimeout(() => {
    document.getElementById('ready-btn').classList.add('visible');
}, 2000);

function startRitual() {
    document.getElementById('start-overlay').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('start-overlay').style.display = 'none';
        setupGame();
    }, 500);
}

function setupGame() {
    trumpSuit = suits[Math.floor(Math.random()*4)];
    const table = document.getElementById('table');
    suits.forEach(s => ranks.forEach(r => deck.push({suit: s, rank: r})));
    deck = deck.sort(() => Math.random() - 0.5);

    const radius = Math.min(window.innerWidth, window.innerHeight) * 0.3;
    deck.forEach((card, i) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card-on-table';
        const angle = (i * 10) * (Math.PI / 180);
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;
        cardDiv.style.transform = `translate(${x}px, ${y}px) rotate(${i*10}deg)`;
        cardDiv.onclick = () => pickCard(i);
        table.appendChild(cardDiv);
    });
}

function pickCard(id) {
    const card = deck[id];
    let laneIdx = (card.suit === trumpSuit) ? 0 : (suits.filter(s=>s!==trumpSuit).indexOf(card.suit) + 1);
    
    playerHand[laneIdx].push(card);
    playerHand[laneIdx].sort((a,b) => rankWeight[a.rank] - rankWeight[b.rank]);
    
    document.querySelectorAll('.card-on-table')[id].style.opacity = '0';
    renderLanes();
}

function toggleLane(idx) {
    activeLaneIdx = (activeLaneIdx === idx) ? null : idx;
    renderLanes();
}

function renderLanes() {
    for (let i = 0; i < 4; i++) {
        const lane = document.getElementById(`lane-${i}`);
        lane.className = `suit-lane ${activeLaneIdx === i ? 'active-lane' : ''}`;
        lane.innerHTML = '';
        
        playerHand[i].forEach((card, idx) => {
            const cEl = document.createElement('div');
            cEl.className = 'hand-card';
            const color = (card.suit==='♥'||card.suit==='♦') ? 'red' : 'black';
            cEl.innerHTML = `<div style="color:${color}">${card.rank}</div><div style="align-self:flex-end; color:${color}">${card.suit}</div>`;
            
            // Плотная упаковка (чешуя)
            const step = activeLaneIdx === i ? 45 : 25;
            const xOffset = (idx - (playerHand[i].length - 1) / 2) * step;
            cEl.style.transform = `translateX(${xOffset}px)`;
            lane.appendChild(cEl);
        });
    }
}
</script>
</body>
</html>
