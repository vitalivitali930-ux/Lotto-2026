<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lotto - –î–≤–∏–∂–æ–∫ VCHF Ultimate 2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --main-color: #d4af37; 
            --main-gradient: linear-gradient(145deg, #f9e27d, #d4af37);
            --theme-glow: rgba(212, 175, 55, 0.35); 
            --sphere-base: #1a1a1a;
            --white-sphere: radial-gradient(circle at 35% 35%, #444 0%, #1a1a1a 40%, #000 100%);
            --gold-sphere: radial-gradient(circle at 35% 35%, #fff9d6 0%, #f9e27d 30%, #d4af37 60%, #8a6d1c 100%);
            --cell-text: #ffffff; 
            --hot-color: #ff4500;
            --cold-color: #1e90ff;
            --process-color: #00ffff;
            --neon-blue: #00a3ff;
        }

        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; text-align: center; margin: 0; overflow: hidden; transition: background 0.5s ease; }

        /* –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è */
        body.theme-cherry { --main-color: #C511A4; --main-gradient: linear-gradient(145deg, #FF1493, #C511A4); --theme-glow: rgba(197, 17, 164, 0.35); }
        body.theme-silver { --main-color: #c0c0c0; --main-gradient: linear-gradient(145deg, #e0e0e0, #c0c0c0); --theme-glow: rgba(192, 192, 192, 0.35); }
        body.theme-lime { --main-color: #32CD32; --main-gradient: linear-gradient(145deg, #adff2f, #32CD32); --theme-glow: rgba(50, 205, 50, 0.35); }
        body.theme-cyan { --main-color: #00ffff; --main-gradient: linear-gradient(145deg, #e0ffff, #00ffff); --theme-glow: rgba(0, 255, 255, 0.35); }

        @keyframes candle-glow { 0%, 100% { opacity: 0.6; transform: scale(1); filter: drop-shadow(0 0 5px var(--main-color)); } 50% { opacity: 1; transform: scale(1.15); filter: drop-shadow(0 0 15px var(--main-color)); } }
        .candle { animation: candle-glow 2s infinite ease-in-out; }

        #legal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(15px); z-index: 30000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 25px; }
        .legal-box { background: #111; border: 2px solid var(--main-color); padding: 30px; border-radius: 25px; max-width: 320px; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.9), 0 0 20px var(--theme-glow); }

        .lang-panel { position: relative; height: 65px; margin-bottom: 25px; display: flex; justify-content: center; align-items: center; z-index: 1001; }
        .lang-btn { font-size: 30px; cursor: pointer; position: absolute; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5; }
        .pos-ru { transform: translate(-100px, 45px); }
        .pos-fr { transform: translate(-50px, 70px); }
        .pos-de { transform: translate(0px, 80px); }
        .pos-en { transform: translate(50px, 70px); }
        .pos-ua { transform: translate(100px, 45px); }

        #intro-container { position: fixed; inset: 0; background: #000 url('Hintergrund.png') no-repeat center center; background-size: cover; z-index: 20000; display: flex; justify-content: center; align-items: center; transition: opacity 1s ease; }
        .intro-img { position: absolute; width: 85%; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        .intro-img.active { animation: shakePop 0.7s ease-out forwards; opacity: 1; }
        @keyframes shakePop { 0% { transform: scale(0.1); opacity: 0; } 50% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

        #app-content { display: none; opacity: 0; transition: opacity 1s ease; height: 100vh; overflow: hidden; }
        .page { height: calc(100vh - 75px); overflow-y: auto; display: none; padding: 15px 0 30px; }
        .page.active { display: block; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; background: rgba(10,10,10,0.95); display: flex; justify-content: space-around; align-items: center; border-top: 1.5px solid var(--main-color); z-index: 1000; }
        .nav-item { color: #666; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--main-color); transform: translateY(-3px); }
        .nav-item span { display: block; font-size: 24px; margin-bottom: 2px; }

        .bal-card { border-radius: 12px; padding: 12px; background: linear-gradient(145deg, #1a1a1a, #0a0a0a); border: 1.5px solid #444; transition: 0.4s; }
        .bal-card.active-wallet { border-color: var(--main-color); box-shadow: 0 0 15px var(--main-color); transform: scale(1.05); filter: brightness(1.2); }

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; padding: 0 15px; max-width: 400px; margin: 0 auto; }
        .cell { aspect-ratio: 1/1; background: var(--white-sphere); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--cell-text); font-size: 19px; transition: 0.3s; cursor: pointer; position: relative; border: 1px solid var(--theme-glow); box-shadow: inset -3px -3px 8px rgba(0,0,0,0.8), 0 5px 12px rgba(0,0,0,0.6), 0 0 10px var(--theme-glow); }
        .cell.selected { background: var(--main-gradient); color: #000; transform: scale(1.1) translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.4), 0 0 25px var(--main-color); border: 1.5px solid #fff; z-index: 10; }
        
        @keyframes pulse-hot { from { box-shadow: 0 0 10px #ff4500; transform: scale(1.02); } to { box-shadow: 0 0 25px #ff4500; transform: scale(1.1); } }
        .cell.is-hot { border: 3px solid #ff4500 !important; animation: pulse-hot 1.2s 3 alternate; }
        .cell.is-cold { border: 3px solid #1e90ff !important; box-shadow: 0 0 20px #1e90ff !important; }
        .cell.is-sleeping { border: 3px solid var(--process-color) !important; box-shadow: 0 0 20px var(--process-color) !important; }
        
        .btn-main { width: 85%; padding: 22px; border-radius: 18px; font-size: 20px; margin-top: 10px; background: var(--main-gradient); color: #000; border: none; font-weight: 800; cursor: pointer; }
    </style>
</head>
<body>

<div id="legal-overlay">
    <div class="legal-box">
        <div id="legal-content"></div>
        <button class="btn-main" onclick="acceptLegal()" id="legal-agree-btn"></button>
    </div>
</div>

<div id="intro-container">
    <img src="Bild1.png" id="intro1" class="intro-img">
    <img src="Bild2.png" id="intro2" class="intro-img">
    <img src="1771489965074(1).png" id="intro3" class="intro-img">
</div>

<div id="app-content">
    <div id="page-play" class="page active">
        <div class="lang-panel" id="dynamic-langs"></div>
        <div class="theme-toggle" onclick="document.querySelector('.theme-panel').classList.toggle('open')" style="position:fixed; top:15px; right:15px; font-size:26px; z-index:1001;">üé®</div>
        <div class="theme-panel" style="position:fixed; top:65px; right:15px; display:flex; flex-direction:column; gap:15px; z-index:1000; background:rgba(0,0,0,0.95); padding:15px; border-radius:25px; border:1px solid var(--main-color); transition:0.3s; transform:translateX(120px);">
            <div class="dot" style="width:30px;height:30px;border-radius:50%;background:#d4af37;" onclick="setTheme('gold')"></div>
            <div class="dot" style="width:30px;height:30px;border-radius:50%;background:#32CD32;" onclick="setTheme('lime')"></div>
            <div class="dot" style="width:30px;height:30px;border-radius:50%;background:#00ffff;" onclick="setTheme('cyan')"></div>
            <div class="dot" style="width:30px;height:30px;border-radius:50%;background:#C511A4;" onclick="setTheme('cherry')"></div>
        </div>

        <div style="padding:0 15px 15px;">
            <div class="bal-card active-wallet" id="card-vchf">
                <div style="font-size:10px;">VIRTUAL VCHF</div>
                <div id="vchf-val" style="font-size:22px; font-weight:bold; color:#32CD32;">100.00</div>
            </div>
        </div>

        <div style="display:flex; gap:8px; justify-content:center; margin-bottom:15px;">
            <button class="tool-btn" onclick="togglePick('hot')" id="btn-hot" style="padding:8px 15px; border-radius:20px; border:1px solid var(--main-color); background:none; color:#fff;">üî• HOT</button>
            <button class="tool-btn" onclick="togglePick('cold')" id="btn-cold" style="padding:8px 15px; border-radius:20px; border:1px solid var(--main-color); background:none; color:#fff;">‚ùÑÔ∏è COLD</button>
            <button class="tool-btn" onclick="togglePick('sleeping')" id="btn-sleeping" style="padding:8px 15px; border-radius:20px; border:1px solid var(--main-color); background:none; color:#fff;">üí§ SLEEP</button>
        </div>

        <div style="display:flex; justify-content:center; gap:5px; margin-bottom:15px;">
            <button class="p-btn active" onclick="setPeriod('month')" id="p-month" style="font-size:10px; padding:5px 12px; border-radius:12px; border:1px solid var(--main-color); background:none; color:#fff;">MONTH</button>
            <button class="p-btn" onclick="setPeriod('year')" id="p-year" style="font-size:10px; padding:5px 12px; border-radius:12px; border:1px solid #444; background:none; color:#888;">YEAR</button>
            <button class="p-btn" onclick="setPeriod('all')" id="p-all" style="font-size:10px; padding:5px 12px; border-radius:12px; border:1px solid #444; background:none; color:#888;">ALL</button>
        </div>

        <div class="grid" id="main-grid"></div>
        <div id="l-super" style="margin:25px 0 10px; color:var(--main-color); font-weight:bold;">SUPERZAHL</div>
        <div class="grid" id="s-grid" style="display:flex; justify-content:center; gap:10px;"></div>
        
        <button class="btn-main" id="main-btn" onclick="runEngine()">CONFIRM TICKET</button>
    </div>

    <div id="page-tickets" class="page"><div id="active-list"></div></div>
    <div id="page-stats" class="page"><div class="grid" id="personal-heatmap"></div></div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('play', this)"><span>üé≤</span><label id="n-game">GAME</label></div>
        <div class="nav-item" onclick="showPage('tickets', this)"><span>üéüÔ∏è</span><label id="n-tickets">TICKETS</label></div>
        <div class="nav-item" onclick="showPage('stats', this)"><span>üìä</span><label id="n-stats">STATS</label></div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    let selected = [], superNum = null, currentPeriod = 'month', currentLang = 'en', pendingLang = 'en';
    let realStatsDB = {}; 
    let myTickets = JSON.parse(localStorage.getItem('vchf_user_tickets')) || [];

    const dict = {
        ru: { btn: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", super: "–ë–û–ù–£–°–ù–û–ï –ß–ò–°–õ–û", month: "–ú–ï–°–Ø–¶", year: "–ì–û–î", all: "–í–†–ï–ú–Ø", game: "–ò–ì–†–ê", tickets: "–ë–ò–õ–ï–¢–´", stats: "–°–¢–ê–¢–°" },
        ua: { btn: "–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò", super: "–ë–û–ù–£–°–ù–ï –ß–ò–°–õ–û", month: "–ú–Ü–°–Ø–¶–¨", year: "–†–Ü–ö", all: "–ß–ê–°", game: "–ì–†–ê", tickets: "–ö–í–ò–¢–ö–ò", stats: "–°–¢–ê–¢–°" },
        de: { btn: "BEST√ÑTIGEN", super: "SUPERZAHL", month: "MONAT", year: "JAHR", all: "ALLE", game: "SPIEL", tickets: "TICKETS", stats: "STATS" },
        en: { btn: "CONFIRM", super: "SUPER NUMBER", month: "MONTH", year: "YEAR", all: "ALL", game: "GAME", tickets: "TICKETS", stats: "STATS" }
    };

    const updateDict = {
        ru: { sync: "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø: SWISS LOTTO", noChange: "–ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞.", firstInit: "–ü–µ—Ä–≤–∏—á–Ω–∞—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.", replaced: "–≤ —Å–ª–æ–µ {layer} ({period}) —á–∏—Å–ª–æ {new} –∑–∞–º–µ–Ω–∏–ª–æ {old}", hot: "–ì–û–†–Ø–ß–ò–ï", cold: "–•–û–õ–û–î–ù–´–ï", sleep: "–°–ü–Ø–©–ò–ï", m: "–ú–µ—Å—è—Ü", y: "–ì–æ–¥", a: "–í—Å–µ –≤—Ä–µ–º—è" },
        de: { sync: "SYNCHRONISIERUNG: SWISS LOTTO", noChange: "Keine √Ñnderungen.", firstInit: "Erst-Aktualisierung abgeschlossen.", replaced: "In der Ebene {layer} ({period}) hat {new} {old} ersetzt", hot: "HOT", cold: "COLD", sleep: "SLEEPING", m: "Monat", y: "Jahr", a: "Alle" }
    };

    const legalDict = {
        ru: { title: "–ó–∞–∫–æ–Ω –®–≤–µ–π—Ü–∞—Ä–∏–∏ (BGS)", text: "–£—á–∞—Å—Ç–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –ª–∏—Ü–∞–º —Å—Ç–∞—Ä—à–µ <b>18 –ª–µ—Ç</b>.", btn: "–ú–ù–ï –ï–°–¢–¨ 18 –õ–ï–¢" },
        de: { title: "Schweizer Gesetz (BGS)", text: "Teilnahme erst ab <b>18 Jahren</b>.", btn: "ICH BIN 18" }
    };

    function getSwissTime() { return new Date(new Date().toLocaleString("en-US", {timeZone: "Europe/Zurich"})); }

    function getTopNumbers(type, period) {
        const pIdx = period === 'month' ? 0 : (period === 'year' ? 1 : 2);
        let sorted = Object.keys(realStatsDB).map(n => ({ num: parseInt(n), val: realStatsDB[n][pIdx] }));
        if (type === 'hot') sorted.sort((a, b) => b.val - a.val);
        else sorted.sort((a, b) => a.val - b.val);
        return sorted.slice(0, 6).map(i => i.num);
    }

    function showUpdateModal(changes) {
        const d = updateDict[currentLang] || updateDict['en'] || updateDict['de'];
        const modal = document.createElement('div');
        modal.style = "position:fixed; inset:0; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:50000; backdrop-filter:blur(10px); padding:20px;";
        modal.innerHTML = `<div class="legal-box"><h3 style="color:var(--main-color);">${d.sync}</h3><div style="margin:20px 0; color:#fff; font-size:13px;">${changes.length ? changes.join('<br><br>') : d.noChange}</div><button class="btn-main" onclick="this.parentElement.parentElement.remove()">OK</button></div>`;
        document.body.appendChild(modal);
    }

    async function runActualization() {
        const now = getSwissTime();
        const isDrawTime = (now.getDay() === 3 && now.getHours() >= 25) || (now.getDay() === 6 && now.getHours() >= 23);
        const lastSync = localStorage.getItem('vchf_last_sync_date');
        const todayStr = now.toDateString();

        if (!lastSync) {
            await fetchNewData();
            localStorage.setItem('vchf_last_sync_date', todayStr);
            showUpdateModal([updateDict[currentLang]?.firstInit || "System Initialized"]);
        } else if (isDrawTime && lastSync !== todayStr) {
            const oldSnap = {};
            ['month','year','all'].forEach(p => oldSnap[p]={hot:getTopNumbers('hot',p),cold:getTopNumbers('cold',p),sleeping:getTopNumbers('sleeping',p)});
            
            await fetchNewData();
            
            let changes = [], d = updateDict[currentLang] || updateDict['de'];
            ['month','year','all'].forEach(p => {
                ['hot','cold','sleeping'].forEach(t => {
                    const newList = getTopNumbers(t,p);
                    newList.forEach(n => {
                        if(!oldSnap[p][t].includes(n)) {
                            const out = oldSnap[p][t].find(o => !newList.includes(o));
                            if(out && d) changes.push(d.replaced.replace('{layer}', d[t]).replace('{period}', d[p==='month'?'m':(p==='year'?'y':'a')]).replace('{new}',n).replace('{old}',out));
                        }
                    });
                });
            });
            localStorage.setItem('vchf_last_sync_date', todayStr);
            showUpdateModal(changes);
        }
        refreshGrid();
    }

    async function fetchNewData() {
        for(let i=1; i<=42; i++) realStatsDB[i] = [Math.floor(Math.random()*15), Math.floor(Math.random()*60), Math.floor(Math.random()*600)];
        return Promise.resolve();
    }

    function startIntroSequence() {
        const i1 = document.getElementById('intro1'), i2 = document.getElementById('intro2'), i3 = document.getElementById('intro3'), container = document.getElementById('intro-container');
        setTimeout(() => i1.classList.add('active'), 100);
        setTimeout(() => { i1.classList.remove('active'); i2.classList.add('active'); }, 1200);
        setTimeout(() => { i2.classList.remove('active'); i3.classList.add('active'); }, 2400);
        setTimeout(() => { container.style.opacity = '0'; setTimeout(() => { container.style.display = 'none'; document.getElementById('app-content').style.display = 'block'; document.getElementById('app-content').style.opacity = '1'; runActualization(); }, 1000); }, 3600);
    }

    function renderLangPanel(isExp) {
        const cont = document.getElementById('dynamic-langs'); cont.innerHTML = '';
        const main = document.createElement('span'); main.className = 'lang-btn' + (!localStorage.getItem('vchf_lang')?' candle':'');
        main.innerHTML = (currentLang==='en'?'üá∫üá∏':currentLang==='ru'?'üá∑üá∫':currentLang==='ua'?'üá∫üá¶':currentLang==='de'?'üá©üá™':'üá´üá∑');
        main.onclick = () => renderLangPanel(!isExp); cont.appendChild(main);
        if(isExp) ['ru','fr','de','en','ua'].forEach(l => {
            const b = document.createElement('span'); b.className=`lang-btn pos-${l}`; 
            b.innerHTML = (l==='en'?'üá∫üá∏':l==='ru'?'üá∑üá∫':l==='ua'?'üá∫üá¶':l==='de'?'üá©üá™':'üá´üá∑');
            b.onclick = () => { pendingLang = l; showLegal(l); }; cont.appendChild(b);
        });
    }

    function showLegal(l) {
        const d = legalDict[l] || legalDict['en'];
        document.getElementById('legal-content').innerHTML = `<h3>${d.title}</h3>${d.text}`;
        document.getElementById('legal-agree-btn').innerText = d.btn;
        document.getElementById('legal-overlay').style.display = 'flex';
    }

    function acceptLegal() {
        currentLang = pendingLang; localStorage.setItem('vchf_lang', currentLang);
        document.getElementById('legal-overlay').style.display = 'none';
        setLang(currentLang); renderLangPanel(false);
    }

    function setLang(l) {
        const d = dict[l] || dict['en'];
        document.getElementById('main-btn').innerText = d.btn;
        document.getElementById('l-super').innerText = d.super;
        ['month','year','all'].forEach(p => document.getElementById(`p-${p}`).innerText = d[p]);
        ['game','tickets','stats'].forEach(n => document.getElementById(`n-${n}`).innerText = d[n]);
    }

    function refreshGrid() {
        const g = document.getElementById('main-grid'); g.innerHTML = '';
        for(let i=1; i<=42; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.id = `cell-${i}`; c.innerText = i;
            if(selected.includes(i)) c.classList.add('selected');
            c.onclick = () => { if(selected.includes(i)) selected=selected.filter(n=>n!==i); else if(selected.length<6) selected.push(i); refreshGrid(); };
            g.appendChild(c);
        }
    }

    function togglePick(t) { selected = getTopNumbers(t, currentPeriod); refreshGrid(); selected.forEach(n => document.getElementById(`cell-${n}`).classList.add(`is-${t}`)); }
    function setTheme(t) { document.body.className = 'theme-' + t; }
    function showPage(p, el) { 
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active'); el.classList.add('active');
        if(p==='stats') renderHeatmap();
    }

    function renderHeatmap() {
        const g = document.getElementById('personal-heatmap'); g.innerHTML = '';
        for(let i=1; i<=42; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.innerText = i;
            if(realStatsDB[i][2] > 400) c.style.boxShadow = 'inset 0 0 10px #ff4500';
            g.appendChild(c);
        }
    }

    window.onload = () => {
        const s = document.getElementById('s-grid');
        for(let i=1; i<=6; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.innerText = i;
            c.onclick = () => { superNum=i; document.querySelectorAll('#s-grid .cell').forEach(el=>el.classList.toggle('selected', el.innerText==i)); };
            s.appendChild(c);
        }
        const saved = localStorage.getItem('vchf_lang');
        if(saved) { currentLang = saved; setLang(currentLang); }
        renderLangPanel(false);
        startIntroSequence();
    };
</script>
</body>
</html>
